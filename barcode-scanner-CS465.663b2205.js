let e,t,r,n,i,s;var a,o,l,u,h,c,d,f,p,m,g,y,v,b,w,E,I,_,T,S,A,C="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},x={},k={},N=C.parcelRequirea202;null==N&&((N=function(e){if(e in x)return x[e].exports;if(e in k){var t=k[e];delete k[e];var r={id:e,exports:{}};return x[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){k[e]=t},C.parcelRequirea202=N),(0,N.register)("3jPiW",function(e,t){var r;e.exports=(r="6z40I",import("./"+(r=N.i?.[r]||r))).then(()=>N("aexh3"))}),Object.assign(N.i??={},{"6z40I":"es.e18d237c.js"});var R=(e="",t="")=>{let r=Math.random().toString(36).substring(2,8);return`${"string"==typeof e&&""!==e?e+"-":""}${r}${"string"==typeof t&&""!==t?"-"+t:""}`},D=(e,t)=>{if(Object.prototype.hasOwnProperty.call(t,e)){let r=t[e];delete t[e],t[e]=r}},L=0,P=`
  :host {
    box-sizing: border-box;
    display: inline-block;
    contain: content;
  }

  :host([hidden]),
  [hidden] {
    display: none !important;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  .tab {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.375rem 0.75rem;
    white-space: nowrap;
    cursor: pointer;
  }

  :host([disabled]) .tab {
    opacity: 0.7;
    cursor: not-allowed;
  }

  :host([selected]) .tab {
    color: var(--selected-tab-color);
    background-color: var(--selected-tab-bg-color);
  }

  .tab__close {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0.25rem;
    font-size: inherit;
    cursor: pointer;
  }
`,O=document.createElement("template");O.innerHTML=`
  <style>
    ${P}
  </style>

  <div part="base" class="tab">
    <slot></slot>
  </div>
`,(class e extends HTMLElement{constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(O.content.cloneNode(!0))}static get observedAttributes(){return["selected","disabled","closable"]}attributeChangedCallback(e,t,r){if("selected"===e&&t!==r&&(this.setAttribute("aria-selected",this.selected.toString()),this.setAttribute("tabindex",this.disabled||!this.selected?"-1":"0")),"disabled"===e&&t!==r&&(this.setAttribute("aria-disabled",this.disabled.toString()),this.setAttribute("tabindex",this.disabled||!this.selected?"-1":"0")),"closable"===e&&t!==r)if(this.closable){let e=document.createElement("span");e.className="tab__close",e.setAttribute("part","close-tab"),e.innerHTML='<svg part="close-tab-icon" xmlns="http://www.w3.org/2000/svg" width="0.875em" height="0.875em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true"><path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/></svg>',this.shadowRoot?.querySelector(".tab")?.appendChild(e),e.addEventListener("click",this.#e)}else{let e=this.shadowRoot?.querySelector(".tab__close");e?.removeEventListener("click",this.#e),e?.remove()}}connectedCallback(){this.#t("selected"),this.#t("disabled"),this.#t("closable"),this.id||(this.id=R("tab",(++L).toString())),this.setAttribute("slot","tab"),this.setAttribute("role","tab"),this.setAttribute("aria-selected","false"),this.setAttribute("tabindex",this.disabled||!this.selected?"-1":"0")}disconnectedCallback(){this.shadowRoot?.querySelector(".tab__close")?.removeEventListener("click",this.#e)}get selected(){return this.hasAttribute("selected")}set selected(e){this.toggleAttribute("selected",!!e)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}get closable(){return this.hasAttribute("closable")}set closable(e){this.toggleAttribute("closable",!!e)}#e=e=>{e.stopPropagation(),this.dispatchEvent(new CustomEvent("a-tab-close",{bubbles:!0,composed:!0,detail:{tabId:this.id}}))};#t(e){return D(e,this)}static defineCustomElement(t="a-tab"){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}}).defineCustomElement();var M=0,F=`
  :host {
    box-sizing: border-box;
    display: block;
    contain: content;
  }

  :host([hidden]),
  [hidden] {
    display: none !important;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }
`,V=document.createElement("template");V.innerHTML=`
  <style>
    ${F}
  </style>

  <div part="base" class="tab-panel">
    <slot></slot>
  </div>
`,(class e extends HTMLElement{constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(V.content.cloneNode(!0))}connectedCallback(){this.setAttribute("slot","panel"),this.setAttribute("role","tabpanel"),this.setAttribute("hidden",""),this.id||(this.id=R("panel",(++M).toString()))}static defineCustomElement(t="a-tab-panel"){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}}).defineCustomElement();var U={TOP:"top",BOTTOM:"bottom",START:"start",END:"end"},B={LTR:"ltr",RTL:"rtl"},z=Object.entries(U).map(([,e])=>e),q={AUTO:"auto",MANUAL:"manual"},j={DOWN:"ArrowDown",LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",HOME:"Home",END:"End",ENTER:"Enter",SPACE:" "},$=`
  :host {
    --selected-tab-color: #005fcc;
    --selected-tab-bg-color: transparent;
    --tabs-scroll-behavior: smooth;
    --scroll-button-width: 2.125em;
    --scroll-button-height: 2.125em;
    --scroll-button-inline-offset: 0rem;

    box-sizing: border-box;
    display: block;
    contain: content;
  }

  @media (prefers-reduced-motion: reduce) {
    :host {
      --tabs-scroll-behavior: auto;
    }
  }

  :host([hidden]),
  [hidden],
  ::slotted([hidden]) {
    display: none !important;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  .tab-group {
    display: flex;
    width: 100%;
  }

  .tab-group__nav {
    position: relative;
  }

  .tab-group__nav--has-scroll-controls {
    padding: 0 calc(var(--scroll-button-width) + var(--scroll-button-inline-offset));
  }

  .tab-group__scroll-button {
    display: flex;
    justify-content: center;
    align-items: center;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: var(--scroll-button-width);
    height: var(--scroll-button-height);
    padding: 0; /* Required for iOS, otherwise the svg is not visible: https://stackoverflow.com/questions/66532071/flex-svg-behaving-strange-in-ios-safari-14-0-3 */
    border: 0;
    z-index: 1;
    background-color: transparent;
    font-size: inherit;
    cursor: pointer;
    color: currentColor;
  }

  .tab-group__scroll-button--start {
    left: var(--scroll-button-inline-offset);
  }

  .tab-group__scroll-button--end {
    right: var(--scroll-button-inline-offset);
  }

  :host([dir="${B.RTL}"]) .tab-group__scroll-button--start,
  :host(:dir(${B.RTL})) .tab-group__scroll-button--start {
    right: var(--scroll-button-inline-offset);
    left: auto;
    transform: translateY(-50%) rotate(180deg);
  }

  :host([dir="${B.RTL}"]) .tab-group__scroll-button--end,
  :host(:dir(${B.RTL})) .tab-group__scroll-button--end {
    left: var(--scroll-button-inline-offset);
    right: auto;
    transform: translateY(-50%) rotate(180deg);
  }

  .tab-group__tabs {
    display: flex;
    padding: 0.25rem;
    overflow-x: auto;
    scroll-behavior: var(--tabs-scroll-behavior);
    scrollbar-width: none;
  }

  .tab-group__tabs::-webkit-scrollbar {
    display: none;
  }

  .tab-group__panels {
    padding: 1rem 0;
  }

  /* placement="top" */
  .tab-group,
  :host([placement="${U.TOP}"]) .tab-group {
    flex-direction: column;
  }

  /* placement="bottom" */
  :host([placement="${U.BOTTOM}"]) .tab-group {
    flex-direction: column;
  }

  :host([placement="${U.BOTTOM}"]) .tab-group__nav {
    order: 1;
  }

  /* placement="start" */
  :host([placement="${U.START}"]) .tab-group {
    flex-direction: row;
  }

  :host([placement="${U.START}"]) .tab-group__tabs {
    flex-direction: column;
    align-items: flex-start;
  }

  :host([placement="${U.START}"]) .tab-group__panels {
    flex: 1;
    padding: 0 1rem;
  }

  /* placement="end" */
  :host([placement="${U.END}"]) .tab-group {
    flex-direction: row;
  }

  :host([placement="${U.END}"]) .tab-group__nav {
    order: 1;
  }

  :host([placement="${U.END}"]) .tab-group__tabs {
    flex-direction: column;
    align-items: flex-start;
  }

  :host([placement="${U.END}"]) .tab-group__panels {
    flex: 1;
    padding: 0 1rem;
  }
`,H=document.createElement("template");H.innerHTML=`
  <style>${$}</style>

  <div part="base" class="tab-group">
    <div part="nav" class="tab-group__nav">
      <button type="button" part="scroll-button scroll-button--start" class="tab-group__scroll-button tab-group__scroll-button--start" aria-label="Scroll to start">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" part="scroll-button-icon">
          <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
        </svg>
      </button>

      <div part="tabs" class="tab-group__tabs" role="tablist" tabindex="-1">
        <slot name="tab"></slot>
      </div>

      <button type="button" part="scroll-button scroll-button--end" class="tab-group__scroll-button tab-group__scroll-button--end" aria-label="Scroll to end">
        <svg xmlns="http://www.w3.org/2000/svg" width="1rem" height="1em" fill="currentColor" viewBox="0 0 16 16" part="scroll-button-icon">
          <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
        </svg>
      </button>
    </div>

    <div part="panels" class="tab-group__panels">
      <slot name="panel"></slot>
    </div>
  </div>
`,(class e extends HTMLElement{#e=null;#t=null;#r=!1;constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(H.content.cloneNode(!0))}static get observedAttributes(){return["placement","no-scroll-controls"]}attributeChangedCallback(e,t,r){"placement"===e&&t!==r&&this.#n(),"no-scroll-controls"===e&&t!==r&&this.#n()}get placement(){return this.getAttribute("placement")||U.TOP}set placement(e){null!=e&&this.setAttribute("placement",e)}get noScrollControls(){return this.hasAttribute("no-scroll-controls")}set noScrollControls(e){this.toggleAttribute("no-scroll-controls",!!e)}get scrollDistance(){return Math.abs(Number(this.getAttribute("scroll-distance")))||200}set scrollDistance(e){this.setAttribute("scroll-distance",Math.abs(e).toString()||"200")}get activation(){return this.getAttribute("activation")||q.AUTO}set activation(e){this.setAttribute("activation",e||q.AUTO)}get noTabCycling(){return this.hasAttribute("no-tab-cycling")}set noTabCycling(e){this.toggleAttribute("no-tab-cycling",!!e)}connectedCallback(){this.#i("placement"),this.#i("noScrollControls"),this.#i("scrollDistance"),this.#i("activation"),this.#i("noTabCycling");let e=this.shadowRoot?.querySelector("slot[name=tab]"),t=this.shadowRoot?.querySelector("slot[name=panel]"),r=this.shadowRoot?.querySelector(".tab-group__tabs"),n=this.shadowRoot?.querySelector(".tab-group__nav"),i=Array.from(this.shadowRoot?.querySelectorAll(".tab-group__scroll-button")||[]);e?.addEventListener("slotchange",this.#s),t?.addEventListener("slotchange",this.#s),r?.addEventListener("click",this.#a),r?.addEventListener("keydown",this.#o),i.forEach(e=>e.addEventListener("click",this.#l)),this.addEventListener("a-tab-close",this.#u),"ResizeObserver"in window&&(this.#e=new ResizeObserver(e=>{this.#t=window.requestAnimationFrame(()=>{let t=e?.[0]?.target,r=t?.scrollWidth>t?.clientWidth;i.forEach(e=>e.toggleAttribute("hidden",!r)),n?.part.toggle("nav--has-scroll-controls",r),n?.classList.toggle("tab-group__nav--has-scroll-controls",r)})})),this.#h(),this.#n()}disconnectedCallback(){let e=this.shadowRoot?.querySelector("slot[name=tab]"),t=this.shadowRoot?.querySelector("slot[name=panel]"),r=this.shadowRoot?.querySelector(".tab-group__tabs"),n=Array.from(this.shadowRoot?.querySelectorAll(".tab-group__scroll-button")||[]);e?.removeEventListener("slotchange",this.#s),t?.removeEventListener("slotchange",this.#s),r?.removeEventListener("click",this.#a),r?.removeEventListener("keydown",this.#o),n.forEach(e=>e.removeEventListener("click",this.#l)),this.removeEventListener("a-tab-close",this.#u),this.#c()}#d(){if(!this.#e)return;let e=this.shadowRoot?.querySelector(".tab-group__tabs");e&&(this.#e.unobserve(e),this.#e.observe(e))}#c(){this.#e&&(this.#e.disconnect(),null!==this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null))}#f(){return window.CSS.supports("selector(:dir(ltr))")?this.matches(":dir(ltr)")?B.LTR:B.RTL:window.getComputedStyle(this).direction||B.LTR}#h(){this.hidden=0===this.#p().length}#m(){let e=this.#p();this.#h(),e.forEach(e=>{let t=e.nextElementSibling;if(!t||"a-tab-panel"!==t.tagName.toLowerCase())return console.error(`Tab #${e.id} is not a sibling of a <a-tab-panel>`);e.setAttribute("aria-controls",t.id),t.setAttribute("aria-labelledby",e.id)})}#g(){return Array.from(this.querySelectorAll("a-tab-panel"))}#p(){return Array.from(this.querySelectorAll("a-tab"))}#y(e){let t=e.getAttribute("aria-controls");return this.querySelector(`#${t}`)}#v(){return this.#p().find(e=>!e.disabled)||null}#b(){let e=this.#p();for(let t=e.length-1;t>=0;t--)if(!e[t].disabled)return e[t];return null}#w(){let e=this.#p(),t=this.activation===q.MANUAL?e.findIndex(e=>e.matches(":focus"))-1:e.findIndex(e=>e.selected)-1;for(;e[(t+e.length)%e.length].disabled;)t--;return this.noTabCycling&&t<0?null:e[(t+e.length)%e.length]}#E(){let e=this.#p(),t=this.activation===q.MANUAL?e.findIndex(e=>e.matches(":focus"))+1:e.findIndex(e=>e.selected)+1;for(;e[t%e.length].disabled;)t++;return this.noTabCycling&&t>=e.length?null:e[t%e.length]}#I(){let e=this.#p(),t=this.#g();e.forEach(e=>e.selected=!1),t.forEach(e=>e.hidden=!0)}#n(){let e=this.shadowRoot?.querySelector(".tab-group__nav"),t=this.shadowRoot?.querySelector(".tab-group__tabs"),r=Array.from(this.shadowRoot?.querySelectorAll(".tab-group__scroll-button")||[]);this.noScrollControls||this.placement===U.START||this.placement===U.END?(this.#c(),r.forEach(e=>e.hidden=!0),e?.part.remove("nav--has-scroll-controls"),e?.classList.remove("tab-group__nav--has-scroll-controls"),t?.setAttribute("aria-orientation","vertical")):(this.#d(),r.forEach(e=>e.hidden=!1),t?.setAttribute("aria-orientation","horizontal"))}#_(){let e=this.#p(),t=e.find(e=>e.selected&&!e.disabled)||e.find(e=>!e.disabled);t&&(this.#r&&!t.selected&&this.dispatchEvent(new CustomEvent("a-tab-show",{bubbles:!0,composed:!0,detail:{tabId:t.id}})),this.#T(t))}#T(e){this.#I(),e&&(e.selected=!0);let t=this.#y(e);t&&(t.hidden=!1)}#s=e=>{this.#m(),this.#n(),this.#_(),"tab"===e.target.name&&(this.#r=!0)};#o=e=>{if("a-tab"!==e.target.tagName.toLowerCase()||e.altKey)return;let t=z.includes(this.placement||"")?this.placement:U.TOP,r=[U.TOP,U.BOTTOM].includes(t||"")?"horizontal":"vertical",n=this.#f(),i=null;switch(e.key){case j.LEFT:"horizontal"===r&&(i=n===B.LTR?this.#w():this.#E())&&(this.activation===q.MANUAL?i.focus():this.selectTab(i));break;case j.RIGHT:"horizontal"===r&&(i=n===B.LTR?this.#E():this.#w())&&(this.activation===q.MANUAL?i.focus():this.selectTab(i));break;case j.UP:"vertical"===r&&(i=this.#w())&&(this.activation===q.MANUAL?i.focus():this.selectTab(i));break;case j.DOWN:"vertical"===r&&(i=this.#E())&&(this.activation===q.MANUAL?i.focus():this.selectTab(i));break;case j.HOME:(i=this.#v())&&(this.activation===q.MANUAL?i.focus():this.selectTab(i));break;case j.END:(i=this.#b())&&(this.activation===q.MANUAL?i.focus():this.selectTab(i));break;case j.ENTER:case j.SPACE:(i=e.target)&&this.selectTab(i);break;default:return}e.preventDefault()};#a=e=>{let t=e.target.closest("a-tab");t&&this.selectTab(t)};#l=e=>{let t=e.target.closest(".tab-group__scroll-button"),r=this.shadowRoot?.querySelector(".tab-group__tabs");if(!t||!r)return;let n=t.classList.contains("tab-group__scroll-button--start"),i=this.#f()===B.LTR,s=r.scrollLeft;r.scrollTo({left:s+(n?i?-1:1:i?1:-1)*this.scrollDistance})};#u=e=>{let t=e.target,r=this.#y(t);t&&(t.remove(),t.selected&&this.dispatchEvent(new CustomEvent("a-tab-hide",{bubbles:!0,composed:!0,detail:{tabId:t.id}}))),r&&"a-tab-panel"===r.tagName.toLowerCase()&&r.remove()};#i(e){return D(e,this)}selectTabByIndex(e){let t=this.#p()[e];t&&this.selectTab(t)}selectTabById(e){let t=this.#p().find(t=>t.id===e);t&&this.selectTab(t)}selectTab(e){let t=this.#p().find(e=>e.selected);!e||e.disabled||e.selected||"a-tab"!==e.tagName.toLowerCase()||(this.#T(e),window.requestAnimationFrame(()=>{e.scrollIntoView({inline:"nearest",block:"nearest"}),e.focus()}),t&&this.dispatchEvent(new CustomEvent("a-tab-hide",{bubbles:!0,composed:!0,detail:{tabId:t.id}})),this.dispatchEvent(new CustomEvent("a-tab-show",{bubbles:!0,composed:!0,detail:{tabId:e.id}})))}static defineCustomElement(t="a-tab-group"){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}}).defineCustomElement();var K=`
  :host {
    display: inline-block;
  }
`,G=document.createElement("template");G.innerHTML=`
  <style>${K}</style>
  <slot name="button"><button type="button" part="button"><slot name="button-content">Share</slot></button></slot>
`,(class e extends HTMLElement{#e;#p;#E=[];constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open",delegatesFocus:!0}).appendChild(G.content.cloneNode(!0)),this.#e=this.shadowRoot?.querySelector('slot[name="button"]')||null,this.#p=this.#h()}static get observedAttributes(){return["disabled"]}attributeChangedCallback(e,t,r){"disabled"===e&&t!==r&&this.#p&&(this.#p.toggleAttribute("disabled",this.disabled),this.#p.setAttribute("aria-disabled",this.disabled.toString()),this.#p.part&&this.#p.part.contains("button")&&this.#p.part.toggle("button--disabled",this.disabled))}connectedCallback(){this.#t("shareUrl"),this.#t("shareTitle"),this.#t("shareText"),this.#t("shareFiles"),this.#t("disabled"),this.#e?.addEventListener("slotchange",this.#w),this.#p?.addEventListener("click",this.#n)}disconnectedCallback(){this.#e?.removeEventListener("slotchange",this.#w),this.#p?.removeEventListener("click",this.#n)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}get shareUrl(){return this.getAttribute("share-url")||""}set shareUrl(e){this.setAttribute("share-url",e)}get shareTitle(){return this.getAttribute("share-title")||""}set shareTitle(e){this.setAttribute("share-title",e)}get shareText(){return this.getAttribute("share-text")||""}set shareText(e){this.setAttribute("share-text",e)}get shareFiles(){return this.#E}set shareFiles(e){Array.isArray(e)&&e.length>0&&(this.#E=e)}async share(){if(!this.disabled)try{let e={};this.shareUrl&&(e.url=this.shareUrl),this.shareTitle&&(e.title=this.shareTitle),this.shareText&&(e.text=this.shareText),Array.isArray(this.shareFiles)&&this.shareFiles.length>0&&navigator.canShare&&navigator.canShare({files:this.shareFiles})&&(e.files=this.shareFiles),await navigator.share(e),this.dispatchEvent(new CustomEvent("web-share:success",{bubbles:!0,composed:!0,detail:{shareData:e}}))}catch(e){if(e instanceof Error&&"AbortError"===e.name)return void this.dispatchEvent(new CustomEvent("web-share:abort",{bubbles:!0,composed:!0,detail:{error:e}}));this.dispatchEvent(new CustomEvent("web-share:error",{bubbles:!0,composed:!0,detail:{error:e}}))}}#n=e=>{e.preventDefault(),this.disabled||this.share()};#w=e=>{e.target&&"button"===e.target.name&&(this.#p?.removeEventListener("click",this.#n),this.#p=this.#h(),this.#p&&(this.#p.addEventListener("click",this.#n),"BUTTON"===this.#p.nodeName||this.#p.hasAttribute("role")||this.#p.setAttribute("role","button")))};#h(){return this.#e&&this.#e.assignedElements({flatten:!0}).find(e=>"BUTTON"===e.nodeName||"button"===e.getAttribute("slot"))||null}#t(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}static defineCustomElement(t="web-share"){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}}).defineCustomElement();var W=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["jxl","image/jxl"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["markdown","text/markdown"],["md","text/markdown"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]),Q=[".DS_Store","Thumbs.db"],Y=e=>{let{name:t}=e;if(t&&-1!==t.lastIndexOf(".")&&!e.type){let r=(t.split(".").pop()||"").toLowerCase(),n=W.get(r);n&&Object.defineProperty(e,"type",{value:n,writable:!1,configurable:!1,enumerable:!0})}return e},J=(e,t)=>{let r=Y(e);if("string"!=typeof r.path){let{webkitRelativePath:n}=e;Object.defineProperty(r,"path",{value:"string"==typeof t?t:n||e.name,writable:!1,configurable:!1,enumerable:!0})}return r},X=async e=>await new Promise((t,r)=>{e.readEntries(t,r)}),Z=async e=>{let t=[],r=await X(e);for(;r.length>0;)t.push(...r),r=await X(e);return t},ee=e=>new Promise((t,r)=>{e.file(r=>t(J(r,e.fullPath)),r)}),et=async e=>{let t=[],r=[];for(let t of e){if("file"!==t.kind)continue;let e=t.getAsEntry?t.getAsEntry():t.webkitGetAsEntry();r.push(e)}for(;r.length>0;){let e=r.shift();if(e)if(e.isFile){let r=await ee(e);-1===Q.indexOf(r.name)&&t.push(r)}else e.isDirectory&&r.push(...await Z(e.createReader()))}return t},er=async e=>{let t=[];for(let r of e)-1===Q.indexOf(r.name)&&t.push(J(r));return t},en=async e=>e.dataTransfer?e.dataTransfer.items?await et(e.dataTransfer.items):await er(e.dataTransfer.files):await er(e.target.files),ei="files-dropzone",es="TOO_MANY_FILES",ea=document.createElement("template"),eo=`
  *,
  *::before,
  *::after {
    box-sizing: border-box;
  }

  :host([hidden]),
  [hidden] {
    display: none !important;
  }

  :host {
    --dropzone-border-width: 2px;
    --dropzone-border-style: dashed;
    --dropzone-border-radius: 0.25rem;
    --dropzone-border-color: #6c757d;
    --dropzone-border-color-dragover: #0d6efd;
    --dropzone-border-color-hover: var(--dropzone-border-color-dragover);
    --dropzone-background-color: #ffffff;
    --dropzone-background-color-dragover: #f4f4f5;
    --dropzone-background-color-hover: var(--dropzone-background-color-dragover);
    --dropzone-body-color: #3f3f46;
    --dropzone-body-color-dragover: var(--dropzone-body-color);
    --dropzone-body-color-hover: var(--dropzone-body-color-dragover);
    --dropzone-focus-shadow-rgb: 49,132,253;
    --dropzone-focus-box-shadow: 0 0 0 0.25rem rgba(var(--dropzone-focus-shadow-rgb), 0.5);
    --transition-duration: 0.2s; /* for backwards compatibility */
    --dropzone-transition-duration: var(--transition-duration);

    display: block;
  }

  :host(:not([no-style])) .dropzone {
    border: var(--dropzone-border-width) var(--dropzone-border-style) var(--dropzone-border-color);
    border-radius: var(--dropzone-border-radius);
    padding: 3rem 1rem;
    overflow: hidden;
    background-color: var(--dropzone-background-color);
    color: var(--dropzone-body-color);
    text-align: center;
    cursor: pointer;
    transition: border var(--dropzone-transition-duration) ease-in-out, background-color var(--dropzone-transition-duration) ease-in-out, color var(--dropzone-transition-duration) ease-in-out, box-shadow var(--dropzone-transition-duration) ease-in-out;
  }

  :host(:not([no-style])[disabled]) .dropzone {
    opacity: 0.8;
    cursor: not-allowed;
    user-select: none;
  }

  :host(:not([no-style]):not([disabled])) .dropzone--dragover {
    border-color: var(--dropzone-border-color-dragover);
    background-color: var(--dropzone-background-color-dragover);
    color: var(--dropzone-body-color-dragover);
  }

  :host(:not([no-style]):not([disabled])) .dropzone:focus-visible {
    outline: none;
    box-shadow: var(--dropzone-focus-box-shadow);
  }

  @media (hover: hover) {
    :host(:not([no-style]):not([disabled])) .dropzone:not(.dropzone--dragover):hover {
      border-color: var(--dropzone-border-color-hover);
      background-color: var(--dropzone-background-color-hover);
      color: var(--dropzone-body-color-hover);
    }
  }
`;ea.innerHTML=`
  <style>
    ${eo}
  </style>

  <input type="file" id="file-input" hidden>

  <div part="dropzone" class="dropzone" id="dropzone" tabindex="0" role="button" aria-disabled="false">
    <slot>Drag 'n' drop files here, or click to select files</slot>
  </div>
`,(class e extends HTMLElement{#p=null;#e=null;constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open",delegatesFocus:!0}).appendChild(ea.content.cloneNode(!0)),this.shadowRoot&&(this.#p=this.shadowRoot.getElementById("file-input"),this.#e=this.shadowRoot.getElementById("dropzone"))}static get observedAttributes(){return["accept","disabled","multiple"]}attributeChangedCallback(e,t,r){"accept"===e&&t!==r&&this.#p&&(this.#p.accept=this.accept),"disabled"===e&&t!==r&&this.#p&&(this.#p.disabled=this.disabled,this.disabled?(this.#e?.removeAttribute("tabindex"),this.#e?.setAttribute("aria-disabled","true")):(this.#e?.setAttribute("tabindex","0"),this.#e?.setAttribute("aria-disabled","false"))),"multiple"===e&&t!==r&&this.#p&&(this.#p.multiple=this.multiple)}connectedCallback(){this.#i("accept"),this.#i("disabled"),this.#i("maxFiles"),this.#i("maxSize"),this.#i("minSize"),this.#i("multiple"),this.#i("autoFocus"),this.#i("noStyle"),this.#p?.addEventListener("change",this.#n),this.#e?.addEventListener("dragenter",this.#E),this.#e?.addEventListener("dragover",this.#t),this.#e?.addEventListener("dragleave",this.#s),this.#e?.addEventListener("drop",this.#w),this.#e?.addEventListener("click",this.#f),this.#e?.addEventListener("keyup",this.#r),this.autoFocus&&this.#e?.focus()}disconnectedCallback(){this.#p?.removeEventListener("change",this.#n),this.#e?.removeEventListener("dragenter",this.#E),this.#e?.removeEventListener("dragover",this.#t),this.#e?.removeEventListener("dragleave",this.#s),this.#e?.removeEventListener("drop",this.#w),this.#e?.removeEventListener("click",this.#f),this.#e?.removeEventListener("keyup",this.#r)}get accept(){return this.getAttribute("accept")||""}set accept(e){this.setAttribute("accept",null!=e?e.toString():e)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}get maxFiles(){let e=Number(this.getAttribute("max-files"))||0;return e<=0?1/0:Math.floor(Math.abs(e))}set maxFiles(e){this.setAttribute("max-files",null!=e?e.toString():e)}get maxSize(){let e=this.getAttribute("max-size");if(null===e)return 1/0;let t=Number(e);return Number.isNaN(t)?1/0:t}set maxSize(e){this.setAttribute("max-size",null!=e?e.toString():e)}get minSize(){let e=this.getAttribute("min-size");if(null===e)return 0;let t=Number(e);return Number.isNaN(t)?0:t}set minSize(e){this.setAttribute("min-size",null!=e?e.toString():e)}get multiple(){return this.hasAttribute("multiple")}set multiple(e){this.toggleAttribute("multiple",!!e)}get autoFocus(){return this.hasAttribute("auto-focus")}set autoFocus(e){this.toggleAttribute("auto-focus",!!e)}get noStyle(){return this.hasAttribute("no-style")}set noStyle(e){this.toggleAttribute("no-style",!!e)}#n=async e=>{try{this.#c(await en(e))}catch(e){this.dispatchEvent(new CustomEvent(`${ei}-error`,{bubbles:!0,composed:!0,detail:{error:e}}))}};#E=()=>{this.disabled||this.dispatchEvent(new Event(`${ei}-dragenter`,{bubbles:!0,composed:!0}))};#t=e=>{if(e.preventDefault(),this.disabled){e.dataTransfer.dropEffect="none";return}e.dataTransfer.dropEffect="copy",this.#e&&(this.#e.classList.add("dropzone--dragover"),this.#e.part.add("dropzone--dragover")),this.dispatchEvent(new Event(`${ei}-dragover`,{bubbles:!0,composed:!0}))};#s=()=>{this.disabled||(this.#e&&(this.#e.classList.remove("dropzone--dragover"),this.#e.part.remove("dropzone--dragover")),this.dispatchEvent(new Event(`${ei}-dragleave`,{bubbles:!0,composed:!0})))};#w=async e=>{if(!this.disabled){e.preventDefault(),this.#e&&(this.#e.classList.remove("dropzone--dragover"),this.#e.part.remove("dropzone--dragover"));try{this.#c(await en(e))}catch(e){this.dispatchEvent(new CustomEvent(`${ei}-error`,{bubbles:!0,composed:!0,detail:{error:e}}))}}};#f=()=>{this.disabled||this.#p?.click()};#r=e=>{this.disabled||(" "===e.key||"Enter"===e.key)&&this.#p?.click()};#c(e){if(!Array.isArray(e)||!e.length)return;let t=[],r=[],n=e.length;if(!this.multiple&&n>1)for(let t of e)r.push({file:t,errors:[{code:es,message:"Too many files selected. Only 1 file is allowed."}]});else if(this.multiple&&n>this.maxFiles)for(let t of e)r.push({file:t,errors:[{code:es,message:`Too many files selected. Only ${this.maxFiles} ${this.maxFiles>1?"files are":"file is"} allowed.`}]});else for(let n of e){let e=function(e,t=""){if(!t)return!0;let r=[...new Set(t.split(",").map(e=>e.trim()).filter(Boolean))],n=e.type,i=n.replace(/\/.*$/,"");for(let t of r)if("."===t.charAt(0)){if(-1!==e.name.toLowerCase().indexOf(t.toLowerCase(),e.name.length-t.length))return!0}else if(/\/\*$/.test(t)){if(i===t.replace(/\/.*$/,""))return!0}else if(n===t)return!0;return!1}(n,this.accept),i=n.size>this.maxSize,s=n.size<this.minSize;if(!e||i||s){let t=[];e||t.push({code:"INVALID_MIME_TYPE",message:`File type "${n.type}" is not accepted.`}),i&&t.push({code:"FILE_TOO_LARGE",message:`File size ${n.size} exceeds the maximum size of ${this.maxSize}.`}),s&&t.push({code:"FILE_TOO_SMALL",message:`File size ${n.size} is smaller than the minimum size of ${this.minSize}.`}),r.push({file:n,errors:t})}else t.push(n)}this.dispatchEvent(new CustomEvent(`${ei}-drop`,{bubbles:!0,composed:!0,detail:{acceptedFiles:t,rejectedFiles:r}})),t.length>0&&this.dispatchEvent(new CustomEvent(`${ei}-drop-accepted`,{bubbles:!0,composed:!0,detail:{acceptedFiles:t}})),r.length>0&&this.dispatchEvent(new CustomEvent(`${ei}-drop-rejected`,{bubbles:!0,composed:!0,detail:{rejectedFiles:r}})),this.#p&&(this.#p.value=this.#p.defaultValue)}openFileDialog(){this.disabled||this.#p?.click()}#i(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}static defineCustomElement(t=ei){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}}).defineCustomElement();var el=document.createElement("template");el.innerHTML=`
  <style>:host { display: contents; }</style>
  <slot></slot>
`,(class e extends HTMLElement{#e=null;#p=null;#t=[];constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(el.content.cloneNode(!0)),this.#e=this.shadowRoot?.querySelector("slot")??null}static get observedAttributes(){return["disabled"]}attributeChangedCallback(e,t,r){"disabled"===e&&t!==r&&(this.disabled?this.#i():this.#n())}connectedCallback(){this.#f("disabled"),"ResizeObserver"in window&&(this.#p=new ResizeObserver(e=>{this.dispatchEvent(new CustomEvent("resize-observer:resize",{bubbles:!0,composed:!0,detail:{entries:e}}))}),this.disabled||this.#n(),this.#e?.addEventListener("slotchange",this.#s))}disconnectedCallback(){this.#i(),this.#e?.removeEventListener("slotchange",this.#s)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}#n(){this.#e&&this.#p&&(this.#t.forEach(e=>this.#p?.unobserve(e)),this.#t=[],this.#e.assignedElements().forEach(e=>{this.#p?.observe(e),this.#t.push(e)}))}#i(){this.#p?.disconnect()}#s=()=>{this.disabled||this.#n()};#f(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}static defineCustomElement(t="resize-observer"){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}}).defineCustomElement();var eu=document.createElement("template"),eh=`
  :host {
    --me-width: 32rem;
    --me-height: fit-content;
    --me-border-color: initial;
    --me-border-style: solid;
    --me-border-width: initial;
    --me-border-radius: 0;
    --me-box-shadow: none;
    --me-background-color: canvas;
    --me-color: canvastext;

    --me-header-spacing: 1rem;
    --me-footer-spacing: 1rem;
    --me-header-background-color: transparent;
    --me-header-color: initial;

    --me-body-spacing: 1rem;
    --me-body-background-color: transparent;
    --me-body-color: initial;
    --me-footer-background-color: transparent;
    --me-footer-color: initial;

    --me-close-padding: 0.4375rem;
    --me-close-border: none;
    --me-close-border-radius: 0;
    --me-close-background-color: transparent;
    --me-close-color: inherit;
    --me-close-font-size: 1rem;

    --me-backdrop-background: rgba(0, 0, 0, 0.5);
    --me-backdrop-filter: none;

    display: contents;
    box-sizing: border-box;
  }

  :host *,
  :host *:after,
  :host *:before {
    box-sizing: inherit;
  }

  :host([hidden]),
  [hidden] {
    display: none !important;
  }

  /* Dialog */
  .dialog {
    --dialog-placement-margin: calc((2em + 6px) / 2);

    width: var(--me-width);
    height: var(--me-height);
    padding: 0;
    border-color: var(--me-border-color);
    border-style: var(--me-border-style);
    border-width: var(--me-border-width);
    border-radius: var(--me-border-radius);
    box-shadow: var(--me-box-shadow);
    background-color: var(--me-background-color);
    color: var(--me-color);
  }

  .dialog[open] {
    display: flex;
  }

  :host([fullscreen]) .dialog {
    max-width: 100%;
    max-height: 100%;
    width: 100%;
    height: 100%;
  }

  .dialog::backdrop {
    background: var(--me-backdrop-background, rgba(0, 0, 0, 0.5));
    backdrop-filter: var(--me-backdrop-filter, none);
    opacity: 0;
  }

  .dialog[open]::backdrop {
    opacity: 1;
  }

  /* Dialog placement */
  :host(:not([fullscreen])[placement="top-start"]) .dialog {
    margin-block-start: var(--dialog-placement-margin);
    margin-inline-start: var(--dialog-placement-margin);
  }

  :host(:not([fullscreen])[placement="top-center"]) .dialog {
    margin-block-start: var(--dialog-placement-margin);
  }

  :host(:not([fullscreen])[placement="top-end"]) .dialog {
    margin-block-start: var(--dialog-placement-margin);
    margin-inline-end: var(--dialog-placement-margin);
  }

  :host(:not([fullscreen])[placement="center-start"]) .dialog {
    margin-inline-start: var(--dialog-placement-margin);
  }

  :host(:not([fullscreen])[placement="center"]) .dialog {
    margin: auto;
  }

  :host(:not([fullscreen])[placement="center-end"]) .dialog {
    margin-inline-end: var(--dialog-placement-margin);
  }

  :host(:not([fullscreen])[placement="bottom-start"]) .dialog {
    margin-block-end: var(--dialog-placement-margin);
    margin-inline-start: var(--dialog-placement-margin);
  }

  :host(:not([fullscreen])[placement="bottom-center"]) .dialog {
    margin-block-end: var(--dialog-placement-margin);
  }

  :host(:not([fullscreen])[placement="bottom-end"]) .dialog {
    margin-block-end: var(--dialog-placement-margin);
    margin-inline-end: var(--dialog-placement-margin);
  }

  /* Dialog animations */
  @media (prefers-reduced-motion: no-preference) {
    .dialog:not(.dialog--no-animations),
    .dialog:not(.dialog--no-animations)::backdrop {
      transition: transform 0.3s, opacity 0.3s, display 0.3s allow-discrete, overlay 0.3s allow-discrete;
    }

    /* 1. IS-OPEN STATE */
    .dialog[open]:not(.dialog--no-animations) {
      transform: scale(1);
      opacity: 1;
    }

    /* 2. EXIT STATE */
    .dialog:not(.dialog--no-animations) {
      transform: scale(0.95);
      opacity: 0;
    }

    /* 0. BEFORE-OPEN STATE */
    @starting-style {
      .dialog[open]:not(.dialog--no-animations) {
        transform: scale(0.95);
        opacity: 0;
      }

      .dialog[open]:not(.dialog--no-animations)::backdrop {
        opacity: 0;
      }
    }

    .dialog--pulse:not(.dialog--no-animations) {
      animation-name: pulse;
      animation-duration: 300ms;
      animation-timing-function: cubic-bezier(0.2, 0, 0.38, 0.9);
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
  }

  /* Dialog panel, header, body, footer */
  .dialog__panel {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    width: 100%;
  }

  .dialog__header {
    display: flex;
    align-items: center;
    padding: var(--me-header-spacing);
    column-gap: 0.5rem;
    background-color: var(--me-header-background-color);
    color: var(--me-header-color);
  }

  :host([no-close-button]) .dialog__header {
    column-gap: 0;
  }

  .dialog__title {
    display: block;
    flex: 1 1 auto;
    padding: 0;
    margin: 0;
  }

  .dialog__body {
    display: block;
    flex: 1 1 auto;
    padding: var(--me-body-spacing);
    overflow: auto;
    background-color: var(--me-body-background-color);
    color: var(--me-body-color);
    overscroll-behavior: contain;
  }

  .dialog__footer {
    flex: 0 0 auto;
    text-align: end;
    padding: var(--me-footer-spacing);
    background-color: var(--me-footer-background-color);
    color: var(--me-footer-color);
  }

  .dialog__close {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: var(--me-close-padding);
    border: var(--me-close-border);
    border-radius: var(--me-close-border-radius);
    background-color: var(--me-close-background-color);
    color: var(--me-close-color);
    font-size: var(--me-close-font-size);
  }

  .dialog__close:not(:disabled) {
    cursor: pointer;
  }

  .dialog__close:disabled {
    cursor: not-allowed;
  }
`;eu.innerHTML=`
  <style>${eh}</style>

  <dialog part="base" class="dialog">
    <div part="panel" class="dialog__panel" aria-labelledby="title">
      <header part="header" class="dialog__header">
        <slot name="header" part="title" class="dialog__title" id="title"></slot>

        <form method="dialog">
          <button type="submit" part="close" class="dialog__close" aria-label="Close">
            <slot name="close">
              <svg part="close-icon" xmlns="http://www.w3.org/2000/svg" width="1.125em" height="1.125em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
              </svg>
            </slot>
          </button>
        </form>
      </header>

      <slot part="body" class="dialog__body"></slot>

      <footer part="footer" class="dialog__footer" hidden>
        <slot name="footer"></slot>
      </footer>
    </div>
  </dialog>
`,(class e extends HTMLElement{#e=null;#w=null;#t=null;#i=void 0;constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(eu.content.cloneNode(!0)),this.shadowRoot&&(this.#e=this.shadowRoot.querySelector("dialog"),this.#w=this.shadowRoot.querySelector('slot[name="footer"]'),this.#t=this.shadowRoot.querySelector('slot[name="close"]'))}static get observedAttributes(){return["open","no-header","no-animations","no-close-button","close-label"]}attributeChangedCallback(e,t,r){if(null!==this.#e){if("open"===e&&t!==r&&(this.open?(this.#e.showModal(),this.dispatchEvent(new CustomEvent("me-open",{bubbles:!0,composed:!0,detail:{element:this}})),document.body&&!this.preserveOverflow&&(document.body.style.overflow="hidden")):this.#e.close()),"no-header"===e&&t!==r){let e=this.#e.querySelector(".dialog__header");null!==e&&(e.hidden=this.noHeader)}if("no-animations"===e&&t!==r&&this.#e.classList.toggle("dialog--no-animations",this.noAnimations),"no-close-button"===e&&t!==r){let e=this.#e.querySelector(".dialog__close");null!==e&&(e.hidden=this.noCloseButton)}"close-label"===e&&t!==r&&this.#E()}}connectedCallback(){this.#p("open"),this.#p("staticBackdrop"),this.#p("noHeader"),this.#p("noAnimations"),this.#p("noCloseButton"),this.#p("fullscreen"),this.#p("preserveOverflow"),this.#p("placement"),this.#p("closeLabel"),this.#e?.addEventListener("click",this.#h),this.#e?.addEventListener("close",this.#r),this.#e?.addEventListener("cancel",this.#f),this.#e?.querySelector('form[method="dialog"]')?.addEventListener("submit",this.#c),this.#w?.addEventListener("slotchange",this.#a),this.#t?.addEventListener("slotchange",this.#T),this.addEventListener("command",this.#u)}disconnectedCallback(){this.#i&&clearTimeout(this.#i),this.#e?.addEventListener("click",this.#h),this.#e?.removeEventListener("close",this.#r),this.#e?.removeEventListener("cancel",this.#f),this.#e?.querySelector('form[method="dialog"]')?.removeEventListener("submit",this.#c),this.#w?.removeEventListener("slotchange",this.#a),this.#t?.removeEventListener("slotchange",this.#T),this.removeEventListener("command",this.#u)}get open(){return this.hasAttribute("open")}set open(e){this.toggleAttribute("open",!!e)}get staticBackdrop(){return this.hasAttribute("static-backdrop")}set staticBackdrop(e){this.toggleAttribute("static-backdrop",!!e)}get noHeader(){return this.hasAttribute("no-header")}set noHeader(e){this.toggleAttribute("no-header",!!e)}get noAnimations(){return this.hasAttribute("no-animations")}set noAnimations(e){this.toggleAttribute("no-animations",!!e)}get noCloseButton(){return this.hasAttribute("no-close-button")}set noCloseButton(e){this.toggleAttribute("no-close-button",!!e)}get fullscreen(){return this.hasAttribute("fullscreen")}set fullscreen(e){this.toggleAttribute("fullscreen",!!e)}get preserveOverflow(){return this.hasAttribute("preserve-overflow")}set preserveOverflow(e){this.toggleAttribute("preserve-overflow",!!e)}get placement(){return this.getAttribute("placement")||"center"}set placement(e){this.setAttribute("placement",null!=e?e.toString():e)}get closeLabel(){return this.getAttribute("close-label")||"Close"}set closeLabel(e){this.setAttribute("close-label",null!=e?e.toString():e)}#E(){if(null===this.#e)return;let e=this.#e.querySelector(".dialog__close");null!==e&&((this.#t?.assignedElements()||[])?.some(e=>e.textContent?.replace(/\s/g,"")!=="")?e.removeAttribute("aria-label"):e.setAttribute("aria-label",this.closeLabel))}#n(){this.#i||(this.#e?.classList.add("dialog--pulse"),this.#i=setTimeout(()=>{this.#e?.classList.remove("dialog--pulse"),clearTimeout(this.#i),this.#i=void 0},300))}#r=()=>{this.open=!1,this.dispatchEvent(new CustomEvent("me-close",{bubbles:!0,composed:!0,detail:{element:this}})),document.body&&!this.preserveOverflow&&(document.body.style.overflow="")};#f=e=>{let t=this.#s("escape-key");this.dispatchEvent(t),t.defaultPrevented&&(e.preventDefault(),this.noAnimations||this.#n())};#c=e=>{let t=this.#s("close-button");this.dispatchEvent(t),t.defaultPrevented&&(e.preventDefault(),this.noAnimations||this.#n())};#h=e=>{let t=e.target;if(t===e.currentTarget){let e=this.#s("backdrop-click");this.dispatchEvent(e),e.defaultPrevented||this.staticBackdrop?this.noAnimations||this.#n():this.hide()}if(t instanceof HTMLElement&&null!==t.closest("[data-me-close]")){let e=this.#s("external-invoker");this.dispatchEvent(e),e.defaultPrevented?this.noAnimations||this.#n():this.hide()}};#u=e=>{if("--me-open"!==e.command||this.open||this.show(),"--me-close"===e.command&&this.open){let e=this.#s("external-invoker");this.dispatchEvent(e),e.defaultPrevented?this.noAnimations||this.#n():this.hide()}};#a=()=>{if(null===this.#e)return;let e=this.#e.querySelector(".dialog__footer");if(null===e)return;let t=this.#w?.assignedNodes();e.hidden=!(t&&t.length>0)};#T=()=>{this.#E()};#s(e){return new CustomEvent("me-request-close",{bubbles:!0,composed:!0,cancelable:!0,detail:{reason:e,element:this}})}#p(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}show(){this.open||(this.open=!0)}hide(){this.open&&(this.open=!1)}static defineCustomElement(t="modal-element"){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}}).defineCustomElement();var ec="alert-element",ed="alert-after-show",ef="alert-after-hide",ep=(n=(r=Object.assign(document.createElement("div"),{className:"alert-toast-stack"})).attachShadow({mode:"open"}),i=`
    :host {
      display: contents;
      box-sizing: border-box;
    }

    :host *,
    :host *::before,
    :host *::after {
      box-sizing: inherit;
    }

    .stack {
      position: fixed;
      top: 0;
      right: 0;
      z-index: 1000;
      width: 30rem;
      max-width: 100%;
      max-height: 100%;
      overflow: auto;
      scrollbar-width: none;
    }

    @media (prefers-reduced-motion: no-preference) {
      .stack {
        scroll-behavior: smooth;
      }
    }

    .stack > ::slotted(*) {
      margin: 1rem;
    }
  `,n.innerHTML=`
    <style>${i}</style>
    <div class="stack" part="base"><slot></slot></div>
  `,r),em=`
  :host {
    display: contents;
    box-sizing: border-box;

    --alert-border-radius: 0.25rem;
    --alert-fg-color: #3f3f46;
    --alert-bg-color: #ffffff;
    --alert-border-color: #e4e4e7;
    --alert-info-variant-color: #0584c7;
    --alert-success-variant-color: #16a34a;
    --alert-neutral-variant-color: #52525b;
    --alert-warning-variant-color: #d87708;
    --alert-danger-variant-color: #dc2626;
  }

  @media (prefers-color-scheme: dark) {
    :host {
      --alert-fg-color: #b6b6be;
      --alert-bg-color: #252528;
      --alert-border-color: #36363a;
      --alert-info-variant-color: #27bbfc;
      --alert-success-variant-color: #3ae075;
      --alert-neutral-variant-color: #8e8e9a;
      --alert-warning-variant-color: #ffbd11;
      --alert-danger-variant-color: #fe5c5c;
    }
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  :host([hidden]),
  [hidden],
  ::slotted([hidden]) {
    display: none !important;
  }

  .alert {
    display: flex;
    align-items: center;
    margin: inherit;
    border: 1px solid var(--alert-border-color);
    border-top-width: 3px;
    border-radius: var(--alert-border-radius);
    background-color: var(--alert-bg-color);
  }

  :host([variant='info']) .alert {
    border-top-color: var(--alert-info-variant-color);
  }

  :host([variant='success']) .alert {
    border-top-color: var(--alert-success-variant-color);
  }

  :host([variant='neutral']) .alert {
    border-top-color: var(--alert-neutral-variant-color);
  }

  :host([variant='warning']) .alert {
    border-top-color: var(--alert-warning-variant-color);
  }

  :host([variant='danger']) .alert {
    border-top-color: var(--alert-danger-variant-color);
  }

  .alert__icon {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    color: var(--alert-fg-color);
    font-size: inherit;
    line-height: 0;
  }

  .alert__icon ::slotted(*) {
    margin-inline-start: 1rem;
  }

  :host([variant='info']) .alert__icon {
    color: var(--alert-info-variant-color);
  }

  :host([variant='success']) .alert__icon {
    color: var(--alert-success-variant-color);
  }

  :host([variant='neutral']) .alert__icon {
    color: var(--alert-neutral-variant-color);
  }

  :host([variant='warning']) .alert__icon {
    color: var(--alert-warning-variant-color);
  }

  :host([variant='danger']) .alert__icon {
    color: var(--alert-danger-variant-color);
  }

  .alert__message {
    flex: 1 1 auto;
    padding: 1.25rem;
    overflow: hidden;
    color: var(--alert-fg-color);
    line-height: 1.5;
  }

  .alert__close {
    display: flex;
    align-items: center;
    margin-inline-end:  1rem;
    padding: 0.5rem;
    border: none;
    line-height: 0;
    background: transparent;
    color: var(--alert-fg-color);
    font-size: inherit;
    cursor: pointer;
  }

  :host(:not([closable])) .alert__close {
    display: none !important;
  }
`,eg=document.createElement("template");eg.innerHTML=`
  <style>${em}</style>
  <div class="alert" part="base" role="alert" hidden>
    <div class="alert__icon" part="icon">
      <slot name="icon"></slot>
    </div>
    <div class="alert__message" part="message" aria-live="polite">
      <slot></slot>
    </div>
    <button type="button" class="alert__close" part="close" aria-label="Close">
      <slot name="close">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
          <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
        </svg>
      </slot>
    </button>
  </div>
`,(class e extends HTMLElement{#p=null;#i=null;#w=null;#s=void 0;#e=null;#T;static customAnimations;#t="api";constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(eg.content.cloneNode(!0))}static get observedAttributes(){return["open","duration","close-label"]}attributeChangedCallback(e,t,r){if(!(!this.isConnected||t===r))switch(e){case"open":this.#I();break;case"duration":this.#n(),this.#c()&&this.#r();break;case"close-label":this.#f()}}get closable(){return this.hasAttribute("closable")}set closable(e){this.toggleAttribute("closable",!!e)}get open(){return this.hasAttribute("open")}set open(e){this.toggleAttribute("open",!!e)}get duration(){let e=this.getAttribute("duration");if(null===e)return 1/0;let t=Number(e);return Number.isNaN(t)?1/0:t}set duration(e){this.setAttribute("duration",null!=e?e.toString():e)}get variant(){return this.getAttribute("variant")||""}set variant(e){this.setAttribute("variant",e)}get closeLabel(){return this.getAttribute("close-label")||"Close"}set closeLabel(e){this.setAttribute("close-label",null!=e?e.toString():e)}get customAnimations(){return this.#T}set customAnimations(e){this.#T=e}connectedCallback(){this.#E("closable"),this.#E("open"),this.#E("duration"),this.#E("variant"),this.#E("closeLabel"),this.#E("customAnimations"),this.#p=this.shadowRoot?.querySelector(".alert")??null,this.#i=this.shadowRoot?.querySelector(".alert__close")??null,this.#w=this.shadowRoot?.querySelector('slot[name="close"]')??null,this.#i?.addEventListener("click",this.#u),this.#w?.addEventListener("slotchange",this.#d),this.addEventListener("mouseenter",this.#l),this.addEventListener("mouseleave",this.#o),this.addEventListener("command",this.#y),this.open?(this.#p?.removeAttribute("hidden"),this.#c()&&this.#r()):this.#p?.setAttribute("hidden",""),this.closeLabel&&this.#f()}disconnectedCallback(){this.#n(),this.#i?.removeEventListener("click",this.#u),this.#w?.removeEventListener("slotchange",this.#d),this.removeEventListener("mouseenter",this.#l),this.removeEventListener("mouseleave",this.#o),this.removeEventListener("command",this.#y)}#I(){this.#n(),this.open?(this.#c()&&this.#r(),this.#p?.removeAttribute("hidden"),this.#h("alert-show"),this.#b(this.#p)?.finished.finally(()=>{this.#h(ed)})):(this.#h("alert-hide",{reason:this.#t}),this.#m(this.#p)?.finished.finally(()=>{this.#p?.setAttribute("hidden",""),this.#h(ef,{reason:this.#t}),this.#t="api"}))}#n(){void 0!==this.#s&&(clearTimeout(this.#s),this.#s=void 0)}#r(){this.#s=window.setTimeout(()=>{this.#t="timeout",this.open=!1},this.duration)}#c(){return this.open&&this.duration!==1/0}#u=()=>{this.closable&&(this.#t="user",this.open=!1)};#l=()=>{this.#n()};#o=()=>{this.#n(),this.#c()&&this.#r()};#d=()=>{this.#f()};#y=e=>{switch(e.command){case"--alert-show":this.open=!0;break;case"--alert-hide":this.#t="api",this.open=!1}};#f(){this.#i&&((this.#w?.assignedElements()||[])?.some(e=>e.textContent?.replace(/\s/g,"")!=="")?this.#i.removeAttribute("aria-label"):this.#i.setAttribute("aria-label",this.closeLabel))}#_(){let t=window.matchMedia("(prefers-reduced-motion: reduce)").matches,r={show:{keyframes:[{opacity:0,transform:"scale(0.9)"},{opacity:1,transform:"scale(1)"}],options:{duration:250,easing:"ease"}},hide:{keyframes:[{opacity:1,transform:"scale(1)"},{opacity:0,transform:"scale(0.9)"}],options:{duration:250,easing:"ease"}}},n=this.customAnimations||e.customAnimations||{},i=i=>{let s=n[i]?.options??{},a=r[i].options;return{...a,...s,duration:t||null===this.customAnimations||null===e.customAnimations?0:s.duration??a.duration}};return{show:{keyframes:n.show?.keyframes??r.show.keyframes,options:i("show")},hide:{keyframes:n.hide?.keyframes??r.hide.keyframes,options:i("hide")}}}#b(e){let{keyframes:t,options:r}=this.#_().show;return e?.animate(t,r)}#m(e){let{keyframes:t,options:r}=this.#_().hide;return e?.animate(t,r)}#h(e,t=null){let r=new CustomEvent(e,{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(r)}#a(e,t){return new Promise(r=>{e.addEventListener(t,t=>{t.target===e&&r()},{once:!0})})}show(){return this.open?Promise.resolve():(this.open=!0,this.#a(this,ed))}hide(){return this.open?(this.open=!1,this.#a(this,ef)):Promise.resolve()}toast(e={}){if(e={forceRestart:!1,...e},this.#e){if(!e.forceRestart)return this.#e.promise;this.#e.resolve(),this.#e.cleanup()}let t=()=>{},r=new Promise(e=>t=e),n=()=>{this.#e?.resolve(),this.#e?.cleanup()};this.#e={promise:r,resolve:t,cleanup:()=>{this.removeEventListener(ef,n),this.parentNode===ep&&ep.removeChild(this),ep.querySelector(ec)||ep.remove(),this.open=!1,this.#e=null}},ep.parentElement||document.body.append(ep),ep.appendChild(this),this.#p?.setAttribute("data-toast",""),this.open=!0;let i=ep.shadowRoot?.querySelector(".stack");return i?.scrollTo({top:i.scrollHeight}),this.addEventListener(ef,n,{once:!0}),r}#E(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}static defineCustomElement(t=ec){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}}).defineCustomElement();const ey=["image/jpg","image/jpeg","image/png","image/apng","image/gif","image/webp","image/avif"],ev="https://api.upcdatabase.org";let eb="";if("undefined"!=typeof window){let e=window.location.hostname;("localhost"===e||"127.0.0.1"===e)&&(eb="http://localhost:8787")}const ew=eb;function eE(e){return new Promise(function(t,r){e.oncomplete=e.onsuccess=function(){return t(e.result)},e.onabort=e.onerror=function(){return r(e.error)}})}function eI(){var e,t,r,n;return l||(e="keyval-store",t="keyval",n=function(){if(r)return r;var n=indexedDB.open(e);return n.onupgradeneeded=function(){return n.result.createObjectStore(t)},(r=eE(n)).then(function(e){e.onclose=function(){return r=void 0}},function(){}),r},l=function(e,r){return n().then(function(n){return r(n.transaction(t,e).objectStore(t))})}),l}const e_="barcode-scanner/",eT="settings",eS="history",eA=async e=>{try{return[null,await function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eI();return t("readonly",function(t){return eE(t.get(e))})}(e)]}catch(e){return[e,void 0]}},eC=async(e,t)=>{try{return await function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eI();return r("readwrite",function(r){return r.put(t,e),eE(r.transaction)})}(e,t),[null]}catch(e){return[e]}},ex=async()=>eA(e_+eT),ek=async e=>eC(e_+eT,e),eN=async()=>eA(e_+eS),eR=async e=>{let t=await eC(e_+eS,e);return(async()=>{try{let t="/recipes/save-ingredients";if("undefined"!=typeof window&&window.location){let e=window.location.hostname;t="localhost"===e||"127.0.0.1"===e?`${window.location.protocol}//${e}:8788/recipes/save-ingredients`:`${window.location.origin}/recipes/save-ingredients`}let r=(e||[]).map(e=>"string"==typeof e?e:e.value||e.title||JSON.stringify(e));await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ingredients:r})})}catch(e){console.warn("Failed to sync history to server",e)}})(),t};function eD(e,t=0,r=!1){let n=null;if("function"!=typeof e)throw TypeError("Expected a function for first argument");return(...i)=>{clearTimeout(n),r&&!n&&e(...i),n=setTimeout(()=>{n=null,r||e(...i)},t)}}const eL={info:(...e)=>{},error:(...e)=>{},warn:(...e)=>{}};async function eP(e,t){if(!e||!t)return;let r=e.querySelector(`bs-result[value="${t}"]`);r&&r.remove();let n=document.createElement("bs-result");n.setAttribute("value",t),n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic","true"),e.insertBefore(n,e.firstElementChild),e.scrollTop=0}const eO=(()=>{let e=new(window.AudioContext||window.webkitAudioContext||window.audioContext);if(e)return t=>{let{duration:r,frequency:n,volume:i,type:s,onEnded:a}=t,o=e.createOscillator(),l=e.createGain();o.connect(l),l.connect(e.destination),i&&(l.gain.value=i),n&&(o.frequency.value=n),s&&(o.type=s),"function"==typeof a&&(o.onended=a),o.start(e.currentTime),o.stop(e.currentTime+(r||500)/1e3)}})();async function eM(e=0){if("function"==typeof window.navigator.vibrate)try{window.navigator.vibrate(e)}catch{}}let eF=0;async function eV(e={}){let{success:t=!0}=e,[,r]=await ex();if(!r)return;let n=Date.now();n-eF<1e3||(r.beep&&eO(t?{duration:200,frequency:860,volume:.03,type:"square"}:{duration:300,frequency:200,volume:.05,type:"sawtooth"}),r.vibrate&&eM(t?100:200),eF=n)}function eU(e,t){if(!e||!t)return;let r=e.getBoundingClientRect();t.style.cssText=`width: ${r.width}px; height: ${r.height}px`}const eB=["aztec","code_128","code_39","code_93","codabar","data_matrix","ean_13","ean_8","itf","pdf417","qr_code","upc_a","upc_e"];class ez{static async polyfill(){if("BarcodeDetector"in window)eL.info("Using the native BarcodeDetector API.");else try{await N("3jPiW"),eL.info("Using BarcodeDetector polyfill.")}catch(e){throw Error("BarcodeDetector API is not supported by your browser.",{cause:e})}}static async getSupportedFormats(){let e=await window.BarcodeDetector.getSupportedFormats()||[];return eB.filter(t=>e.includes(t))}static async create(e){let t=Array.isArray(e)&&e.length>0?e:await ez.getSupportedFormats();return new ez(t)}static async setup(){try{return await ez.polyfill(),{barcodeReaderError:null}}catch(e){return{barcodeReaderError:e}}}constructor(e){this.barcodeReader=new window.BarcodeDetector({formats:e})}async detect(e){if(!this.barcodeReader)throw Error("BarcodeReader is not initialized.");let t=await this.barcodeReader.detect(e);if(Array.isArray(t)&&t.length>0){let e=t[0];return eL.info({rawValue:e.rawValue,format:e.format}),e}throw Error("Could not detect barcode from provided source.")}}const eq=e=>e.replace(/\/+$/,"");async function ej(e){if(!e||!/^[0-9]{12,14}$/.test(e))return null;if(!ev)return eL.info("Item info API URL not configured; skipping lookup."),null;let t="undefined"!=typeof window&&window?.location,r=ew||"";if(!r&&t){let e=window.location.hostname;("localhost"===e||"127.0.0.1"===e)&&(r="http://localhost:8787")}let n=eq(r&&r.length>0?r:ev),i={};async function s(e,t={}){try{let r=await fetch(e,{headers:i,...t});if(!r.ok)return{status:r.status,json:null};try{let e=await r.json();return{status:r.status,json:e}}catch(e){return eL.warn("Non-JSON response from item API",e),{status:r.status,json:null}}}catch(e){return eL.warn("Request failed",e),{status:0,json:null}}}let a=`${n}/product/${encodeURIComponent(e)}`,o=await s(a,{method:"GET"});if(o.json)return o.json;let l=`${n}/products/${encodeURIComponent(e)}`,u=await s(l,{method:"GET"});if(u.json)return u.json;let h=await s(l,{method:"POST"});return h.json?h.json:null}function e$(e={}){let{el:t,isTorchOn:r}={...{el:document.getElementById("torchButton"),isTorchOn:!1},...e},n=t.querySelectorAll("svg path");2===n.length&&(n[0].style.display=r?"none":"block",n[1].style.display=r?"block":"none",t.setAttribute("aria-label",`Turn ${r?"off":"on"} flash`))}function eH(e,t={}){t={duration:5e3,variant:"neutral",icon:"",...t};let r={info:`
      <svg xmlns="http://www.w3.org/2000/svg" width="1.25em" height="1.25em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
      </svg>
    `,success:`
      <svg xmlns="http://www.w3.org/2000/svg" width="1.25em" height="1.25em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
        <path d="m10.97 4.97-.02.022-3.473 4.425-2.093-2.094a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
      </svg>
    `,warning:`
      <svg xmlns="http://www.w3.org/2000/svg" width="1.25em" height="1.25em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
        <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
      </svg>
    `,danger:`
      <svg xmlns="http://www.w3.org/2000/svg" width="1.25em" height="1.25em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
        <path d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z"/>
        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
      </svg>
    `}[t.icon||t.variant]||"";return Object.assign(document.createElement("alert-element"),{closable:!0,duration:t.duration,variant:t.variant,innerHTML:`${r?`<span slot="icon">${r}</span>`:""}${t.trustDangerousInnerHTML?e:function(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}(e)}`}).toast()}const eK="video-capture",eG=`
  :host { display: block; box-sizing: border-box; }
  :host *, :host *::before, :host *::after { box-sizing: inherit;}
  :host([hidden]), [hidden], ::slotted([hidden]) { display: none; }
  video { display: block; }
  #output:empty { display: none; }
`,eW=document.createElement("template");eW.innerHTML=`
  <style>${eG}</style>
  <video part="video" playsinline></video>
  <div part="actions-container"><slot name="actions"></slot></div>
  <slot></slot>
`;class eQ extends HTMLElement{#S={};#A=null;#C=null;constructor(){super(),this.#S=this.getSupportedConstraints(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(eW.content.cloneNode(!0))}static get observedAttributes(){return["no-image","pan","tilt","zoom","torch"]}attributeChangedCallback(e,t,r){if(!this.isConnected)return;let n=this.getTrackCapabilities();if("zoom"===e&&t!==r&&"zoom"in this.#S){let e=!!("zoom"in n&&n.zoom?.min&&n.zoom?.max)&&this.zoom>=n.zoom.min&&this.zoom<=n.zoom.max;"number"==typeof this.zoom&&e&&this.#x("zoom",this.zoom)}"torch"===e&&t!==r&&"torch"in this.#S&&this.#x("torch",this.torch)}async connectedCallback(){if(this.#k("autoPlay"),this.#k("facingMode"),this.#k("zoom"),this.#k("torch"),this.#C=this.shadowRoot?.querySelector("video")||null,this.#C?.addEventListener("loadedmetadata",this.#N),!eQ.isSupported())return this.dispatchEvent(new CustomEvent(`${eK}:error`,{bubbles:!0,composed:!0,detail:{error:{name:"NotSupportedError",message:"Not supported"}}}));this.autoPlay&&this.startVideoStream()}disconnectedCallback(){this.stopVideoStream(),this.#C?.removeEventListener("loadedmetadata",this.#N)}get autoPlay(){return this.hasAttribute("auto-play")}set autoPlay(e){this.toggleAttribute("auto-play",!!e)}get facingMode(){let e=this.getAttribute("facing-mode");return"user"!==e?"environment":e}set facingMode(e){this.setAttribute("facing-mode",e)}get zoom(){return Number(this.getAttribute("zoom"))||1}set zoom(e){this.setAttribute("zoom",null!=e?e.toString():e)}get torch(){return this.hasAttribute("torch")}set torch(e){this.toggleAttribute("torch",!!e)}get loading(){return this.hasAttribute("loading")}#N=e=>{let t=e.target;t.play().then(()=>{this.dispatchEvent(new CustomEvent(`${eK}:video-play`,{bubbles:!0,composed:!0,detail:{video:t}}))}).catch(e=>{this.dispatchEvent(new CustomEvent(`${eK}:error`,{bubbles:!0,composed:!0,detail:{error:e}}))}).finally(()=>{this.removeAttribute("loading")})};#x(e,t){var r,n,i;if(!this.#A)return;let[s]=this.#A.getVideoTracks(),a=this.getTrackCapabilities(),o=this.getTrackSettings(),l="pan"===e||"tilt"===e||"zoom"===e?(r=Number(t),n=a[e]?.min||1,i=a[e]?.max||1,Number.isNaN(n)&&(n=0),Number.isNaN(i)&&(i=0),Math.min(Math.max(r,Math.min(n,i)),Math.max(n,i))):t;e in o&&s.applyConstraints({advanced:[{[e]:l}]}).catch(()=>{})}#k(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}async startVideoStream(e){if(!eQ.isSupported()||this.#A)return;this.setAttribute("loading","");let t={video:{facingMode:{ideal:this.facingMode},pan:!0,tilt:!0,zoom:!0,torch:this.torch},audio:!1};if("string"==typeof e&&e.trim().length>0&&(t.video.deviceId={exact:e}),"string"==typeof this.cameraResolution&&this.cameraResolution.trim().length>0){let[e=0,r=0]=this.cameraResolution.split("x").map(e=>Number(e));e>0&&r>0&&(t.video.width=e,t.video.height=r)}try{this.#A=await navigator.mediaDevices.getUserMedia(t),this.#C&&(this.#C.srcObject=this.#A),this.#x("pan",this.pan),this.#x("tilt",this.tilt),this.#x("zoom",this.zoom)}catch(e){this.dispatchEvent(new CustomEvent(`${eK}:error`,{bubbles:!0,composed:!0,detail:{error:e}}))}finally{this.removeAttribute("loading")}}restartVideoStream(e){this.#A&&this.#C&&this.stopVideoStream(),this.startVideoStream(e)}stopVideoStream(){if(!this.#C||!this.#A)return;let[e]=this.#A.getVideoTracks();e?.stop(),this.#C.srcObject=null,this.#A=null}getSupportedConstraints(){return eQ.isSupported()&&navigator.mediaDevices.getSupportedConstraints()||{}}getTrackCapabilities(){if(!this.#A)return{};let[e]=this.#A.getVideoTracks();return e&&"function"==typeof e.getCapabilities&&e.getCapabilities()||{}}getTrackSettings(){if(!this.#A)return{};let[e]=this.#A.getVideoTracks();return e&&"function"==typeof e.getSettings&&e.getSettings()||{}}static async getVideoInputDevices(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?(await navigator.mediaDevices.enumerateDevices()||[]).filter(e=>"videoinput"===e.kind&&!!e.deviceId):[]}static isSupported(){return!!navigator.mediaDevices?.getUserMedia}static defineCustomElement(e=eK){"undefined"==typeof window||window.customElements.get(e)||window.customElements.define(e,eQ)}}var eY="clipboard-copy",eJ="success",eX="error",eZ=document.createElement("template"),e0=`
  :host([hidden]),
  [hidden],
  ::slotted([hidden]) {
    display: none !important;
  }
`;eZ.innerHTML=`
  <style>${e0}</style>
  <button type="button" part="button">
    <slot name="copy">Copy</slot>
    <slot name="success" hidden>Copied!</slot>
    <slot name="error" hidden>Error</slot>
  </button>
`;var e1=class e extends HTMLElement{#e=void 0;#p=null;#t=null;#n=null;#i=null;constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(eZ.content.cloneNode(!0)),this.shadowRoot&&(this.#p=this.shadowRoot.querySelector("button"),this.#t=this.shadowRoot.querySelector('slot[name="copy"]'),this.#n=this.shadowRoot.querySelector('slot[name="success"]'),this.#i=this.shadowRoot.querySelector('slot[name="error"]'))}static get observedAttributes(){return["disabled"]}attributeChangedCallback(e,t,r){"disabled"===e&&t!==r&&this.#p&&(this.#p.disabled=this.disabled,this.#p.setAttribute("aria-disabled",this.disabled.toString()),this.#p.part.contains("button")&&this.#p.part.toggle("button--disabled",this.disabled))}connectedCallback(){this.#s("value"),this.#s("from"),this.#s("disabled"),this.#s("feedbackDuration"),this.#p?.addEventListener("click",this.#E)}disconnectedCallback(){this.#p?.removeEventListener("click",this.#E),this.#w()}get value(){return this.getAttribute("value")||""}set value(e){this.setAttribute("value",null!=e?e.toString():e)}get from(){return this.getAttribute("from")||""}set from(e){this.setAttribute("from",null!=e?e.toString():e)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}get feedbackDuration(){return Number(this.getAttribute("feedback-duration"))||1e3}set feedbackDuration(e){this.setAttribute("feedback-duration",null!=e?e.toString():e)}async #f(){if(!(!this.value&&!this.from))try{let e="";if(this.value)e=this.value;else if(this.from){let t="getRootNode"in Element.prototype?this.#p?.getRootNode({composed:!0}):this.#p?.ownerDocument;if(!t||!(t instanceof Document||t instanceof ShadowRoot))return;let r=t.querySelector(this.from);if(!r)return;e=r instanceof HTMLInputElement||r instanceof HTMLTextAreaElement?r.value:r instanceof HTMLAnchorElement&&r.hasAttribute("href")?r.href:r.textContent||""}await navigator.clipboard.writeText(e),this.#h(eJ),this.dispatchEvent(new CustomEvent(`${eY}-success`,{bubbles:!0,composed:!0,detail:{value:e}}))}catch(e){this.#h(eX),this.dispatchEvent(new CustomEvent(`${eY}-error`,{bubbles:!0,composed:!0,detail:{error:e}}))}}#E=e=>{e.preventDefault(),this.disabled||this.#e||this.#f()};#h(e){this.#t&&(this.#t.hidden=!0),this.#n&&(this.#n.hidden=e!==eJ),this.#i&&(this.#i.hidden=e!==eX),this.#p?.part.remove("button--success"),this.#p?.part.remove("button--error"),this.#p?.part.add(`button--${e}`),this.#e&&clearTimeout(this.#e),this.#e=setTimeout(()=>{this.#t&&(this.#t.hidden=!1),this.#n&&(this.#n.hidden=!0),this.#i&&(this.#i.hidden=!0),this.#p?.part.remove(`button--${e}`),this.#e=void 0},this.feedbackDuration)}#w(){this.#e&&clearTimeout(this.#e),this.#e=void 0,this.#t&&(this.#t.hidden=!1),this.#n&&(this.#n.hidden=!0),this.#i&&(this.#i.hidden=!0),this.#p?.part.remove("button--success"),this.#p?.part.remove("button--error")}#s(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}static defineCustomElement(t=eY){"u">typeof window&&!window.customElements.get(t)&&window.customElements.define(t,e)}};class e2 extends e1{constructor(){super();let e=this.shadowRoot.querySelector('slot[name="copy"]'),t=this.shadowRoot.querySelector('slot[name="success"]'),r=this.shadowRoot.querySelector('slot[name="error"]');e.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="1.125em" height="1.125em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
      </svg>
      <span class="text">Copy</span>
    `,t.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="1.125em" height="1.125em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
        <path fill-rule="evenodd" d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
      </svg>
      <span class="text">Copied!</span>
    `,r.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="1.125em" height="1.125em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
        <path fill-rule="evenodd" d="M6.146 7.146a.5.5 0 0 1 .708 0L8 8.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 9l1.147 1.146a.5.5 0 0 1-.708.708L8 9.707l-1.146 1.147a.5.5 0 0 1-.708-.708L7.293 9 6.146 7.854a.5.5 0 0 1 0-.708"/>
        <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1z"/>
        <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0z"/>
      </svg>
      <span class="text">Error</span>
    `}static get observedAttributes(){return[...super.observedAttributes,"only-icon"]}attributeChangedCallback(e,t,r){if(super.attributeChangedCallback(e,t,r),"only-icon"===e&&t!==r){let e=this.shadowRoot.querySelector('slot[name="copy"]'),t=this.shadowRoot.querySelector('slot[name="success"]'),r=this.shadowRoot.querySelector('slot[name="error"]'),n=e.querySelector(".text"),i=t.querySelector(".text"),s=r.querySelector(".text");n?.toggleAttribute("hidden",this.onlyIcon),i?.toggleAttribute("hidden",this.onlyIcon),s?.toggleAttribute("hidden",this.onlyIcon)}}get onlyIcon(){return this.hasAttribute("only-icon")}set onlyIcon(e){e?this.setAttribute("only-icon",""):this.removeAttribute("only-icon")}connectedCallback(){super.connectedCallback(),this.#k("onlyIcon"),this.hasAttribute("feedback-duration")||this.setAttribute("feedback-duration","1500")}disconnectedCallback(){super.disconnectedCallback()}#k(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}static defineCustomElement(e="custom-clipboard-copy"){"undefined"==typeof window||window.customElements.get(e)||window.customElements.define(e,e2)}}function e5(e){return null!==e&&"object"==typeof e?"share"in navigator&&"canShare"in navigator&&navigator.canShare(e):"share"in navigator}e2.defineCustomElement();const e6=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}),e3=`
  :host {
    --color-flash: #ffff99;

    box-sizing: border-box;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  :host([hidden]),
  [hidden],
  ::slotted([hidden]) {
    display: none !important;
  }

  .result {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    position: relative;
    width: 100%;
    padding: 0.5rem;
  }

  .result__item {
    word-wrap: break-word;
    word-break: break-word;
  }

  a.result__item {
    color: var(--links);
  }

  .result__datetime {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-block-start: 0.25rem;
  }

  .result__datetime:empty {
    display: none !important;
  }

  .result__actions {
    display: flex;
    align-items: center;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
  }

  .result web-share button,
  .result custom-clipboard-copy::part(button) {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem;
    background-color: transparent;
    border: 0;
    border-radius: var(--border-radius);
    color: inherit;
    line-height: 1;
    font-family: inherit;
    font-size: 0.9rem;
    cursor: pointer;
  }

  .result custom-clipboard-copy::part(button--success) {
    color: var(--success-color);
  }

  .result custom-clipboard-copy::part(button--error) {
    color: var(--danger-color);
  }

  .flash {
    animation: flash 0.4s ease-out;
  }

  @keyframes flash {
    0% {
      background-color: #ffff99;
    }
    100% {
      background-color: transparent;
    }
  }
`,e4=document.createElement("template");e4.innerHTML=`
  <style>${e3}</style>

  <div class="result" part="result">
    <div class="result__content">
      <div class="result__meta"></div>
      <div class="result__datetime"></div>
    </div>

    <div class="result__actions">
      <custom-clipboard-copy only-icon></custom-clipboard-copy>

      <web-share>
        <button slot="button" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
            <path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/>
          </svg>
        </button>
      </web-share>
    </div>
  </div>
`;class e8 extends HTMLElement{constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(e4.content.cloneNode(!0))}get value(){return this.getAttribute("value")}set value(e){this.setAttribute("value",e)}static get observedAttributes(){return["value"]}attributeChangedCallback(e,t,r){"value"===e&&t!==r&&this.#R(this.value)}connectedCallback(){if(this.#k("value"),window.matchMedia("(prefers-reduced-motion: no-preference)").matches){let e=this.shadowRoot.querySelector(".result");e?.animate([{backgroundColor:"var(--color-flash)"},{backgroundColor:"transparent"}],{duration:400,easing:"ease-out"})}if(!e5()){let e=this.shadowRoot.querySelector("web-share");e&&(e.hidden=!0)}}async #R(e){let t,r=this.shadowRoot.querySelector(".result"),n=r?.querySelector(".result__content"),i=r?.querySelector(".result__datetime"),s=r?.querySelector(".result__item");s&&s?.remove();try{let[,r]=await ex();new URL(e),(t=document.createElement("a")).href=e,r?.openWebPageSameTab||(t.setAttribute("target","_blank"),t.setAttribute("rel","noreferrer noopener")),r?.openWebPage?t.click():window.requestAnimationFrame(()=>t.focus())}catch{t=document.createElement("span")}t.className="result__item",t.part="result__item",t.textContent=e;let a=r.querySelector(".result__meta");if(a){a.textContent="";let e=this.getAttribute("data-title")||"",t=this.getAttribute("data-brand")||"",r=this.getAttribute("data-description")||"";if(e){let t=document.createElement("div");t.className="result__meta-title",t.textContent=e,a.appendChild(t)}if(t){let e=document.createElement("div");e.className="result__meta-brand",e.textContent=`Brand: ${t}`,a.appendChild(e)}if(r){let e=document.createElement("div");e.className="result__meta-description",e.textContent=r,a.appendChild(e)}}i.textContent=e6.format(new Date),n?.insertBefore(t,i);let o=r?.querySelector("custom-clipboard-copy"),l=r?.querySelector("web-share");if(o){let t=o.shadowRoot?.querySelector("button");o.setAttribute("value",e),t?.setAttribute("aria-label",`Copy to clipboard ${e}`),o.hidden=!1}if(l&&e5()){let t=l.querySelector("button");l.setAttribute("share-text",e),l.hidden=!1,t?.setAttribute("aria-label",`Share ${e}`)}}#k(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}static defineCustomElement(e="bs-result"){"undefined"==typeof window||window.customElements.get(e)||window.customElements.define(e,e8)}}e8.defineCustomElement();class e7 extends HTMLElement{#D=null;#L=null;#P=[];#O;constructor(){super()}get supportedFormats(){return this.#P}set supportedFormats(e){this.#P=e,this.#M()}async connectedCallback(){this.#k("supportedFormats"),this.#D=this.querySelector("#formatsList"),this.#L=this.querySelector("form");let[,e]=await ex();this.#O=e??{},this.#L?.querySelectorAll('[name="general-settings"]').forEach(e=>{e.checked=this.#O[e.value]})}#M(){if(!this.#D)return;let e=this.#O?.formats;this.#D.replaceChildren(),this.supportedFormats.forEach(t=>{let r=document.createElement("li"),n=document.createElement("label"),i=document.createElement("input");i.type="checkbox",i.name="formats-settings",i.value=t,i.checked=null==e||e.includes(t),n.appendChild(i),n.appendChild(document.createTextNode(t)),r.appendChild(n),this.#D.appendChild(r)})}#k(e){if(Object.prototype.hasOwnProperty.call(this,e)){let t=this[e];delete this[e],this[e]=t}}static defineCustomElement(e="bs-settings"){"undefined"==typeof window||window.customElements.get(e)||window.customElements.define(e,e7)}}e7.defineCustomElement();const e9=()=>void 0,te=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},tt=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[r++],a=((7&i)<<18|(63&s)<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(a>>10)),t[n++]=String.fromCharCode(56320+(1023&a))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},tr={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),n.push(r[u],r[h],r[c],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(te(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):tt(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new tn;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class tn extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ti=function(e){let t=te(e);return tr.encodeByteArray(t,!0)},ts=function(e){return ti(e).replace(/\./g,"")},ta=function(e){try{return tr.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function to(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==C)return C;throw Error("Unable to locate global object.")}const tl=()=>to().__FIREBASE_DEFAULTS__,tu=()=>{},th=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&ta(e[1]);return t&&JSON.parse(t)},tc=()=>{try{return e9()||tl()||tu()||th()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},td=e=>tc()?.emulatorHosts?.[e],tf=e=>{let t=td(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},tp=()=>tc()?.config,tm=e=>tc()?.[`_${e}`];class tg{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function ty(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function tv(e){return(await fetch(e,{credentials:"include"})).ok}const tb={};let tw=!1;function tE(e,t){if("undefined"==typeof window||"undefined"==typeof document||!ty(window.location.host)||tb[e]===t||tb[e]||tw)return;function r(e){return`__firebase__banner__${e}`}tb[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(tb))tb[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),u=document.getElementById(l)||document.createElement("a"),h=r("preprendIcon"),c=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",u.setAttribute("id",l),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{tw=!0;let e=document.getElementById(n);e&&e.remove()},e}();c.setAttribute("width","24"),c.setAttribute("id",h),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",e.append(c,o,u,t),document.body.appendChild(e)}i?(o.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function tI(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function t_(){let e=tc()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(C.process)}catch(e){return!1}}function tT(){return!t_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function tS(){return!t_()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function tA(){try{return"object"==typeof indexedDB}catch(e){return!1}}class tC extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,tC.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tx.prototype.create)}}class tx{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(tk,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new tC(s,l,i)}}const tk=/\{\$([^}]+)}/g;function tN(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(tR(r)&&tR(s)){if(!tN(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function tR(e){return null!==e&&"object"==typeof e}function tD(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function tL(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function tP(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class tO{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=tM),void 0===n.error&&(n.error=tM),void 0===n.complete&&(n.complete=tM);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function tM(){}function tF(e){return e&&e._delegate?e._delegate:e}class tV{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const tU="[DEFAULT]";class tB{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new tg;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(r)return null;throw e}if(r)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:tU})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=tU){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=tU){return this.instances.has(e)}getOptions(e=tU){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){let r=this.normalizeInstanceIdentifier(t),n=this.onInitCallbacks.get(r)??new Set;n.add(e),this.onInitCallbacks.set(r,n);let i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===tU?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=tU){return this.component?this.component.multipleInstances?e:tU:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class tz{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new tB(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const tq=[];(a=u||(u={}))[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT";const tj={debug:u.DEBUG,verbose:u.VERBOSE,info:u.INFO,warn:u.WARN,error:u.ERROR,silent:u.SILENT},t$=u.INFO,tH={[u.DEBUG]:"log",[u.VERBOSE]:"log",[u.INFO]:"info",[u.WARN]:"warn",[u.ERROR]:"error"},tK=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=tH[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class tG{constructor(e){this.name=e,this._logLevel=t$,this._logHandler=tK,this._userLogHandler=null,tq.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in u))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?tj[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,u.DEBUG,...e),this._logHandler(this,u.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,u.VERBOSE,...e),this._logHandler(this,u.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,u.INFO,...e),this._logHandler(this,u.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,u.WARN,...e),this._logHandler(this,u.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,u.ERROR,...e),this._logHandler(this,u.ERROR,...e)}}const tW=(e,t)=>t.some(t=>e instanceof t),tQ=new WeakMap,tY=new WeakMap,tJ=new WeakMap,tX=new WeakMap,tZ=new WeakMap;let t0={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return tY.get(e);if("objectStoreNames"===t)return e.objectStoreNames||tJ.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return t1(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function t1(r){if(r instanceof IDBRequest){let e=new Promise((e,t)=>{let n=()=>{r.removeEventListener("success",i),r.removeEventListener("error",s)},i=()=>{e(t1(r.result)),n()},s=()=>{t(r.error),n()};r.addEventListener("success",i),r.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&tQ.set(e,r)}).catch(()=>{}),tZ.set(e,r),e}if(tX.has(r))return tX.get(r);let n=function(r){if("function"==typeof r)return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(r)?function(...e){return r.apply(t2(this),e),t1(tQ.get(this))}:function(...e){return t1(r.apply(t2(this),e))}:function(e,...t){let n=r.call(t2(this),e,...t);return tJ.set(n,e.sort?e.sort():[e]),t1(n)};return(r instanceof IDBTransaction&&function(e){if(tY.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});tY.set(e,t)}(r),tW(r,e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(r,t0):r}(r);return n!==r&&(tX.set(r,n),tZ.set(n,r)),n}const t2=e=>tZ.get(e),t5=["get","getKey","getAll","getAllKeys","count"],t6=["put","add","delete","clear"],t3=new Map;function t4(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(t3.get(t))return t3.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=t6.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||t5.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return t3.set(t,s),s}t0={...s=t0,get:(e,t,r)=>t4(e,t)||s.get(e,t,r),has:(e,t)=>!!t4(e,t)||s.has(e,t)};class t8{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return t?.type==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}const t7="@firebase/app",t9="0.14.6",re=new tG("@firebase/app"),rt="[DEFAULT]",rr={[t7]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},rn=new Map,ri=new Map,rs=new Map;function ra(e,t){try{e.container.addComponent(t)}catch(r){re.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function ro(e){let t=e.name;if(rs.has(t))return re.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(rs.set(t,e),rn.values()))ra(r,e);for(let t of ri.values())ra(t,e);return!0}function rl(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function ru(e){return null!=e&&void 0!==e.settings}const rh=new tx("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class rc{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new tV("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw rh.create("app-deleted",{appName:this._name})}}const rd="12.6.0";function rf(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n={name:rt,automaticDataCollectionEnabled:!0,...t},i=n.name;if("string"!=typeof i||!i)throw rh.create("bad-app-name",{appName:String(i)});if(r||(r=tp()),!r)throw rh.create("no-options");let s=rn.get(i);if(s)if(tN(r,s.options)&&tN(n,s.config))return s;else throw rh.create("duplicate-app",{appName:i});let a=new tz(i);for(let e of rs.values())a.addComponent(e);let o=new rc(r,n,a);return rn.set(i,o),o}function rp(e=rt){let t=rn.get(e);if(!t&&e===rt&&tp())return rf();if(!t)throw rh.create("no-app",{appName:e});return t}function rm(e,t,r){let n=rr[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),re.warn(e.join(" "));return}ro(new tV(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}const rg="firebase-heartbeat-store";let ry=null;function rv(){return ry||(ry=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=t1(a);return n&&a.addEventListener("upgradeneeded",e=>{n(t1(a.result),e.oldVersion,e.newVersion,t1(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(rg)}catch(e){console.warn(e)}}}).catch(e=>{throw rh.create("idb-open",{originalErrorMessage:e.message})})),ry}async function rb(e){try{let t=(await rv()).transaction(rg),r=await t.objectStore(rg).get(rE(e));return await t.done,r}catch(e){if(e instanceof tC)re.warn(e.message);else{let t=rh.create("idb-get",{originalErrorMessage:e?.message});re.warn(t.message)}}}async function rw(e,t){try{let r=(await rv()).transaction(rg,"readwrite"),n=r.objectStore(rg);await n.put(t,rE(e)),await r.done}catch(e){if(e instanceof tC)re.warn(e.message);else{let t=rh.create("idb-set",{originalErrorMessage:e?.message});re.warn(t.message)}}}function rE(e){return`${e.name}!${e.options.appId}`}class rI{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new rT(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=r_();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){re.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=r_(),{heartbeatsToSend:t,unsentEntries:r}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),rS(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),rS(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),n=ts(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return re.warn(e),""}}}function r_(){return new Date().toISOString().substring(0,10)}class rT{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!tA()&&new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await rb(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return rw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return rw(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function rS(e){return ts(JSON.stringify({version:2,heartbeats:e})).length}ro(new tV("platform-logger",e=>new t8(e),"PRIVATE")),ro(new tV("heartbeat",e=>new rI(e),"PRIVATE")),rm(t7,t9,""),rm(t7,t9,"esm2020"),rm("fire-js","");var rA="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==C?C:"undefined"!=typeof self?self:{},rC={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function r(){}function n(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+0xd76aa478|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let r=t-this.blockSize,i=this.C,s=this.h,a=0;for(;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var s,a={};function o(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return u;if(e<0)return g(l(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=0x100000000;return new i(t,0)}var u=o(0),d=o(1),f=o(0x1000000);function p(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new i(r,~e.h).add(d)}function y(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function b(e,t){this.g=e,this.h=t}function w(e,t){if(p(t))throw Error("division by zero");if(p(e))return new b(u,u);if(m(e))return t=w(g(e),t),new b(g(t.g),g(t.h));if(m(t))return t=w(e,g(t)),new b(g(t.g),t.h);if(e.g.length>30){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=E(r),n=E(n);var i=I(r,1),s=I(n,1);for(n=I(n,2),r=I(r,2);!p(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=I(n,1),r=I(r,1)}return t=y(e,i.j(t)),new b(i,t)}for(i=u;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=l(r)).j(t);m(a)||a.l(e)>0;)r-=n,a=(s=l(r)).j(t);p(s)&&(s=d),i=i.add(s),e=y(e,a)}return new b(i,e)}function E(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new i(r,e.h)}function I(e,t){let r=t>>5;t%=32;let n=e.g.length-r,s=[];for(let i=0;i<n;i++)s[i]=t>0?e.i(i+r)>>>t|e.i(i+r+1)<<32-t:e.i(i+r);return new i(s,e.h)}(s=i.prototype).m=function(){if(m(this))return-g(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:0x100000000+n)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(m(this))return"-"+g(this).toString(e);let t=l(Math.pow(e,6));var r=this;let n="";for(;;){let i=w(r,t).g,s=(((r=y(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(p(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return m(e=y(this,e))?-1:+!p(e)},s.abs=function(){return m(this)?g(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new i(r,-0x80000000&r[r.length-1]?-1:0)},s.j=function(e){if(p(this)||p(e))return u;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(f)&&0>e.l(f))return l(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,v(r,2*n+2*t),r[2*n+2*t+1]+=i*o,v(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,v(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,v(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new i(r,0)},s.B=function(e){return w(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new i(r,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new i(r,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new i(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,c=rC.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return g(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let n=l(Math.pow(r,8)),i=u;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let a=parseInt(t.substring(e,e+s),r);s<8?(s=l(Math.pow(r,s)),i=i.j(s).add(l(a))):i=(i=i.j(n)).add(l(a))}return i},h=rC.Integer=i}).apply(void 0!==rA?rA:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var rx="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==C?C:"undefined"!=typeof self?self:{},rk={};(function(){var e,t,r=Object.defineProperty,n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof rx&&rx];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&r(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,r){return e.call.apply(e.bind,arguments)}function u(e,t,r){return(u=l).apply(null,arguments)}function h(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function c(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var w="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function E(e){let t=e.length;if(t>0){let r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];var r=typeof n;if("array"==(r="object"!=r?r:n?Array.isArray(n)?"array":r:"null")||"object"==r&&"number"==typeof n.length){r=e.length||0;let t=n.length||0;e.length=r+t;for(let i=0;i<t;i++)e[r+i]=n[i]}else e.push(n)}}var _=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new T,e=>e.reset());class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let S,A=!1,C=new class{constructor(){this.h=this.g=null}add(e,t){let r=_.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},x=()=>{let e=Promise.resolve(void 0);S=()=>{e.then(k)}};function k(){let e;for(var t;e=null,C.g&&(e=C.g,C.g=C.g.next,C.g||(C.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}_.j(t),_.h<100&&(_.h++,t.next=_.g,_.g=t)}A=!1}function N(){this.u=this.u,this.C=this.C}function R(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}N.prototype.u=!1,N.prototype.dispose=function(){this.u||(this.u=!0,this.N())},N.prototype[Symbol.dispose]=function(){this.dispose()},N.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},R.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function L(e){return/^[\s\xa0]*$/.test(e)}function P(e,t){R.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}c(P,R),P.prototype.init=function(e,t){let r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&P.Z.h.call(this)},P.prototype.h=function(){P.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var O="closure_listenable_"+(1e6*Math.random()|0),M=0;function F(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++M,this.da=this.fa=!1}function V(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function U(e,t,r){for(let n in e)t.call(r,e[n],n,e)}function B(e){let t={};for(let r in e)t[r]=e[r];return t}let z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function q(e,t){let r,n;for(let t=1;t<arguments.length;t++){for(r in n=arguments[t])e[r]=n[r];for(let t=0;t<z.length;t++)r=z[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function j(e){this.src=e,this.g={},this.h=0}function $(e,t){let r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(V(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function H(e,t,r,n){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!r==s.capture&&s.ha==n)return i}return -1}j.prototype.add=function(e,t,r,n,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let a=H(e,t,n,i);return a>-1?(t=e[a],r||(t.fa=!1)):((t=new F(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var K="closure_lm_"+(1e6*Math.random()|0),G={};function W(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");let a=o(i)?!!i.capture:!!i,l=X(e);if(l||(e[K]=l=new j(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function e(t){return J.call(e.src,e.listener,t)},r.proxy=n,n.src=e,n.listener=r,e.addEventListener)D||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(Y(t.toString()),n);else if(e.addListener&&e.removeListener)e.addListener(n);else throw Error("addEventListener and attachEvent are unavailable.");return r}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[O])$(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(Y(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=X(t))?($(r,e),0==r.h&&(r.src=null,t[K]=null)):V(e)}}}function Y(e){return e in G?G[e]:G[e]="on"+e}function J(e,t){if(e.da)e=!0;else{t=new P(t,this);let r=e.listener,n=e.ha||e.src;e.fa&&Q(e),e=r.call(n,t)}return e}function X(e){return(e=e[K])instanceof j?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){N.call(this),this.i=new j(this),this.M=this,this.G=null}function er(e,t){let r,n;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new R(t,e);else if(t instanceof R)t.target=t.target||e;else{var a=t;q(t=new R(s,e),a)}if(a=!0,i)for(n=i.length-1;n>=0;n--)a=en(r=t.g=i[n],s,!0,t)&&a;if(a=en(r=t.g=e,s,!0,t)&&a,a=en(r,s,!1,t)&&a,i)for(n=0;n<i.length;n++)a=en(r=t.g=i[n],s,!1,t)&&a}function en(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let a=t[s];if(a&&!a.da&&a.capture==r){let t=a.listener,r=a.ha||a.src;a.fa&&$(e.i,a),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}c(et,N),et.prototype[O]=!0,et.prototype.removeEventListener=function(e,t,r,n){!function e(t,r,n,i,s){if(Array.isArray(r))for(var a=0;a<r.length;a++)e(t,r[a],n,i,s);else(i=o(i)?!!i.capture:!!i,n=ee(n),t&&t[O])?(t=t.i,(a=String(r).toString())in t.g&&(n=H(r=t.g[a],n,i,s))>-1&&(V(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete t.g[a],t.h--))):t&&(t=X(t))&&(r=t.g[r.toString()],t=-1,r&&(t=H(r,n,i,s)),(n=t>-1?r[t]:null)&&Q(n))}(this,e,t,r,n)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let r=e.g[t];for(let e=0;e<r.length;e++)V(r[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},et.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class ei extends N{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=u(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:a.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let r=t.h;t.h=null,t.m.apply(null,r)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){N.call(this),this.h=e,this.g={}}c(es,N);var ea=[];function eo(e){U(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),eo(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=a.JSON.stringify,eu=a.JSON.parse,eh=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){R.call(this,"d")}function em(){R.call(this,"c")}c(ep,R),c(em,R);var eg={},ey=null;function ev(){return ey=ey||new et}function eb(e){R.call(this,eg.Ia,e)}function ew(e){let t=ev();er(t,new eb(t))}function eE(e,t){R.call(this,eg.STAT_EVENT,e),this.stat=t}function eI(e){let t=ev();er(t,new eE(t,e))}function e_(e,t){R.call(this,eg.Ja,e),this.size=t}function eT(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function eS(){this.g=!0}function eA(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}}return el(s)}catch(e){return t}}(e,r)+(n?" "+n:"")})}eg.Ia="serverreachability",c(eb,R),eg.STAT_EVENT="statevent",c(eE,R),eg.Ja="timingevent",c(e_,R),eS.prototype.ua=function(){this.g=!1},eS.prototype.info=function(){};var eC={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ex={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ek(){}function eN(e){return encodeURIComponent(String(e))}function eR(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eD}function eD(){this.i=null,this.g="",this.h=!1}c(ek,ec),ek.prototype.g=function(){return new XMLHttpRequest},e=new ek;var eL={},eP={};function eO(e,t,r){e.M=1,e.A=e3(e0(t)),e.u=r,e.R=!0,eM(e,null)}function eM(e,t){e.F=Date.now(),eV(e),e.B=e0(e.A);var r,n,i,s,a,l,h=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),tu(h.i,"t",c),e.C=0,h=e.j.L,e.h=new eD,e.g=tQ(e.j,h?t:null,!e.u),e.P>0&&(e.O=new ei(u(e.Y,e,e.g),e.P)),t=e.V,h=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(ea[0]=d.toString()),d=ea);for(let e=0;e<d.length;e++){let r=function e(t,r,n,i,s){if(i&&i.once)return function e(t,r,n,i,s){if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[O]?t.K(r,n,o(i)?!!i.capture:!!i,s):W(t,r,n,!0,i,s)}(t,r,n,i,s);if(Array.isArray(r)){for(let a=0;a<r.length;a++)e(t,r[a],n,i,s);return null}return n=ee(n),t&&t[O]?t.J(r,n,o(i)?!!i.capture:!!i,s):W(t,r,n,!1,i,s)}(h,d[e],c||t.handleEvent,!1,t.h||t);if(!r)break;t.g[r.key]=r}t=e.J?B(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ew(),r=e.i,n=e.v,i=e.B,s=e.l,a=e.S,l=e.u,r.info(function(){if(r.g)if(l){var e="",t=l.split("&");for(let r=0;r<t.length;r++){var o=t[r].split("=");if(o.length>1){let t=o[0];o=o[1];let r=t.split("_");e=r.length>=2&&"type"==r[1]?e+(t+"=")+o+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+n+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eV(e){e.T=Date.now()+e.H,eU(e,e.H)}function eU(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eT(u(e.aa,e),t)}function eB(e){e.D&&(a.clearTimeout(e.D),e.D=null)}function ez(e){0==e.j.I||e.K||t$(e.j,e)}function eq(e){eB(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,eo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function ej(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||eW(r.h,e))){if(!e.L&&eW(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(e){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g)if(r.g.F+3e3<e.F)tj(r),tL(r);else break e;tB(r),eI(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=eT(u(r.Va,r),6e3));1>=eG(r.h)&&r.ta&&(r.ta=void 0)}else tK(r,11)}else if((e.L||r.g==e)&&tj(r),!L(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let o=i[t],l=o[0];if(!(l<=r.K))if(r.K=l,o=o[1],2==r.I)if("c"==o[0]){r.M=o[1],r.ba=o[2];let t=o[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));let i=o[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));let l=o[5];null!=l&&"number"==typeof l&&l>0&&(r.O=n=1.5*l,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eQ(s,s.h),s.h=null))}if(n.G){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,e6(n.J,n.G,e))}}if(r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms")),(n=r).na=tW(n,n.L?n.ba:null,n.W),e.L){eY(n.h,e);var a=n.O;a&&(e.H=a),e.D&&(eB(e),eV(e)),n.g=e}else tU(n);r.i.length>0&&tO(r)}else"stop"!=o[0]&&"close"!=o[0]||tK(r,7);else 3==r.I&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tK(r,7):tD(r):"noop"!=o[0]&&r.l&&r.l.qa(o),r.A=0)}}ew(4)}catch(e){}}eR.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tx(e)?t.j():this.Y(e)},eR.prototype.Y=function(e){try{if(e==this.g)e:{let f=tx(this.g),p=this.g.ya(),m=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tk(this.g)))){this.K||4!=f||7==p||(8==p||m<=0?ew(3):ew(2)),eB(this);var t=this.g.ca();this.X=t;var r=function(e){if(!eF(e))return e.g.la();let t=tk(e.g);if(""===t)return"";let r="",n=t.length,i=4==tx(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return eq(e),ez(e),"";e.h.i=new a.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,n=this.i,i=this.v,s=this.B,o=this.l,l=this.S,n.info(function(){return"XMLHTTP RESP ("+o+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i,s,o,l,u,h=this.g;if((u=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(u)){var c=u;break t}}c=null}if(e=c)eA(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ej(this,e);else{this.o=!1,this.m=3,eI(12),eq(this),ez(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;)if((t=function(e,t){var r=e.C,n=t.indexOf("\n",r);return -1==n?eP:isNaN(r=Number(t.substring(r,n)))?eL:(n+=1)+r>t.length?eP:(t=t.slice(n,n+r),e.C=n+r,t)}(this,r))==eP){4==f&&(this.m=4,eI(14),e=!1),eA(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eL){this.m=4,eI(15),eA(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}else eA(this.i,this.l,t,null),ej(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=r.length||this.h.h||(this.m=1,eI(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),tz(d),d.P=!0,eI(11))}}else eA(this.i,this.l,r,"[Invalid Chunked Response]"),eq(this),ez(this)}else eA(this.i,this.l,r,null),ej(this,r);4==f&&eq(this),this.o&&!this.K&&(4==f?t$(this.j,this):(this.o=!1,eV(this)))}else(function(e){let t={};e=(e.g&&tx(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(L(e[n]))continue;var r=function(e){var t=1;e=e.split(":");let r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}(e[n]);let i=r[0];if("string"!=typeof(r=r[1]))continue;r=r.trim();let s=t[i]||[];t[i]=s,s.push(r)}var n=function(e){return e.join(", ")};for(let e in t)n.call(void 0,t[e],e,t)})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,eI(12)):(this.m=0,eI(13)),eq(this),ez(this)}}}catch(e){}finally{}},eR.prototype.cancel=function(){this.K=!0,eq(this)},eR.prototype.aa=function(){var e,t;this.D=null;let r=Date.now();r-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ew(),eI(17)),eq(this),this.m=2,ez(this)):eU(this,this.T-r)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eH(e){this.l=e||10,e=a.PerformanceNavigationTiming?(e=a.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eK(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eG(e){return e.h?1:e.g?e.g.size:0}function eW(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eJ(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let r of e.g.values())t=t.concat(r.G);return t}return E(e.i)}eH.prototype.cancel=function(){if(this.i=eJ(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eX=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e5(this,th(e.i)),this.m=e.m):e&&(t=String(e).match(eX))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e4(t[2]||""),this.g=e4(t[3]||"",!0),e2(this,t[4]),this.h=e4(t[5]||"",!0),e5(this,t[6]||"",!0),this.m=e4(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,r){e.j=r?e4(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e5(e,t,r){var n,i;t instanceof ti?(e.i=t,n=e.i,(i=e.l)&&!n.j&&(ts(n),n.i=null,n.g.forEach(function(e,t){let r=t.toLowerCase();t!=r&&(ta(this,t),tu(this,r,e))},n)),n.j=i):(r||(t=e8(t,tr)),e.i=new ti(t,e.l))}function e6(e,t,r){e.i.set(t,r)}function e3(e){return e6(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e4(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,r){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eN(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(e8(r,"/"==r.charAt(0)?tt:te,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",e8(r,tn)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),r=!!e.j;r?e1(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)e2(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?e5(t,th(e.i)):r=!!e.m,r&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tr=/[#\?@]/g,tn=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){let n=e[r].indexOf("="),i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function ta(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function to(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let r=[];if("string"==typeof t)to(e,t)&&(r=r.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function tu(e,t,r){ta(e,t),r.length>0&&(e.i=null,e.g.set(tc(e,t),E(r)),e.h+=r.length)}function th(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(e){}}function tf(){this.g=new eh}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tm(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tg(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,tv(e)}function tv(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tb(e){let t="";return U(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function tw(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=tb(r),"string"==typeof e?null!=r&&eN(r):e6(e,t,r))}function tE(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,to(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];let i=eN(r);r=tl(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+eN(r[t])),e.push(n)}}return this.i=e.join("&")},c(tp,ec),tp.prototype.g=function(){return new tm(this.i,this.h)},c(tm,et),(t=tm.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,tv(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||a).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tv(this)),this.g&&(this.readyState=3,tv(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tg(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):tv(this),3==this.readyState&&tg(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var r=t.next();!r.done;)e.push((r=r.value)[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(tm.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),c(tE,et);var tI=/^https?$/i,t_=["POST","PUT"];function tT(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tS(e),tC(e)}function tS(e){e.A||(e.A=!0,er(e,"complete"),er(e,"error"))}function tA(e){if(e.h&&void 0!==s){if(e.v&&4==tx(e))setTimeout(e.Ca.bind(e),0);else if(er(e,"readystatechange"),4==tx(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,r,n=!0;break;default:n=!1}if(!(t=n)){if(r=0===s){let t=String(e.D).match(eX)[1]||null;!t&&a.self&&a.self.location&&(t=a.self.location.protocol.slice(0,-1)),r=!tI.test(t?t.toLowerCase():"")}t=r}if(t)er(e,"complete"),er(e,"success");else{e.o=6;try{var i=tx(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tS(e)}}finally{tC(e)}}}}function tC(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let r=e.g;e.g=null,t||er(e,"ready");try{r.onreadystatechange=null}catch(e){}}}function tx(e){return e.g?e.g.readyState:0}function tk(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tN(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function tR(e){this.za=0,this.i=[],this.j=new eS,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tN("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tN("baseRetryDelayMs",5e3,e),this.Za=tN("retryDelaySeedMs",1e4,e),this.Ta=tN("forwardChannelMaxRetries",2,e),this.va=tN("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eH(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tD(e){if(tP(e),3==e.I){var t=e.V++,r=e0(e.J);if(e6(r,"SID",e.M),e6(r,"RID",t),e6(r,"TYPE","terminate"),tF(e,r),(t=new eR(e,e.j,t)).M=2,t.A=e3(e0(r)),r=!1,a.navigator&&a.navigator.sendBeacon)try{r=a.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!r&&a.Image&&((new Image).src=t.A,r=!0),r||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eV(t)}tG(e)}function tL(e){e.g&&(tz(e),e.g.cancel(),e.g=null)}function tP(e){tL(e),e.v&&(a.clearTimeout(e.v),e.v=null),tj(e),e.h.cancel(),e.m&&("number"==typeof e.m&&a.clearTimeout(e.m),e.m=null)}function tO(e){if(!eK(e.h)&&!e.m){e.m=!0;var t=e.Ea;S||x(),A||(S(),A=!0),C.add(t,e),e.D=0}}function tM(e,t){var r;r=t?t.l:e.V++;let n=e0(e.J);e6(n,"SID",e.M),e6(n,"RID",r),e6(n,"AID",e.K),tF(e,n),e.u&&e.o&&tw(n,e.u,e.o),r=new eR(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tV(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,r),eO(r,n,t)}function tF(e,t){e.H&&U(e.H,function(e,r){e6(t,r,e)}),e.l&&U({},function(e,r){e6(t,r,e)})}function tV(e,t,r){r=Math.min(e.i.length,r);let n=e.l?u(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let u=0;u<r;u++){var s=i[u].g;let r=i[u].map;if((s-=t)<0)t=Math.max(0,i[u].g-100),l=!1;else try{s="req"+s+"_";try{var a=r instanceof Map?r:Object.entries(r);for(let[t,r]of a){let n=r;o(r)&&(n=el(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return t.G=e=e.i.splice(0,r),a}function tU(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;S||x(),A||(S(),A=!0),C.add(t,e),e.A=0}}function tB(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eT(u(e.Da,e),tH(e,e.A)),e.A++,!0)}function tz(e){null!=e.B&&(a.clearTimeout(e.B),e.B=null)}function tq(e){e.g=new eR(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e6(t,"RID","rpc"),e6(t,"SID",e.M),e6(t,"AID",e.K),e6(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e6(t,"TO",e.ia),e6(t,"TYPE","xmlhttp"),tF(e,t),e.u&&e.o&&tw(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=e3(e0(t)),r.u=null,r.R=!0,eM(r,e)}function tj(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function t$(e,t){var r,n=null;if(e.g==t){tj(e),tz(e),e.g=null;var i=2}else{if(!eW(e.h,t))return;n=t.G,eY(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){n=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;er(i=ev(),new e_(i,n)),tO(e)}else tU(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(r=t,!(eG(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=r.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eT(u(e.Ea,e,r),tH(e,e.D)),e.D++,!0)))||2==i&&tB(e)))switch(n&&n.length>0&&((t=e.h).i=t.i.concat(n)),s){case 1:tK(e,5);break;case 4:tK(e,10);break;case 3:tK(e,6);break;default:tK(e,2)}}}function tH(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function tK(e,t){if(e.j.info("Error code "+t),2==t){var r=u(e.bb,e),n=e.Ua;let t=!n;n=new eZ(n||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e1(n,"https"),e3(n),t?function(e,t){let r=new eS;if(a.Image){let n=new Image;n.onload=h(td,r,"TestLoadImage: loaded",!0,t,n),n.onerror=h(td,r,"TestLoadImage: error",!1,t,n),n.onabort=h(td,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=h(td,r,"TestLoadImage: timeout",!1,t,n),a.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),r):function(e,t){let r=new eS,n=new AbortController,i=setTimeout(()=>{n.abort(),td(r,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(i),e.ok?td(r,"TestPingServer: ok",!0,t):td(r,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(i),td(r,"TestPingServer: error",!1,t)})}(n.toString(),r)}else eI(2);e.I=0,e.l&&e.l.pa(t),tG(e),tP(e)}function tG(e){if(e.I=0,e.ja=[],e.l){let t=eJ(e.h);(0!=t.length||0!=e.i.length)&&(I(e.ja,t),I(e.ja,e.i),e.h.i.length=0,E(e.i),e.i.length=0),e.l.oa()}}function tW(e,t,r){var n=r instanceof eZ?e0(r):new eZ(r);if(""!=n.g)t&&(n.g=t+"."+n.g),e2(n,n.u);else{var i=a.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);n&&e1(e,n),t&&(e.g=t),i&&e2(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&e6(n,r,t),e6(n,"VER",e.ka),tF(e,n),n}function tQ(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tE(e.Aa&&!e.ma?new tp({ab:r}):e.ma)).Fa(e.L),t}function tY(){}function tJ(){}function tX(e,t){et.call(this),this.g=new tR(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!L(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!L(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){em.call(this),this.status=1}function t1(e){this.g=e}(t=tE.prototype).Fa=function(e){this.H=e},t.ea=function(t,r,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);r=r?r.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=w(u(this.Ca,this));try{this.B=!0,this.g.open(r,String(t),!0),this.B=!1}catch(e){tT(this,e);return}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)n.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())n.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,o]of(i=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&t instanceof a.FormData,!(Array.prototype.indexOf.call(t_,r,void 0)>=0)||i||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(e,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tT(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,er(this,"complete"),er(this,"abort"),tC(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tC(this,!0)),tE.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tA(this):this.Xa())},t.Xa=function(){tA(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tx(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eu(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tR.prototype).ka=8,t.I=1,t.connect=function(e,t,r,n){eI(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=tW(this,null,this.W),tO(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new eR(this,this.j,e),s=this.o;if(this.U&&(s?q(s=B(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){t:{var n=this.i[r];if("__data__"in n.map&&"string"==typeof(n=n.map.__data__)){n=n.length;break t}n=void 0}if(void 0===n)break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=tV(this,i,t),e6(r=e0(this.J),"RID",e),e6(r,"CVER",22),this.G&&e6(r,"X-HTTP-Session-Id",this.G),tF(this,r),s&&(this.R?t="headers="+eN(tb(s))+"&"+t:this.u&&tw(r,this.u,s)),eQ(this.h,i),this.Ra&&e6(r,"TYPE","init"),this.S?(e6(r,"$req",t),e6(r,"SID","null"),i.U=!0,eO(i,r,null)):eO(i,r,t),this.I=2}}else 3==this.I&&(e?tM(this,e):0==this.i.length||eK(this.h)||tM(this))},t.Da=function(){if(this.v=null,tq(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eT(u(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eI(10),tL(this),tq(this))},t.Va=function(){null!=this.C&&(this.C=null,tL(this),tB(this),eI(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eI(2)):(this.j.info("Failed to ping google.com"),eI(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tJ.prototype.g=function(e,t){return new tX(e,t)},c(tX,et),tX.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tX.prototype.close=function(){tD(this.g)},tX.prototype.o=function(e){var t=this.g;if("string"==typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=el(e),e=r);t.i.push(new e$(t.Ya++,e)),3==t.I&&tO(t)},tX.prototype.N=function(){this.g.l=null,delete this.j,tD(this.g),delete this.g,tX.Z.N.call(this)},c(tZ,ep),c(t0,em),c(t1,tY),t1.prototype.ra=function(){er(this.g,"a")},t1.prototype.qa=function(e){er(this.g,new tZ(e))},t1.prototype.pa=function(e){er(this.g,new t0)},t1.prototype.oa=function(){er(this.g,"b")},tJ.prototype.createWebChannel=tJ.prototype.g,tX.prototype.send=tX.prototype.o,tX.prototype.open=tX.prototype.m,tX.prototype.close=tX.prototype.close,b=rk.createWebChannelTransport=function(){return new tJ},v=rk.getStatEventTarget=function(){return ev()},y=rk.Event=eg,g=rk.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},eC.NO_ERROR=0,eC.TIMEOUT=8,eC.HTTP_ERROR=6,m=rk.ErrorCode=eC,ex.COMPLETE="complete",p=rk.EventType=ex,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,f=rk.WebChannel=ed,rk.FetchXmlHttpFactory=tp,tE.prototype.listenOnce=tE.prototype.K,tE.prototype.getLastError=tE.prototype.Ha,tE.prototype.getLastErrorCode=tE.prototype.ya,tE.prototype.getStatus=tE.prototype.ca,tE.prototype.getResponseJson=tE.prototype.La,tE.prototype.getResponseText=tE.prototype.la,tE.prototype.send=tE.prototype.ea,tE.prototype.setWithCredentials=tE.prototype.Fa,d=rk.XhrIo=tE}).apply(void 0!==rx?rx:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{}),w=function(e){for(var t,r=e.length,n=r%3,i=[],s=0,a=r-n;s<a;s+=16383)i.push(function(e,t,r){for(var n,i=[],s=t;s<r;s+=3)n=(e[s]<<16&0xff0000)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(rN[n>>18&63]+rN[n>>12&63]+rN[n>>6&63]+rN[63&n]);return i.join("")}(e,s,s+16383>a?a:s+16383));return 1===n?i.push(rN[(t=e[r-1])>>2]+rN[t<<4&63]+"=="):2===n&&i.push(rN[(t=(e[r-2]<<8)+e[r-1])>>10]+rN[t>>4&63]+rN[t<<2&63]+"="),i.join("")};for(var rN=[],rR=[],rD="undefined"!=typeof Uint8Array?Uint8Array:Array,rL="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rP=0,rO=rL.length;rP<rO;++rP)rN[rP]=rL[rP],rR[rL.charCodeAt(rP)]=rP;rR[45]=62,rR[95]=63,E=function(e,t,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,h=-7,c=r?i-1:0,d=r?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-h)-1,f>>=-h,h+=o;h>0;s=256*s+e[t+c],c+=d,h-=8);for(a=s&(1<<-h)-1,s>>=-h,h+=n;h>0;a=256*a+e[t+c],c+=d,h-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},I=function(e,t,r,n,i,s){var a,o,l,u=8*s-i-1,h=(1<<u)-1,c=h>>1,d=5960464477539062e-23*(23===i),f=n?0:s-1,p=n?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=h):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=h?(o=0,a=h):a+c>=1?(o=(t*l-1)*Math.pow(2,i),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[r+f]=255&a,f+=p,a/=256,u-=8);e[r+f-p]|=128*m};var rM="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function rF(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,rV.prototype),t}function rV(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return rz(e)}return rU(e,t,r)}function rU(e,t,r){if("string"==typeof e){var n=e,i=t;if(("string"!=typeof i||""===i)&&(i="utf8"),!rV.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|rH(n,i),a=rF(s),o=a.write(n,i);return o!==s&&(a=a.slice(0,o)),a}if(ArrayBuffer.isView(e)){var l=e;if(r4(l,Uint8Array)){var u=new Uint8Array(l);return rj(u.buffer,u.byteOffset,u.byteLength)}return rq(l)}if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(r4(e,ArrayBuffer)||e&&r4(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(r4(e,SharedArrayBuffer)||e&&r4(e.buffer,SharedArrayBuffer)))return rj(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var h=e.valueOf&&e.valueOf();if(null!=h&&h!==e)return rV.from(h,t,r);var c=function(e){if(rV.isBuffer(e)){var t=0|r$(e.length),r=rF(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?rF(0):rq(e):"Buffer"===e.type&&Array.isArray(e.data)?rq(e.data):void 0}(e);if(c)return c;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return rV.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function rB(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function rz(e){return rB(e),rF(e<0?0:0|r$(e))}function rq(e){for(var t=e.length<0?0:0|r$(e.length),r=rF(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function rj(e,t,r){var n;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),rV.prototype),n}function r$(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function rH(e,t){if(rV.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||r4(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return r5(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return r6(e).length;default:if(i)return n?-1:r5(e).length;t=(""+t).toLowerCase(),i=!0}}function rK(e,t,r){var n,i,s,a=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=t;s<r;++s)i+=r8[e[s]];return i}(this,t,r);case"utf8":case"utf-8":return rY(this,t,r);case"ascii":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}(this,t,r);case"latin1":case"binary":return function(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}(this,t,r);case"base64":return n=this,i=t,s=r,0===i&&s===n.length?w(n):w(n.slice(i,s));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,t,r);default:if(a)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function rG(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function rW(e,t,r,n,i){var s;if(0===e.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(i)return -1;else r=e.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof t&&(t=rV.from(t,n)),rV.isBuffer(t))return 0===t.length?-1:rQ(e,t,r,n,i);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return rQ(e,[t],r,n,i)}throw TypeError("val must be string, number or Buffer")}function rQ(e,t,r,n,i){var s,a=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,r/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var h=-1;for(s=r;s<o;s++)if(u(e,s)===u(t,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===l)return h*a}else -1!==h&&(s-=s-h),h=-1}else for(r+l>o&&(r=o-l),s=r;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(u(e,s+d)!==u(t,d)){c=!1;break}if(c)return s}return -1}function rY(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var s,a,o,l,u=e[i],h=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c<=r)switch(c){case 1:u<128&&(h=u);break;case 2:(192&(s=e[i+1]))==128&&(l=(31&u)<<6|63&s)>127&&(h=l);break;case 3:s=e[i+1],a=e[i+2],(192&s)==128&&(192&a)==128&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(h=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(h=l)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}var d=n,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",m=0;m<f;)p+=String.fromCharCode.apply(String,d.slice(m,m+=4096));return p}function rJ(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function rX(e,t,r,n,i,s){if(!rV.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw RangeError('"value" argument is out of bounds');if(r+n>e.length)throw RangeError("Index out of range")}function rZ(e,t,r,n,i,s){if(r+n>e.length||r<0)throw RangeError("Index out of range")}function r0(e,t,r,n,i){return t*=1,r>>>=0,i||rZ(e,t,r,4,34028234663852886e22,-34028234663852886e22),I(e,t,r,n,23,4),r+4}function r1(e,t,r,n,i){return t*=1,r>>>=0,i||rZ(e,t,r,8,17976931348623157e292,-17976931348623157e292),I(e,t,r,n,52,8),r+8}rV.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),rV.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(rV.prototype,"parent",{enumerable:!0,get:function(){if(rV.isBuffer(this))return this.buffer}}),Object.defineProperty(rV.prototype,"offset",{enumerable:!0,get:function(){if(rV.isBuffer(this))return this.byteOffset}}),rV.poolSize=8192,rV.from=function(e,t,r){return rU(e,t,r)},Object.setPrototypeOf(rV.prototype,Uint8Array.prototype),Object.setPrototypeOf(rV,Uint8Array),rV.alloc=function(e,t,r){return(rB(e),e<=0)?rF(e):void 0!==t?"string"==typeof r?rF(e).fill(t,r):rF(e).fill(t):rF(e)},rV.allocUnsafe=function(e){return rz(e)},rV.allocUnsafeSlow=function(e){return rz(e)},rV.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==rV.prototype},rV.compare=function(e,t){if(r4(e,Uint8Array)&&(e=rV.from(e,e.offset,e.byteLength)),r4(t,Uint8Array)&&(t=rV.from(t,t.offset,t.byteLength)),!rV.isBuffer(e)||!rV.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);i<s;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:+(n<r)},rV.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},rV.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return rV.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,n=rV.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var s=e[r];if(r4(s,Uint8Array))i+s.length>n.length?rV.from(s).copy(n,i):Uint8Array.prototype.set.call(n,s,i);else if(rV.isBuffer(s))s.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=s.length}return n},rV.byteLength=rH,rV.prototype._isBuffer=!0,rV.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)rG(this,t,t+1);return this},rV.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)rG(this,t,t+3),rG(this,t+1,t+2);return this},rV.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)rG(this,t,t+7),rG(this,t+1,t+6),rG(this,t+2,t+5),rG(this,t+3,t+4);return this},rV.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?rY(this,0,e):rK.apply(this,arguments)},rV.prototype.toLocaleString=rV.prototype.toString,rV.prototype.equals=function(e){if(!rV.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===rV.compare(this,e)},rV.prototype.inspect=function(){var e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},rM&&(rV.prototype[rM]=rV.prototype.inspect),rV.prototype.compare=function(e,t,r,n,i){if(r4(e,Uint8Array)&&(e=rV.from(e,e.offset,e.byteLength)),!rV.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,i>>>=0,this===e)return 0;for(var s=i-n,a=r-t,o=Math.min(s,a),l=this.slice(n,i),u=e.slice(t,r),h=0;h<o;++h)if(l[h]!==u[h]){s=l[h],a=u[h];break}return s<a?-1:+(a<s)},rV.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},rV.prototype.indexOf=function(e,t,r){return rW(this,e,t,r,!0)},rV.prototype.lastIndexOf=function(e,t,r){return rW(this,e,t,r,!1)},rV.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,a,o,l,u,h,c,d=this.length-t;if((void 0===r||r>d)&&(r=d),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var f=!1;;)switch(n){case"hex":return function(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=t.length;n>s/2&&(n=s/2);for(var a=0;a<n;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[r+a]=l}return a}(this,e,t,r);case"utf8":case"utf-8":return i=t,s=r,r3(r5(e,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return a=t,o=r,r3(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(e),this,a,o);case"base64":return l=t,u=r,r3(r6(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return h=t,c=r,r3(function(e,t){for(var r,n,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(e,this.length-h),this,h,c);default:if(f)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),f=!0}},rV.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},rV.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,rV.prototype),n},rV.prototype.readUintLE=rV.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||rJ(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n},rV.prototype.readUintBE=rV.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||rJ(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},rV.prototype.readUint8=rV.prototype.readUInt8=function(e,t){return e>>>=0,t||rJ(e,1,this.length),this[e]},rV.prototype.readUint16LE=rV.prototype.readUInt16LE=function(e,t){return e>>>=0,t||rJ(e,2,this.length),this[e]|this[e+1]<<8},rV.prototype.readUint16BE=rV.prototype.readUInt16BE=function(e,t){return e>>>=0,t||rJ(e,2,this.length),this[e]<<8|this[e+1]},rV.prototype.readUint32LE=rV.prototype.readUInt32LE=function(e,t){return e>>>=0,t||rJ(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},rV.prototype.readUint32BE=rV.prototype.readUInt32BE=function(e,t){return e>>>=0,t||rJ(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},rV.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||rJ(e,t,this.length);for(var n=this[e],i=1,s=0;++s<t&&(i*=256);)n+=this[e+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},rV.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||rJ(e,t,this.length);for(var n=t,i=1,s=this[e+--n];n>0&&(i*=256);)s+=this[e+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},rV.prototype.readInt8=function(e,t){return(e>>>=0,t||rJ(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},rV.prototype.readInt16LE=function(e,t){e>>>=0,t||rJ(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},rV.prototype.readInt16BE=function(e,t){e>>>=0,t||rJ(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},rV.prototype.readInt32LE=function(e,t){return e>>>=0,t||rJ(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},rV.prototype.readInt32BE=function(e,t){return e>>>=0,t||rJ(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},rV.prototype.readFloatLE=function(e,t){return e>>>=0,t||rJ(e,4,this.length),E(this,e,!0,23,4)},rV.prototype.readFloatBE=function(e,t){return e>>>=0,t||rJ(e,4,this.length),E(this,e,!1,23,4)},rV.prototype.readDoubleLE=function(e,t){return e>>>=0,t||rJ(e,8,this.length),E(this,e,!0,52,8)},rV.prototype.readDoubleBE=function(e,t){return e>>>=0,t||rJ(e,8,this.length),E(this,e,!1,52,8)},rV.prototype.writeUintLE=rV.prototype.writeUIntLE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;rX(this,e,t,r,i,0)}var s=1,a=0;for(this[t]=255&e;++a<r&&(s*=256);)this[t+a]=e/s&255;return t+r},rV.prototype.writeUintBE=rV.prototype.writeUIntBE=function(e,t,r,n){if(e*=1,t>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;rX(this,e,t,r,i,0)}var s=r-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+r},rV.prototype.writeUint8=rV.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,1,255,0),this[t]=255&e,t+1},rV.prototype.writeUint16LE=rV.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},rV.prototype.writeUint16BE=rV.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},rV.prototype.writeUint32LE=rV.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},rV.prototype.writeUint32BE=rV.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},rV.prototype.writeIntLE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);rX(this,e,t,r,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<r&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},rV.prototype.writeIntBE=function(e,t,r,n){if(e*=1,t>>>=0,!n){var i=Math.pow(2,8*r-1);rX(this,e,t,r,i-1,-i)}var s=r-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+r},rV.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},rV.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},rV.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},rV.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},rV.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||rX(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},rV.prototype.writeFloatLE=function(e,t,r){return r0(this,e,t,!0,r)},rV.prototype.writeFloatBE=function(e,t,r){return r0(this,e,t,!1,r)},rV.prototype.writeDoubleLE=function(e,t,r){return r1(this,e,t,!0,r)},rV.prototype.writeDoubleBE=function(e,t,r){return r1(this,e,t,!1,r)},rV.prototype.copy=function(e,t,r,n){if(!rV.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},rV.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!rV.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===e.length){var i,s=e.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var a=rV.isBuffer(e)?e:rV.from(e,n),o=a.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=a[i%o]}return this};var r2=/[^+/0-9A-Za-z-_]/g;function r5(e,t){t=t||1/0;for(var r,n=e.length,i=null,s=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319||a+1===n){(t-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;s.push(r)}else if(r<2048){if((t-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function r6(e){return function(e){var t,r,n=function(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var n=r===t?0:4-r%4;return[r,n]}(e),i=n[0],s=n[1],a=new rD((i+s)*3/4-s),o=0,l=s>0?i-4:i;for(r=0;r<l;r+=4)t=rR[e.charCodeAt(r)]<<18|rR[e.charCodeAt(r+1)]<<12|rR[e.charCodeAt(r+2)]<<6|rR[e.charCodeAt(r+3)],a[o++]=t>>16&255,a[o++]=t>>8&255,a[o++]=255&t;return 2===s&&(t=rR[e.charCodeAt(r)]<<2|rR[e.charCodeAt(r+1)]>>4,a[o++]=255&t),1===s&&(t=rR[e.charCodeAt(r)]<<10|rR[e.charCodeAt(r+1)]<<4|rR[e.charCodeAt(r+2)]>>2,a[o++]=t>>8&255,a[o++]=255&t),a}(function(e){if((e=(e=e.split("=")[0]).trim().replace(r2,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function r3(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length)&&!(i>=e.length);++i)t[i+r]=e[i];return i}function r4(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var r8=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}();const r7="@firebase/firestore",r9="4.9.2";class ne{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ne.UNAUTHENTICATED=new ne(null),ne.GOOGLE_CREDENTIALS=new ne("google-credentials-uid"),ne.FIRST_PARTY=new ne("first-party-uid"),ne.MOCK_USER=new ne("mock-user");let nt="12.3.0";const nr=new tG("@firebase/firestore");function nn(){return nr.logLevel}function ni(e,...t){if(nr.logLevel<=u.DEBUG){let r=t.map(no);nr.debug(`Firestore (${nt}): ${e}`,...r)}}function ns(e,...t){if(nr.logLevel<=u.ERROR){let r=t.map(no);nr.error(`Firestore (${nt}): ${e}`,...r)}}function na(e,...t){if(nr.logLevel<=u.WARN){let r=t.map(no);nr.warn(`Firestore (${nt}): ${e}`,...r)}}function no(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function nl(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,nu(e,n,r)}function nu(e,t,r){let n=`FIRESTORE (${nt}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw ns(n),Error(n)}function nh(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||nu(t,i,n)}const nc={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class nd extends tC{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class nf{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class np{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class nm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ne.UNAUTHENTICATED))}shutdown(){}}class ng{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ny{constructor(e){this.t=e,this.currentUser=ne.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){nh(void 0===this.o,42304);let r=this.i,n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve(),i=new nf;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new nf,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{ni("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(ni("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new nf)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ni("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(nh("string"==typeof t.accessToken,31837,{l:t}),new np(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return nh(null===e||"string"==typeof e,2055,{h:e}),new ne(e)}}class nv{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=ne.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class nb{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new nv(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(ne.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class nw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nE{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ru(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){nh(void 0===this.o,3512);let r=e=>{null!=e.error&&ni("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.m;return this.m=e.token,ni("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{ni("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?n(e):ni("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new nw(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(nh("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new nw(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class nI{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let e=0;e<40;e++)r[e]=Math.floor(256*Math.random());return r}(40);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function n_(e,t){return e<t?-1:+(e>t)}function nT(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return nS(r)===nS(i)?n_(r,i):nS(r)?1:-1}return n_(e.length,t.length)}function nS(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function nA(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}const nC="__name__";class nx{constructor(e,t,r){void 0===t?t=0:t>e.length&&nl(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&nl(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===nx.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof nx?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=nx.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return n_(e.length,t.length)}static compareSegments(e,t){let r=nx.isNumericId(e),n=nx.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?nx.extractNumericId(e).compare(nx.extractNumericId(t)):nT(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return h.fromString(e.substring(4,e.length-2))}}class nk extends nx{construct(e,t,r){return new nk(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new nd(nc.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new nk(t)}static emptyPath(){return new nk([])}}const nN=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nR extends nx{construct(e,t,r){return new nR(e,t,r)}static isValidIdentifier(e){return nN.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),nR.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===nC}static keyField(){return new nR([nC])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new nd(nc.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new nd(nc.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new nd(nc.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new nd(nc.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new nR(t)}static emptyPath(){return new nR([])}}class nD{constructor(e){this.path=e}static fromPath(e){return new nD(nk.fromString(e))}static fromName(e){return new nD(nk.fromString(e).popFirst(5))}static empty(){return new nD(nk.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===nk.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return nk.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new nD(new nk(e.slice()))}}function nL(e,t,r){if(!r)throw new nd(nc.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function nP(e){if(!nD.isDocumentKey(e))throw new nd(nc.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function nO(e){if(nD.isDocumentKey(e))throw new nd(nc.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function nM(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function nF(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let r=(t=e).constructor?t.constructor.name:null;return r?`a custom ${r} object`:"an object"}}return"function"==typeof e?"a function":nl(12329,{type:typeof e})}function nV(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new nd(nc.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=nF(e);throw new nd(nc.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function nU(e,t){let r={typeString:e};return t&&(r.value=t),r}function nB(e,t){let r;if(!nM(e))throw new nd(nc.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new nd(nc.INVALID_ARGUMENT,r);return!0}class nz{static now(){return nz.fromMillis(Date.now())}static fromDate(e){return nz.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*1e6);return new nz(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new nd(nc.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new nd(nc.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?n_(this.nanoseconds,e.nanoseconds):n_(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:nz._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(nB(e,nz._jsonSchema))return new nz(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}nz._jsonSchemaVersion="firestore/timestamp/1.0",nz._jsonSchema={type:nU("string",nz._jsonSchemaVersion),seconds:nU("number"),nanoseconds:nU("number")};class nq{static fromTimestamp(e){return new nq(e)}static min(){return new nq(new nz(0,0))}static max(){return new nq(new nz(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class nj{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function n$(e){return e.fields.find(e=>2===e.kind)}function nH(e){return e.fields.filter(e=>2!==e.kind)}nj.UNKNOWN_ID=-1;class nK{constructor(e,t){this.fieldPath=e,this.kind=t}}class nG{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new nG(0,nQ.min())}}function nW(e){return new nQ(e.readTime,e.key,-1)}class nQ{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new nQ(nq.min(),nD.empty(),-1)}static max(){return new nQ(nq.max(),nD.empty(),-1)}}function nY(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=nD.comparator(e.documentKey,t.documentKey))?r:n_(e.largestBatchId,t.largestBatchId)}const nJ="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class nX{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function nZ(e){if(e.code!==nc.FAILED_PRECONDITION||e.message!==nJ)throw e;ni("LocalStore","Unexpectedly lost primary lease")}class n0{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&nl(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n0((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n0?t:n0.resolve(t)}catch(e){return n0.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n0.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n0.reject(t)}static resolve(e){return new n0((t,r)=>{t(e)})}static reject(e){return new n0((t,r)=>{r(e)})}static waitFor(e){return new n0((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=n0.resolve(!1);for(let r of e)t=t.next(e=>e?n0.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new n0((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new n0((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}const n1="SimpleDb";class n2{static open(e,t,r,n){try{return new n2(t,e.transaction(n,r))}catch(e){throw new n4(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new nf,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new n4(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let r=it(t.target.error);this.S.reject(new n4(e,r))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(ni(n1,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new n7(this.transaction.objectStore(e))}}class n5{static delete(e){return ni(n1,"Removing database:",e),n9(to().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!tA())return!1;if(n5.F())return!0;let e=tI(),t=n5.M(e),r=n6(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<r&&r<4.5)}static F(){return!1}static O(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.N=r,this.B=null,12.2===n5.M(tI())&&ns("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(ni(n1,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new n4(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new nd(nc.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new nd(nc.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new n4(e,n))},n.onupgradeneeded=e=>{ni(n1,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.N.k(t,n.transaction,e.oldVersion,this.version).next(()=>{ni(n1,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.L(e);let t=n2.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),n0.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(ni(n1,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function n6(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class n3{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return n9(this.U.delete())}}class n4 extends nd{constructor(e,t){super(nc.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function n8(e){return"IndexedDbTransactionError"===e.name}class n7{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(ni(n1,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(ni(n1,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),n9(r)}add(e){return ni(n1,"ADD",this.store.name,e,e),n9(this.store.add(e))}get(e){return n9(this.store.get(e)).next(t=>(void 0===t&&(t=null),ni(n1,"GET",this.store.name,e,t),t))}delete(e){return ni(n1,"DELETE",this.store.name,e),n9(this.store.delete(e))}count(){return ni(n1,"COUNT",this.store.name),n9(this.store.count())}J(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new n0((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.H(e,(e,r)=>{t.push(r)}).next(()=>t)}}Y(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new n0((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}Z(e,t){ni(n1,"DELETE ALL",this.store.name);let r=this.options(e,t);r.X=!1;let n=this.cursor(r);return this.H(n,(e,t,r)=>r.delete())}ee(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.H(n,t)}te(e){let t=this.cursor({});return new n0((r,n)=>{t.onerror=e=>{n(it(e.target.error))},t.onsuccess=t=>{let n=t.target.result;n?e(n.primaryKey,n.value).next(e=>{e?n.continue():r()}):r()}})}H(e,t){let r=[];return new n0((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new n3(i),a=t(i.primaryKey,i.value,s);if(a instanceof n0){let e=a.catch(e=>(s.done(),n0.reject(e)));r.push(e)}s.isDone?n():null===s.G?i.continue():i.continue(s.G)}}).next(()=>n0.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function n9(e){return new n0((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(it(e.target.error))}})}let ie=!1;function it(e){let t=n5.M(tI());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new nd("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ie||(ie=!0,setTimeout(()=>{throw e},0)),e}}return e}const ir="IndexBackfiller";class ii{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){ni(ir,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.ne.ie();ni(ir,`Documents written: ${e}`)}catch(e){n8(e)?ni(ir,"Ignoring IndexedDB error during index backfill: ",e):await nZ(e)}await this.re(6e4)})}}class is{constructor(e,t){this.localStore=e,this.persistence=t}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))}se(e,t){let r=new Set,n=t,i=!0;return n0.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!r.has(t))return ni(ir,`Processing collection: ${t}`),this.oe(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}oe(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this._e(n,r)).next(r=>(ni(ir,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}_e(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=nW(t);nY(n,r)>0&&(r=n)}),new nQ(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ia{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}ia.ce=-1;function io(e){return 0===e&&1/e==-1/0}function il(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+="\x01\x10";break;case"\x01":r+="\x01\x11";break;default:r+=n}}return r}(e.get(r),t);return t+"\x01\x01"}function iu(e){let t=e.length;if(nh(t>=2,64408,{path:e}),2===t)return nh("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),nk.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>r)&&nl(50515,{path:e}),e.charAt(t+1)){case"\x01":let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:nl(61167,{path:e})}s=t+2}return new nk(n)}const ih="remoteDocuments",ic="owner",id="owner",ip="mutationQueues",im="mutations",ig="batchId",iy="userMutationsIndex",iv=["userId","batchId"],ib={},iw="documentMutations",iE="remoteDocumentsV14",iI=["prefixPath","collectionGroup","readTime","documentId"],i_="documentKeyIndex",iT=["prefixPath","collectionGroup","documentId"],iS="collectionGroupIndex",iA=["collectionGroup","readTime","prefixPath","documentId"],iC="remoteDocumentGlobal",ix="remoteDocumentGlobalKey",ik="targets",iN="queryTargetsIndex",iR=["canonicalId","targetId"],iD="targetDocuments",iL=["targetId","path"],iP="documentTargetsIndex",iO=["path","targetId"],iM="targetGlobalKey",iF="targetGlobal",iV="collectionParents",iU=["collectionId","parent"],iB="clientMetadata",iz="bundles",iq="namedQueries",ij="indexConfiguration",i$="collectionGroupIndex",iH="indexState",iK=["indexId","uid"],iG="sequenceNumberIndex",iW=["uid","sequenceNumber"],iQ="indexEntries",iY=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],iJ="documentKeyIndex",iX=["indexId","uid","orderedDocumentKey"],iZ="documentOverlays",i0=["userId","collectionPath","documentId"],i1="collectionPathOverlayIndex",i2=["userId","collectionPath","largestBatchId"],i5="collectionGroupOverlayIndex",i6=["userId","collectionGroup","largestBatchId"],i3="globals",i4=[ip,im,iw,ih,ik,ic,iF,iD,iB,iC,iV,iz,iq],i8=[...i4,iZ],i7=[ip,im,iw,iE,ik,ic,iF,iD,iB,iC,iV,iz,iq,iZ],i9=[...i7,ij,iH,iQ],se=[...i9,i3];class st extends nX{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function sr(e,t){return n5.O(e.le,t)}function sn(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function si(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function ss(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class sa{constructor(e,t){this.comparator=e,this.root=t||sl.EMPTY}insert(e,t){return new sa(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sl.BLACK,null,null))}remove(e){return new sa(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new so(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new so(this.root,e,this.comparator,!1)}getReverseIterator(){return new so(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new so(this.root,e,this.comparator,!0)}}class so{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sl{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:sl.RED,this.left=null!=n?n:sl.EMPTY,this.right=null!=i?i:sl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new sl(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return sl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return sl.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,sl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,sl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw nl(43730,{key:this.key,value:this.value});if(this.right.isRed())throw nl(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw nl(27949);return e+ +!this.isRed()}}sl.EMPTY=null,sl.RED=!0,sl.BLACK=!1,sl.EMPTY=new class{constructor(){this.size=0}get key(){throw nl(57766)}get value(){throw nl(16141)}get color(){throw nl(16727)}get left(){throw nl(29726)}get right(){throw nl(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new sl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class su{constructor(e){this.comparator=e,this.data=new sa(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sh(this.data.getIterator())}getIteratorFrom(e){return new sh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof su)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new su(this.comparator);return t.data=e,t}}class sh{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sc(e){return e.hasNext()?e.getNext():void 0}class sd{constructor(e){this.fields=e,e.sort(nR.comparator)}static empty(){return new sd([])}unionWith(e){let t=new su(nR.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new sd(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return nA(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class sf extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class sp{constructor(e){this.binaryString=e}static fromBase64String(e){return new sp(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new sf("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new sp(function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return n_(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sp.EMPTY_BYTE_STRING=new sp("");const sm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sg(e){if(nh(!!e,39018),"string"==typeof e){let t=0,r=sm.exec(e);if(nh(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:sy(e.seconds),nanos:sy(e.nanos)}}function sy(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sv(e){return"string"==typeof e?sp.fromBase64String(e):sp.fromUint8Array(e)}const sb="server_timestamp",sw="__type__",sE="__previous_value__",sI="__local_write_time__";function s_(e){return(e?.mapValue?.fields||{})[sw]?.stringValue===sb}function sT(e){let t=e.mapValue.fields[sE];return s_(t)?sT(t):t}function sS(e){let t=sg(e.mapValue.fields[sI].timestampValue);return new nz(t.seconds,t.nanos)}class sA{constructor(e,t,r,n,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}const sC="(default)";class sx{constructor(e,t){this.projectId=e,this.database=t||sC}static empty(){return new sx("","")}get isDefaultDatabase(){return this.database===sC}isEqual(e){return e instanceof sx&&e.projectId===this.projectId&&e.database===this.database}}const sk="__type__",sN="__max__",sR={mapValue:{fields:{__type__:{stringValue:sN}}}},sD="__vector__",sL="value",sP={nullValue:"NULL_VALUE"};function sO(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?s_(e)?4:sY(e)?0x1fffffffffffff:sW(e)?10:11:nl(28295,{value:e})}function sM(e,t){if(e===t)return!0;let r=sO(e);if(r!==sO(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return sS(e).isEqual(sS(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=sg(e.timestampValue),i=sg(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return sv(e.bytesValue).isEqual(sv(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return sy(e.geoPointValue.latitude)===sy(t.geoPointValue.latitude)&&sy(e.geoPointValue.longitude)===sy(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return sy(e.integerValue)===sy(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=sy(e.doubleValue),n=sy(t.doubleValue);return r===n?io(r)===io(n):isNaN(r)&&isNaN(n)}return!1;case 9:return nA(e.arrayValue.values||[],t.arrayValue.values||[],sM);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(sn(s)!==sn(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!sM(s[e],a[e])))return!1;return!0;default:return nl(52216,{left:e})}}function sF(e,t){return void 0!==(e.values||[]).find(e=>sM(e,t))}function sV(e,t){if(e===t)return 0;let r=sO(e),n=sO(t);if(r!==n)return n_(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return n_(e.booleanValue,t.booleanValue);case 2:let i=sy(e.integerValue||e.doubleValue),s=sy(t.integerValue||t.doubleValue);return i<s?-1:i>s?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return sU(e.timestampValue,t.timestampValue);case 4:return sU(sS(e),sS(t));case 5:return nT(e.stringValue,t.stringValue);case 6:return function(e,t){let r=sv(e),n=sv(t);return r.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=n_(r[e],n[e]);if(0!==t)return t}return n_(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let r=n_(sy(e.latitude),sy(t.latitude));return 0!==r?r:n_(sy(e.longitude),sy(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return sB(e.arrayValue,t.arrayValue);case 10:return function(e,t){let r=e.fields||{},n=t.fields||{},i=r[sL]?.arrayValue,s=n[sL]?.arrayValue,a=n_(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:sB(i,s)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===sR.mapValue&&t===sR.mapValue)return 0;if(e===sR.mapValue)return 1;if(t===sR.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=nT(n[e],s[e]);if(0!==t)return t;let a=sV(r[n[e]],i[s[e]]);if(0!==a)return a}return n_(n.length,s.length)}(e.mapValue,t.mapValue);default:throw nl(23264,{he:r})}}function sU(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return n_(e,t);let r=sg(e),n=sg(t),i=n_(r.seconds,n.seconds);return 0!==i?i:n_(r.nanos,n.nanos)}function sB(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=sV(r[e],n[e]);if(t)return t}return n_(r.length,n.length)}function sz(e){var t,r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=sg(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?sv(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,nD.fromName(t).toString()):"geoPointValue"in e?(r=e.geoPointValue,`geo(${r.latitude},${r.longitude})`):"arrayValue"in e?function(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=sz(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${sz(e.fields[i])}`;return r+"}"}(e.mapValue):nl(61005,{value:e})}function sq(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function sj(e){return!!e&&"integerValue"in e}function s$(e){return!!e&&"arrayValue"in e}function sH(e){return!!e&&"nullValue"in e}function sK(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function sG(e){return!!e&&"mapValue"in e}function sW(e){return(e?.mapValue?.fields||{})[sk]?.stringValue===sD}function sQ(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return si(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=sQ(r)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=sQ(e.arrayValue.values[r]);return t}return{...e}}function sY(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===sN}const sJ={mapValue:{fields:{[sk]:{stringValue:sD},[sL]:{arrayValue:{}}}}};function sX(e,t){let r=sV(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function sZ(e,t){let r=sV(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class s0{constructor(e){this.value=e}static empty(){return new s0({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!sG(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sQ(t)}setAll(e){let t=nR.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=sQ(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());sG(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sM(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];sG(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(si(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new s0(sQ(this.value))}}class s1{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new s1(e,0,nq.min(),nq.min(),nq.min(),s0.empty(),0)}static newFoundDocument(e,t,r,n){return new s1(e,1,t,nq.min(),r,n,0)}static newNoDocument(e,t){return new s1(e,2,t,nq.min(),nq.min(),s0.empty(),0)}static newUnknownDocument(e,t){return new s1(e,3,t,nq.min(),nq.min(),s0.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(nq.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=s0.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=s0.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=nq.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof s1&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new s1(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class s2{constructor(e,t){this.position=e,this.inclusive=t}}function s5(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?nD.comparator(nD.fromName(a.referenceValue),r.key):sV(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function s6(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!sM(e.position[r],t.position[r]))return!1;return!0}class s3{constructor(e,t="asc"){this.field=e,this.dir=t}}class s4{}class s8 extends s4{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new ai(e,t,r):"array-contains"===t?new al(e,r):"in"===t?new au(e,r):"not-in"===t?new ah(e,r):"array-contains-any"===t?new ac(e,r):new s8(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new as(e,r):new aa(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(sV(t,this.value)):null!==t&&sO(this.value)===sO(t)&&this.matchesComparison(sV(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return nl(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class s7 extends s4{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new s7(e,t)}matches(e){return s9(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function s9(e){return"and"===e.op}function ae(e){return"or"===e.op}function at(e){return ar(e)&&s9(e)}function ar(e){for(let t of e.filters)if(t instanceof s7)return!1;return!0}function an(e,t){let r=e.filters.concat(t);return s7.create(r,e.op)}class ai extends s8{constructor(e,t,r){super(e,t,r),this.key=nD.fromName(r.referenceValue)}matches(e){let t=nD.comparator(e.key,this.key);return this.matchesComparison(t)}}class as extends s8{constructor(e,t){super(e,"in",t),this.keys=ao("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class aa extends s8{constructor(e,t){super(e,"not-in",t),this.keys=ao("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ao(e,t){return(t.arrayValue?.values||[]).map(e=>nD.fromName(e.referenceValue))}class al extends s8{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return s$(t)&&sF(t.arrayValue,this.value)}}class au extends s8{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&sF(this.value.arrayValue,t)}}class ah extends s8{constructor(e,t){super(e,"not-in",t)}matches(e){if(sF(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!sF(this.value.arrayValue,t)}}class ac extends s8{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!s$(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>sF(this.value.arrayValue,e))}}class ad{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.Te=null}}function af(e,t=null,r=[],n=[],i=null,s=null,a=null){return new ad(e,t,r,n,i,s,a)}function ap(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof s8)return t.field.canonicalString()+t.op.toString()+sz(t.value);if(at(t))return t.filters.map(t=>e(t)).join(",");{let r=t.filters.map(t=>e(t)).join(",");return`${t.op}(${r})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>sz(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>sz(e)).join(",")),e.Te=t}return e.Te}function am(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var r,n;if(r=e.orderBy[i],n=t.orderBy[i],!(r.dir===n.dir&&r.field.isEqual(n.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!function e(t,r){return t instanceof s8?r instanceof s8&&t.op===r.op&&t.field.isEqual(r.field)&&sM(t.value,r.value):t instanceof s7?r instanceof s7&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((t,n,i)=>t&&e(n,r.filters[i]),!0):void nl(19439)}(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!s6(e.startAt,t.startAt)&&s6(e.endAt,t.endAt)}function ag(e){return nD.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ay(e,t){return e.filters.filter(e=>e instanceof s8&&e.field.isEqual(t))}function av(e,t,r){let n=sP,i=!0;for(let r of ay(e,t)){let e=sP,t=!0;switch(r.op){case"<":case"<=":var s;e="nullValue"in(s=r.value)?sP:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?sq(sx.empty(),nD.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?sW(s)?sJ:{mapValue:{}}:nl(35942,{value:s});break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=sP}0>sX({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>sX({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function ab(e,t,r){let n=sR,i=!0;for(let r of ay(e,t)){let e=sR,t=!0;switch(r.op){case">=":case">":var s;e="nullValue"in(s=r.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?sq(sx.empty(),nD.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?sJ:"mapValue"in s?sW(s)?{mapValue:{}}:sR:nl(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=sR}sZ({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];sZ({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}class aw{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function aE(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function aI(e){return null!==e.collectionGroup}function a_(e){if(null===e.Ie){let t;e.Ie=[];let r=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),r.add(t.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new su(nR.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{r.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new s3(t,n))}),r.has(nR.keyField().canonicalString())||e.Ie.push(new s3(nR.keyField(),n))}return e.Ie}function aT(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return af(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new s3(e.field,t)});let r=e.endAt?new s2(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new s2(e.startAt.position,e.startAt.inclusive):null;return af(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}(e,a_(e))),e.Ee}function aS(e,t){let r=e.filters.concat([t]);return new aw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function aA(e,t,r){return new aw(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function aC(e,t){return am(aT(e),aT(t))&&e.limitType===t.limitType}function ax(e){return`${ap(aT(e))}|lt:${e.limitType}`}function ak(e){var t;let r;return`Query(target=${r=(t=aT(e)).path.canonicalString(),null!==t.collectionGroup&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof s8?`${t.field.canonicalString()} ${t.op} ${sz(t.value)}`:t instanceof s7?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(e=>sz(e)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(e=>sz(e)).join(",")),`Target(${r})`}; limitType=${e.limitType})`}function aN(e,t){return t.isFoundDocument()&&function(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):nD.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}(e,t)&&function(e,t){for(let r of a_(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,r){let n=s5(e,t,r);return e.inclusive?n<=0:n<0}(e.startAt,a_(e),t))&&(!e.endAt||!!function(e,t,r){let n=s5(e,t,r);return e.inclusive?n>=0:n>0}(e.endAt,a_(e),t))}function aR(e){return(t,r)=>{let n=!1;for(let i of a_(e)){let e=function(e,t,r){let n=e.field.isKeyField()?nD.comparator(t.key,r.key):function(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?sV(n,i):nl(42886)}(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return nl(19790,{direction:e.dir})}}(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}class aD{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){si(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return ss(this.inner)}size(){return this.innerSize}}const aL=new sa(nD.comparator),aP=new sa(nD.comparator);function aO(...e){let t=aP;for(let r of e)t=t.insert(r.key,r);return t}function aM(e){let t=aP;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function aF(){return new aD(e=>e.toString(),(e,t)=>e.isEqual(t))}const aV=new sa(nD.comparator),aU=new su(nD.comparator);function aB(...e){let t=aU;for(let r of e)t=t.add(r);return t}const az=new su(n_);function aq(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:io(t)?"-0":t}}function aj(e){return{integerValue:""+e}}class a${constructor(){this._=void 0}}function aH(e,t){return e instanceof aJ?sj(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class aK extends a${}class aG extends a${constructor(e){super(),this.elements=e}}function aW(e,t){let r=aZ(t);for(let t of e.elements)r.some(e=>sM(e,t))||r.push(t);return{arrayValue:{values:r}}}class aQ extends a${constructor(e){super(),this.elements=e}}function aY(e,t){let r=aZ(t);for(let t of e.elements)r=r.filter(e=>!sM(e,t));return{arrayValue:{values:r}}}class aJ extends a${constructor(e,t){super(),this.serializer=e,this.Ae=t}}function aX(e){return sy(e.integerValue||e.doubleValue)}function aZ(e){return s$(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class a0{constructor(e,t){this.field=e,this.transform=t}}class a1{constructor(e,t){this.version=e,this.transformResults=t}}class a2{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new a2}static exists(e){return new a2(void 0,e)}static updateTime(e){return new a2(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function a5(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class a6{}function a3(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new on(e.key,a2.none()):new a7(e.key,e.data,a2.none());{let r=e.data,n=s0.empty(),i=new su(nR.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new a9(e.key,n,new sd(i.toArray()),a2.none())}}function a4(e,t,r,n){return e instanceof a7?function(e,t,r,n){if(!a5(e.precondition,t))return r;let i=e.value.clone(),s=or(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof a9?function(e,t,r,n){if(!a5(e.precondition,t))return r;let i=or(e.fieldTransforms,n,t),s=t.data;return(s.setAll(oe(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):a5(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}function a8(e,t){var r,n;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(r=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===r&&void 0===n||!(!r||!n)&&nA(r,n,(e,t)=>{var r,n;return e.field.isEqual(t.field)&&(r=e.transform,n=t.transform,r instanceof aG&&n instanceof aG||r instanceof aQ&&n instanceof aQ?nA(r.elements,n.elements,sM):r instanceof aJ&&n instanceof aJ?sM(r.Ae,n.Ae):r instanceof aK&&n instanceof aK)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class a7 extends a6{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class a9 extends a6{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function oe(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function ot(e,t,r){let n=new Map;nh(e.length===r.length,32656,{Re:r.length,Ve:e.length});for(let s=0;s<r.length;s++){var i;let a=e[s],o=a.transform,l=t.data.field(a.field);n.set(a.field,(i=r[s],o instanceof aG?aW(o,l):o instanceof aQ?aY(o,l):i))}return n}function or(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,e instanceof aK?function(e,t){let r={fields:{[sw]:{stringValue:sb},[sI]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&s_(t)&&(t=sT(t)),t&&(r.fields[sE]=t),{mapValue:r}}(t,s):e instanceof aG?aW(e,s):e instanceof aQ?aY(e,s):function(e,t){let r=aH(e,t),n=aX(r)+aX(e.Ae);return sj(r)&&sj(e.Ae)?aj(n):aq(e.serializer,n)}(e,s))}return n}class on extends a6{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class oi extends a6{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class os{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&function(e,t,r){e instanceof a7?function(e,t,r){let n=e.value.clone(),i=ot(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}(e,t,r):e instanceof a9?function(e,t,r){if(!a5(e.precondition,t))return t.convertToUnknownDocument(r.version);let n=ot(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(oe(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):t.convertToNoDocument(r.version).setHasCommittedMutations()}(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=a4(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=a4(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=aF();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=a3(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(nq.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),aB())}isEqual(e){return this.batchId===e.batchId&&nA(this.mutations,e.mutations,(e,t)=>a8(e,t))&&nA(this.baseMutations,e.baseMutations,(e,t)=>a8(e,t))}}class oa{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){nh(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=aV,i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new oa(e,t,r,n)}}class oo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ol{constructor(e,t){this.count=e,this.unchangedNames=t}}function ou(e){if(void 0===e)return ns("GRPC error has no .code"),nc.UNKNOWN;switch(e){case _.OK:return nc.OK;case _.CANCELLED:return nc.CANCELLED;case _.UNKNOWN:return nc.UNKNOWN;case _.DEADLINE_EXCEEDED:return nc.DEADLINE_EXCEEDED;case _.RESOURCE_EXHAUSTED:return nc.RESOURCE_EXHAUSTED;case _.INTERNAL:return nc.INTERNAL;case _.UNAVAILABLE:return nc.UNAVAILABLE;case _.UNAUTHENTICATED:return nc.UNAUTHENTICATED;case _.INVALID_ARGUMENT:return nc.INVALID_ARGUMENT;case _.NOT_FOUND:return nc.NOT_FOUND;case _.ALREADY_EXISTS:return nc.ALREADY_EXISTS;case _.PERMISSION_DENIED:return nc.PERMISSION_DENIED;case _.FAILED_PRECONDITION:return nc.FAILED_PRECONDITION;case _.ABORTED:return nc.ABORTED;case _.OUT_OF_RANGE:return nc.OUT_OF_RANGE;case _.UNIMPLEMENTED:return nc.UNIMPLEMENTED;case _.DATA_LOSS:return nc.DATA_LOSS;default:return nl(39323,{code:e})}}(T=_||(_={}))[T.OK=0]="OK",T[T.CANCELLED=1]="CANCELLED",T[T.UNKNOWN=2]="UNKNOWN",T[T.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",T[T.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",T[T.NOT_FOUND=5]="NOT_FOUND",T[T.ALREADY_EXISTS=6]="ALREADY_EXISTS",T[T.PERMISSION_DENIED=7]="PERMISSION_DENIED",T[T.UNAUTHENTICATED=16]="UNAUTHENTICATED",T[T.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",T[T.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",T[T.ABORTED=10]="ABORTED",T[T.OUT_OF_RANGE=11]="OUT_OF_RANGE",T[T.UNIMPLEMENTED=12]="UNIMPLEMENTED",T[T.INTERNAL=13]="INTERNAL",T[T.UNAVAILABLE=14]="UNAVAILABLE",T[T.DATA_LOSS=15]="DATA_LOSS";const oh=new h([0xffffffff,0xffffffff],0);function oc(e){let t=(new TextEncoder).encode(e),r=new c;return r.update(t),new Uint8Array(r.digest())}function od(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new h([r,n],0),new h([i,s],0)]}class of{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new op(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new op(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new op(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=h.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(h.fromNumber(r)));return 1===n.compare(oh)&&(n=new h([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,r]=od(oc(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);if(!this.we(n))return!1}return!0}static create(e,t,r){let n=new of(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return r.forEach(e=>n.insert(e)),n}insert(e){if(0===this.ge)return;let[t,r]=od(oc(e));for(let e=0;e<this.hashCount;e++){let n=this.ye(t,r,e);this.Se(n)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class op extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class om{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,og.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new om(nq.min(),n,new sa(n_),aL,aB())}}class og{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new og(r,t,aB(),aB(),aB())}}class oy{constructor(e,t,r,n){this.be=e,this.removedTargetIds=t,this.key=r,this.De=n}}class ov{constructor(e,t){this.targetId=e,this.Ce=t}}class ob{constructor(e,t,r=sp.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class ow{constructor(){this.ve=0,this.Fe=o_(),this.Me=sp.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=aB(),t=aB(),r=aB();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:nl(38017,{changeType:i})}}),new og(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=o_()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,nh(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class oE{constructor(e){this.Ge=e,this.ze=new Map,this.je=aL,this.Je=oI(),this.He=oI(),this.Ye=new sa(n_)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:nl(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){let t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){let i=n.target;if(ag(i))if(0===r){let e=new nD(i.path);this.et(t,e,s1.newNoDocument(e,nq.min()))}else nh(1===r,20013,{expectedCount:r});else{let n=this._t(t);if(n!==r){let r=this.ut(e),i=r?this.ct(r,e,n):1;0!==i&&(this.it(t),this.Ye=this.Ye.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,r,n=e.Ce.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=sv(i).toUint8Array()}catch(e){if(e instanceof sf)return na("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new of(t,s,a)}catch(e){return na(e instanceof op?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===r.ge?null:r}ct(e,t,r){return 2*(t.Ce.count!==r-this.Pt(e,t.targetId))}Pt(e,t){let r=this.Ge.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){let t=new Map;this.ze.forEach((r,n)=>{let i=this.ot(n);if(i){if(r.current&&ag(i.target)){let t=new nD(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,s1.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.qe())}});let r=aB();this.He.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));let n=new om(e,t,this.Ye,this.je,r);return this.je=aL,this.Je=oI(),this.He=oI(),this.Ye=new sa(n_),n}Xe(e,t){if(!this.rt(e))return;let r=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;let n=this.nt(e);this.Et(e,t)?n.Qe(t,1):n.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new ow,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new su(n_),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new su(n_),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||ni("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new ow),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function oI(){return new sa(nD.comparator)}function o_(){return new sa(nD.comparator)}const oT={asc:"ASCENDING",desc:"DESCENDING"},oS={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oA={and:"AND",or:"OR"};class oC{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ox(e,t){return e.useProto3Json||null==t?t:{value:t}}function ok(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function oN(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function oR(e){return nh(!!e,49232),nq.fromTimestamp(function(e){let t=sg(e);return new nz(t.seconds,t.nanos)}(e))}function oD(e,t){return oL(e,t).canonicalString()}function oL(e,t){let r=new nk(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?r:r.child(t)}function oP(e){let t=nk.fromString(e);return nh(oQ(t),10190,{key:t.toString()}),t}function oO(e,t){return oD(e.databaseId,t.path)}function oM(e,t){let r=oP(t);if(r.get(1)!==e.databaseId.projectId)throw new nd(nc.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new nd(nc.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new nD(oB(r))}function oF(e,t){return oD(e.databaseId,t)}function oV(e){let t=oP(e);return 4===t.length?nk.emptyPath():oB(t)}function oU(e){return new nk(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function oB(e){return nh(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function oz(e,t,r){return{name:oO(e,t),fields:r.value.mapValue.fields}}function oq(e,t){var r;let n;if(t instanceof a7)n={update:oz(e,t.key,t.value)};else if(t instanceof on)n={delete:oO(e,t.key)};else if(t instanceof a9)n={update:oz(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof oi))return nl(16599,{Vt:t.type});n={verify:oO(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let r=t.transform;if(r instanceof aK)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof aG)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof aQ)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof aJ)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw nl(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:ok(e,r.updateTime.toTimestamp())}:void 0!==r.exists?{exists:r.exists}:nl(27497)),n}function oj(e,t){var r;let n=t.currentDocument?void 0!==(r=t.currentDocument).updateTime?a2.updateTime(oR(r.updateTime)):void 0!==r.exists?a2.exists(r.exists):a2.none():a2.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let r;return r=null,"setToServerValue"in t?(nh("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new aK):"appendMissingElements"in t?r=new aG(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new aQ(t.removeAllFromArray.values||[]):"increment"in t?r=new aJ(e,t.increment):nl(16584,{proto:t}),new a0(nR.fromServerFormat(t.fieldPath),r)}):[];if(t.update){t.update.name;let r=oM(e,t.update.name),s=new s0({mapValue:{fields:t.update.fields}});return t.updateMask?new a9(r,s,new sd((t.updateMask.fieldPaths||[]).map(e=>nR.fromServerFormat(e))),n,i):new a7(r,s,n,i)}return t.delete?new on(oM(e,t.delete),n):t.verify?new oi(oM(e,t.verify),n):nl(1463,{proto:t})}function o$(e,t){return{documents:[oF(e,t.path)]}}function oH(e,t){var r,n;let i,s={structuredQuery:{}},a=t.path;null!==t.collectionGroup?(i=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=oF(e,i);let o=function(e){if(0!==e.length)return function e(t){return t instanceof s8?function(e){if("=="===e.op){if(sK(e.value))return{unaryFilter:{field:oG(e.field),op:"IS_NAN"}};if(sH(e.value))return{unaryFilter:{field:oG(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(sK(e.value))return{unaryFilter:{field:oG(e.field),op:"IS_NOT_NAN"}};if(sH(e.value))return{unaryFilter:{field:oG(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oG(e.field),op:oS[e.op],value:e.value}}}(t):t instanceof s7?function(t){let r=t.getFilters().map(t=>e(t));return 1===r.length?r[0]:{compositeFilter:{op:oA[t.op],filters:r}}}(t):nl(54877,{filter:t})}(s7.create(e,"and"))}(t.filters);o&&(s.structuredQuery.where=o);let l=function(e){if(0!==e.length)return e.map(e=>({field:oG(e.field),direction:oT[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let u=ox(e,t.limit);return null!==u&&(s.structuredQuery.limit=u),t.startAt&&(s.structuredQuery.startAt={before:(r=t.startAt).inclusive,values:r.position}),t.endAt&&(s.structuredQuery.endAt={before:!(n=t.endAt).inclusive,values:n.position}),{ft:s,parent:i}}function oK(e){var t;let r,n=oV(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){nh(1===s,65062);let e=i.from[0];e.allDescendants?a=e.collectionId:n=n.child(e.collectionId)}let o=[];i.where&&(o=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=oW(e.unaryFilter.field);return s8.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=oW(e.unaryFilter.field);return s8.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=oW(e.unaryFilter.field);return s8.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=oW(e.unaryFilter.field);return s8.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return nl(61313);default:return nl(60726)}}(t):void 0!==t.fieldFilter?s8.create(oW(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return nl(58110);default:return nl(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?s7.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return nl(1026)}}(t.compositeFilter.op)):nl(30097,{filter:t})}(e);return t instanceof s7&&at(t)?t.getFilters():[t]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new s3(oW(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=null==(r="object"==typeof(t=i.limit)?t.value:t)?null:r);let h=null;i.startAt&&(h=function(e){let t=!!e.before;return new s2(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new s2(e.values||[],t)}(i.endAt)),new aw(n,a,l,o,u,"F",h,c)}function oG(e){return{fieldPath:e.canonicalString()}}function oW(e){return nR.fromServerFormat(e.fieldPath)}function oQ(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class oY{constructor(e,t,r,n,i=nq.min(),s=nq.min(),a=sp.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new oY(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new oY(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new oY(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new oY(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class oJ{constructor(e){this.yt=e}}function oX(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:oZ(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;n.document={name:oO(i=e.yt,t.key),fields:t.data.value.mapValue.fields,updateTime:ok(i,t.version.toTimestamp()),createTime:ok(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:o0(t.version)};else{if(!t.isUnknownDocument())return nl(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:o0(t.version)}}return n}function oZ(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function o0(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function o1(e){let t=new nz(e.seconds,e.nanoseconds);return nq.fromTimestamp(t)}function o2(e,t){let r=(t.baseMutations||[]).map(t=>oj(e.yt,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>oj(e.yt,t)),i=nz.fromMillis(t.localWriteTimeMs);return new os(t.batchId,i,r,n)}function o5(e){let t=o1(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?o1(e.lastLimboFreeSnapshotVersion):nq.min();return new oY(void 0!==e.query.documents?function(e){let t=e.documents.length;return nh(1===t,1966,{count:t}),aT(new aw(oV(e.documents[0])))}(e.query):aT(oK(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,r,sp.fromBase64String(e.resumeToken))}function o6(e,t){let r,n=o0(t.snapshotVersion),i=o0(t.lastLimboFreeSnapshotVersion);r=ag(t.target)?o$(e.yt,t.target):oH(e.yt,t.target).ft;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:ap(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function o3(e){let t=oK({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?aA(t,t.limit,"L"):t}function o4(e,t){return new oo(t.largestBatchId,oj(e.yt,t.overlayMutation))}function o8(e,t){let r=t.path.lastSegment();return[e,il(t.path.popLast()),r]}function o7(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:o0(n.readTime),documentKey:il(n.documentKey.path),largestBatchId:n.largestBatchId}}class o9{getBundleMetadata(e,t){return sr(e,iz).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:o1(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return sr(e,iz).put({bundleId:t.id,createTime:o0(oR(t.createTime)),version:t.version})}getNamedQuery(e,t){return sr(e,iq).get(t).next(e=>{if(e)return{name:e.name,query:o3(e.bundledQuery),readTime:o1(e.readTime)}})}saveNamedQuery(e,t){return sr(e,iq).put({name:t.name,readTime:o0(oR(t.readTime)),bundledQuery:t.bundledQuery})}}class le{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){return new le(e,t.uid||"")}getOverlay(e,t){return sr(e,iZ).get(o8(this.userId,t)).next(e=>e?o4(this.serializer,e):null)}getOverlays(e,t){let r=aF();return n0.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new oo(t,i);n.push(this.St(e,s))}),n0.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(il(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(sr(e,iZ).Z(i1,n))}),n0.waitFor(i)}getOverlaysForCollection(e,t,r){let n=aF(),i=il(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return sr(e,iZ).J(i1,s).next(e=>{for(let t of e){let e=o4(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=aF(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return sr(e,iZ).ee({index:i5,range:a},(e,t,r)=>{let a=o4(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}St(e,t){return sr(e,iZ).put(function(e,t,r){let[n,i,s]=o8(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:oq(e.yt,r.mutation)}}(this.serializer,this.userId,t))}}class lt{bt(e){return sr(e,i3)}getSessionToken(e){return this.bt(e).get("sessionToken").next(e=>{let t=e?.value;return t?sp.fromUint8Array(t):sp.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class lr{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(sy(e.integerValue));else if("doubleValue"in e){let r=sy(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),io(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=sg(r)),t.xt(`${r.seconds||""}`),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(sv(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?sY(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):sW(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):nl(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let r=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(r)))this.Ot(e,t),this.Ct(r[e],t)}kt(e,t){let r=e.fields||{};this.Ft(t,53);let n=r[sL].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(sy(n)),this.Ot(sL,t),this.Ct(r[sL],t)}Qt(e,t){let r=e.values||[];for(let e of(this.Ft(t,50),r))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),nD.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}function ln(e){return Math.ceil((64-function(e){let t=0;for(let r=0;r<8;++r){let n=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e))/8)}lr.Kt=new lr;class li{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Gt(r.value),r=t.next();this.zt()}jt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Jt(r.value),r=t.next();this.Ht()}Yt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{let e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{let e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Ht()}Xt(e){let t=this.en(e),r=ln(t);this.tn(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}nn(e){let t=this.en(e),r=ln(t);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}rn(){this.sn(255),this.sn(255)}_n(){this.an(255),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!r;return t}Gt(e){let t=255&e;0===t?(this.sn(0),this.sn(255)):255===t?(this.sn(255),this.sn(0)):this.sn(t)}Jt(e){let t=255&e;0===t?(this.an(0),this.an(255)):255===t?(this.an(255),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class ls{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class la{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class lo{constructor(){this.cn=new li,this.ln=new ls(this.cn),this.hn=new la(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return 0===e?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}class ll{constructor(e,t,r,n){this.Tn=e,this.In=t,this.En=r,this.dn=n}An(){let e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new ll(this.Tn,this.In,this.En,r)}Rn(e,t,r){return{indexId:this.Tn,uid:e,arrayValue:lc(this.En),directionalValue:lc(this.dn),orderedDocumentKey:lc(t),documentKey:r.path.toArray()}}Vn(e,t,r){let n=this.Rn(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function lu(e,t){let r=e.Tn-t.Tn;return 0!==r||0!==(r=lh(e.En,t.En))||0!==(r=lh(e.dn,t.dn))?r:nD.comparator(e.In,t.In)}function lh(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function lc(e){return tS()?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):e}function ld(e){return"string"!=typeof e?e:function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e)}class lf{constructor(e){for(let t of(this.mn=new su((e,t)=>nR.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[],e.filters))t.isInequality()?this.mn=this.mn.add(t):this.gn.push(t)}get pn(){return this.mn.size>1}yn(e){if(nh(e.collectionGroup===this.collectionId,49279),this.pn)return!1;let t=n$(e);if(void 0!==t&&!this.wn(t))return!1;let r=nH(e),n=new Set,i=0,s=0;for(;i<r.length&&this.wn(r[i]);++i)n=n.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){let e=this.mn.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.Sn(e,t)||!this.bn(this.fn[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.fn.length||!this.bn(this.fn[s++],e))return!1}return!0}Dn(){if(this.pn)return null;let e=new su(nR.comparator),t=[];for(let r of this.gn)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new nK(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new nK(r.field,0))}for(let r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new nK(r.field,+("asc"!==r.dir))));return new nj(nj.UNKNOWN_ID,this.collectionId,t,nG.empty())}wn(e){for(let t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function lp(e){return e instanceof s8}function lm(e){return e instanceof s7&&at(e)}function lg(e){return lp(e)||lm(e)||function(e){if(e instanceof s7&&ae(e)){for(let t of e.getFilters())if(!lp(t)&&!lm(t))return!1;return!0}return!1}(e)}function ly(e,t){return nh(e instanceof s8||e instanceof s7,38388),nh(t instanceof s8||t instanceof s7,25473),lb(e instanceof s8?t instanceof s8?s7.create([e,t],"and"):lv(e,t):t instanceof s8?lv(t,e):function(e,t){if(nh(e.filters.length>0&&t.filters.length>0,48005),s9(e)&&s9(t))return an(e,t.getFilters());let r=ae(e)?e:t,n=ae(e)?t:e,i=r.filters.map(e=>ly(e,n));return s7.create(i,"or")}(e,t))}function lv(e,t){if(s9(t))return an(t,e.getFilters());{let r=t.filters.map(t=>ly(e,t));return s7.create(r,"or")}}function lb(e){if(nh(e instanceof s8||e instanceof s7,11850),e instanceof s8)return e;let t=e.getFilters();if(1===t.length)return lb(t[0]);if(ar(e))return e;let r=t.map(e=>lb(e)),n=[];return r.forEach(t=>{t instanceof s8?n.push(t):t instanceof s7&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length?n[0]:s7.create(n,e.op)}class lw{constructor(){this.Cn=new lE}addToCollectionParentIndex(e,t){return this.Cn.add(t),n0.resolve()}getCollectionParents(e,t){return n0.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return n0.resolve()}deleteFieldIndex(e,t){return n0.resolve()}deleteAllFieldIndexes(e){return n0.resolve()}createTargetIndexes(e,t){return n0.resolve()}getDocumentsMatchingTarget(e,t){return n0.resolve(null)}getIndexType(e,t){return n0.resolve(0)}getFieldIndexes(e,t){return n0.resolve([])}getNextCollectionGroupToUpdate(e){return n0.resolve(null)}getMinOffset(e,t){return n0.resolve(nQ.min())}getMinOffsetFromCollectionGroup(e,t){return n0.resolve(nQ.min())}updateCollectionGroup(e,t,r){return n0.resolve()}updateIndexEntries(e,t){return n0.resolve()}}class lE{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new su(nk.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new su(nk.comparator)).toArray()}}const lI="IndexedDbIndexManager",l_=new Uint8Array(0);class lT{constructor(e,t){this.databaseId=t,this.vn=new lE,this.Fn=new aD(e=>ap(e),(e,t)=>am(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let i={collectionId:r,parent:il(n)};return sr(e,iV).put(i)}return n0.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return sr(e,iV).J(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(iu(n.parent))}return r})}addFieldIndex(e,t){let r=sr(e,ij),n={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete n.indexId;let i=r.add(n);if(t.indexState){let r=sr(e,iH);return i.next(e=>{r.put(o7(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let r=sr(e,ij),n=sr(e,iH),i=sr(e,iQ);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=sr(e,ij),r=sr(e,iQ),n=sr(e,iH);return t.Z().next(()=>r.Z()).next(()=>n.Z())}createTargetIndexes(e,t){return n0.forEach(this.Mn(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new lf(t).Dn();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=sr(e,iQ),n=!0,i=new Map;return n0.forEach(this.Mn(t),t=>this.xn(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(n){let e=aB(),n=[];return n0.forEach(i,(i,s)=>{ni(lI,`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${ap(t)}`);let a=function(e,t){let r=n$(t);if(void 0===r)return null;for(let t of ay(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let r=new Map;for(let n of nH(t))for(let t of ay(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}(s,i),l=function(e,t){let r=[],n=!0;for(let i of nH(t)){let t=0===i.kind?av(e,i.fieldPath,e.startAt):ab(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new s2(r,n)}(s,i),u=function(e,t){let r=[],n=!0;for(let i of nH(t)){let t=0===i.kind?ab(e,i.fieldPath,e.endAt):av(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new s2(r,n)}(s,i),h=this.On(i,s,l),c=this.On(i,s,u),d=this.Nn(i,s,o),f=this.Bn(i.indexId,a,h,l.inclusive,c,u.inclusive,d);return n0.forEach(f,i=>r.Y(i,t.limit).next(t=>{t.forEach(t=>{let r=nD.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}return n0.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(nh(t instanceof s8||t instanceof s7,34018),t instanceof s8)return t;if(1===t.filters.length)return e(t.filters[0]);let r=t.filters.map(t=>e(t)),n=s7.create(r,t.op);return lg(n=lb(n))?n:(nh(n instanceof s7,64498),nh(s9(n),40251),nh(n.filters.length>1,57927),n.filters.reduce((e,t)=>ly(e,t)))}(function e(t){if(nh(t instanceof s8||t instanceof s7,20012),t instanceof s8){if(t instanceof au){let e=t.value.arrayValue?.values?.map(e=>s8.create(t.field,"==",e))||[];return s7.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return s7.create(r,t.op)}(e));return nh(lg(t),7391),lp(t)||lm(t)?[t]:t.getFilters()})(s7.create(e.filters,"and")).map(t=>af(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t)),t}Bn(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.Ln(t[h/l]):l_,c=this.kn(e,o,r[h%l],n),d=this.qn(e,o,i[h%l],s),f=a.map(t=>this.kn(e,o,t,!0));u.push(...this.createRange(c,d,f))}return u}kn(e,t,r,n){let i=new ll(e,nD.empty(),t,r);return n?i:i.An()}qn(e,t,r,n){let i=new ll(e,nD.empty(),t,r);return n?i.An():i}xn(e,t){let r=new lf(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.yn(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.Mn(t);return n0.forEach(n,t=>this.xn(e,t).next(e=>{e?0!==r&&e.fields.length<function(e){let t=new su(nR.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}(t)&&(r=1):r=0})).next(()=>null!==t.limit&&n.length>1&&2===r?1:r)}Qn(e,t){let r=new lo;for(let n of nH(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.Pn(n.kind);lr.Kt.Dt(e,i)}return r.un()}Ln(e){let t=new lo;return lr.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){let r=new lo;return lr.Kt.Dt(sq(this.databaseId,t),r.Pn(function(e){let t=nH(e);return 0===t.length?0:t[t.length-1].kind}(e))),r.un()}Nn(e,t,r){if(null===r)return[];let n=[];n.push(new lo);let i=0;for(let s of nH(e)){let e=r[i++];for(let r of n)if(this.Un(t,s.fieldPath)&&s$(e))n=this.Kn(n,s,e);else{let t=r.Pn(s.kind);lr.Kt.Dt(e,t)}}return this.Wn(n)}On(e,t,r){return this.Nn(e,t,r.position)}Wn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].un();return t}Kn(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new lo;n.seed(r.un()),lr.Kt.Dt(e,n.Pn(t.kind)),i.push(n)}return i}Un(e,t){return!!e.filters.find(e=>e instanceof s8&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=sr(e,ij),n=sr(e,iH);return(t?r.J(i$,IDBKeyRange.bound(t,t)):r.J()).next(e=>{let t=[];return n0.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(function(e,t){let r=t?new nG(t.sequenceNumber,new nQ(o1(t.readTime),new nD(iu(t.documentKey)),t.largestBatchId)):nG.empty(),n=e.fields.map(([e,t])=>new nK(nR.fromServerFormat(e),t));return new nj(e.indexId,e.collectionGroup,n,r)}(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:n_(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=sr(e,ij),i=sr(e,iH);return this.Gn(e).next(e=>n.J(i$,IDBKeyRange.bound(t,t)).next(t=>n0.forEach(t,t=>i.put(o7(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return n0.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?n0.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),n0.forEach(i,r=>this.zn(e,t,r).next(t=>{let i=this.jn(n,r);return t.isEqual(i)?n0.resolve():this.Jn(e,n,r,t,i)}))))})}Hn(e,t,r,n){return sr(e,iQ).put(n.Rn(this.uid,this.$n(r,t.key),t.key))}Yn(e,t,r,n){return sr(e,iQ).delete(n.Vn(this.uid,this.$n(r,t.key),t.key))}zn(e,t,r){let n=sr(e,iQ),i=new su(lu);return n.ee({index:iJ,range:IDBKeyRange.only([r.indexId,this.uid,lc(this.$n(r,t))])},(e,n)=>{i=i.add(new ll(r.indexId,t,ld(n.arrayValue),ld(n.directionalValue)))}).next(()=>i)}jn(e,t){let r=new su(lu),n=this.Qn(t,e);if(null==n)return r;let i=n$(t);if(null!=i){let s=e.data.field(i.fieldPath);if(s$(s))for(let i of s.arrayValue.values||[])r=r.add(new ll(t.indexId,e.key,this.Ln(i),n))}else r=r.add(new ll(t.indexId,e.key,l_,n));return r}Jn(e,t,r,n,i){ni(lI,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=sc(s),l=sc(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=sc(a)):t?(i(o),o=sc(s)):(o=sc(s),l=sc(a))}}(n,i,lu,n=>{s.push(this.Hn(e,t,r,n))},n=>{s.push(this.Yn(e,t,r,n))}),n0.waitFor(s)}Gn(e){let t=1;return sr(e,iH).ee({index:iG,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>lu(e,t)).filter((e,t,r)=>!t||0!==lu(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=lu(i,e),s=lu(i,t);if(0===r)n[0]=e.An();else if(r>0&&s<0)n.push(i),n.push(i.An());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.Zn(n[e],n[e+1]))return[];let t=n[e].Vn(this.uid,l_,nD.empty()),r=n[e+1].Vn(this.uid,l_,nD.empty());i.push(IDBKeyRange.bound(t,r))}return i}Zn(e,t){return lu(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(lS)}getMinOffset(e,t){return n0.mapArray(this.Mn(t),t=>this.xn(e,t).next(e=>e||nl(44426))).next(lS)}}function lS(e){nh(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>nY(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new nQ(t.readTime,t.documentKey,r)}const lA={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class lC{static withCacheSize(e){return new lC(e,lC.DEFAULT_COLLECTION_PERCENTILE,lC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}function lx(e,t,r){let n=e.store(im),i=e.store(iw),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.ee({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{nh(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){var h,c;let n=(h=e.key.path,c=r.batchId,[t,il(h),c]);s.push(i.delete(n)),u.push(e.key)}return n0.waitFor(s).next(()=>u)}function lk(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw nl(14731);t=e.noDocument}return JSON.stringify(t).length}lC.DEFAULT_COLLECTION_PERCENTILE=10,lC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lC.DEFAULT=new lC(0x2800000,lC.DEFAULT_COLLECTION_PERCENTILE,lC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lC.DISABLED=new lC(-1,0,0);class lN{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.Xn={}}static wt(e,t,r,n){return nh(""!==e.uid,64387),new lN(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return lD(e).ee({index:iy,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=sr(e,iw),s=lD(e);return s.add({}).next(a=>{nh("number"==typeof a,49019);let o=new os(a,t,r,n),l=function(e,t,r){let n=r.baseMutations.map(t=>oq(e.yt,t)),i=r.mutations.map(t=>oq(e.yt,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}(this.serializer,this.userId,o),u=[],h=new su((e,t)=>n_(e.canonicalString(),t.canonicalString()));for(let e of n){var c,d;let t=(c=this.userId,d=e.key.path,[c,il(d),a]);h=h.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,ib))}return h.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Xn[a]=o.keys()}),n0.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return lD(e).get(t).next(e=>e?(nh(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),o2(this.serializer,e)):null)}er(e,t){return this.Xn[t]?n0.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let r=e.keys();return this.Xn[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return lD(e).ee({index:iy,range:n},(e,t,n)=>{t.userId===this.userId&&(nh(t.batchId>=r,47524,{tr:r}),i=o2(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return lD(e).ee({index:iy,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return lD(e).J(iy,t).next(e=>e.map(e=>o2(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=[this.userId,il(t.path)],n=IDBKeyRange.lowerBound(r),i=[];return sr(e,iw).ee({range:n},(r,n,s)=>{let[a,o,l]=r,u=iu(o);if(a===this.userId&&t.path.isEqual(u))return lD(e).get(l).next(e=>{if(!e)throw nl(61480,{nr:r,batchId:l});nh(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(o2(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new su(n_),n=[];return t.forEach(t=>{let i=[this.userId,il(t.path)],s=IDBKeyRange.lowerBound(i),a=sr(e,iw).ee({range:s},(e,n,i)=>{let[s,a,o]=e,l=iu(a);s===this.userId&&t.path.isEqual(l)?r=r.add(o):i.done()});n.push(a)}),n0.waitFor(n).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=[this.userId,il(r)],s=IDBKeyRange.lowerBound(i),a=new su(n_);return sr(e,iw).ee({range:s},(e,t,i)=>{let[s,o,l]=e,u=iu(o);s===this.userId&&r.isPrefixOf(u)?u.length===n&&(a=a.add(l)):i.done()}).next(()=>this.rr(e,a))}rr(e,t){let r=[],n=[];return t.forEach(t=>{n.push(lD(e).get(t).next(e=>{if(null===e)throw nl(35274,{batchId:t});nh(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(o2(this.serializer,e))}))}),n0.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return lx(e.le,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),n0.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return n0.resolve();let r=IDBKeyRange.lowerBound([this.userId]),n=[];return sr(e,iw).ee({range:r},(e,t,r)=>{if(e[0]===this.userId){let t=iu(e[1]);n.push(t)}else r.done()}).next(()=>{nh(0===n.length,56720,{sr:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return lR(e,this.userId,t)}_r(e){return sr(e,ip).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function lR(e,t,r){let n=[t,il(r.path)],i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return sr(e,iw).ee({range:s,X:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function lD(e){return sr(e,im)}class lL{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new lL(0)}static cr(){return new lL(-1)}}class lP{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{let r=new lL(t.highestTargetId);return t.highestTargetId=r.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(e=>nq.fromTimestamp(new nz(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.lr(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.hr(e,n)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(t,r),this.hr(e,r))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>sr(e,ik).delete(t.targetId)).next(()=>this.lr(e)).next(t=>(nh(t.targetCount>0,8065),t.targetCount-=1,this.hr(e,t)))}removeTargets(e,t,r){let n=0,i=[];return sr(e,ik).ee((s,a)=>{let o=o5(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>n0.waitFor(i)).next(()=>n)}forEachTarget(e,t){return sr(e,ik).ee((e,r)=>{t(o5(r))})}lr(e){return sr(e,iF).get(iM).next(e=>(nh(null!==e,2888),e))}hr(e,t){return sr(e,iF).put(iM,t)}Pr(e,t){return sr(e,ik).put(o6(this.serializer,t))}Tr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(e=>e.targetCount)}getTargetData(e,t){let r=ap(t),n=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),i=null;return sr(e,ik).ee({range:n,index:iN},(e,r,n)=>{let s=o5(r);am(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=lO(e);return t.forEach(t=>{let s=il(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),n0.waitFor(n)}removeMatchingKeys(e,t,r){let n=lO(e);return n0.forEach(t,t=>{let i=il(t.path);return n0.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=lO(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=lO(e),i=aB();return n.ee({range:r,X:!0},(e,t,r)=>{let n=new nD(iu(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=il(t.path),n=IDBKeyRange.bound([r],[r+"\0"],!1,!0),i=0;return lO(e).ee({index:iP,X:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}At(e,t){return sr(e,ik).get(t).next(e=>e?o5(e):null)}}function lO(e){return sr(e,iD)}const lM="LruGarbageCollector";function lF([e,t],[r,n]){let i=n_(e,r);return 0===i?n_(t,n):i}class lV{constructor(e){this.Ir=e,this.buffer=new su(lF),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>lF(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class lU{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){ni(lM,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){n8(e)?ni(lM,"Ignoring IndexedDB error during garbage collection: ",e):await nZ(e)}await this.Vr(3e5)})}}class lB{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return n0.resolve(ia.ce);let r=new lV(t);return this.mr.forEachTarget(e,e=>r.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>r.Ar(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(ni("LruGarbageCollector","Garbage collection skipped; disabled"),n0.resolve(lA)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ni("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),lA):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,n,i,s,a,o,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ni("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),nn()<=u.DEBUG&&ni("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${n} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-h}ms`),n0.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}class lz{constructor(e,t){this.db=e,this.garbageCollector=new lB(this,t)}gr(e){let t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(e,r)=>t(r))}addReference(e,t,r){return lq(e,r)}removeReference(e,t,r){return lq(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return lq(e,t)}br(e,t){let r;return r=!1,sr(e,ip).te(n=>lR(e,n,t).next(e=>(e&&(r=!0),n0.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.Sr(e,(s,a)=>{if(a<=t){let t=this.br(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,nq.min()),lO(e).delete([0,il(s.path)])))});n.push(t)}}).next(()=>n0.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return lq(e,t)}Sr(e,t){let r=lO(e),n,i=ia.ce;return r.ee({index:iP},([e,r],{path:s,sequenceNumber:a})=>{0===e?(i!==ia.ce&&t(new nD(iu(n)),i),i=a,n=s):i=ia.ce}).next(()=>{i!==ia.ce&&t(new nD(iu(n)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function lq(e,t){var r;return lO(e).put((r=e.currentSequenceNumber,{targetId:0,path:il(t.path),sequenceNumber:r}))}class lj{constructor(){this.changes=new aD(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,s1.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?n0.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class l${constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return sr(e,iE).put(r)}removeEntry(e,t,r){return sr(e,iE).delete(function(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],oZ(t),r[r.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Dr(e,r)))}getEntry(e,t){let r=s1.newInvalidDocument(t);return sr(e,iE).ee({index:i_,range:IDBKeyRange.only(lK(t))},(e,n)=>{r=this.Cr(t,n)}).next(()=>r)}vr(e,t){let r={size:0,document:s1.newInvalidDocument(t)};return sr(e,iE).ee({index:i_,range:IDBKeyRange.only(lK(t))},(e,n)=>{r={document:this.Cr(t,n),size:lk(n)}}).next(()=>r)}getEntries(e,t){let r=aL;return this.Fr(e,t,(e,t)=>{let n=this.Cr(e,t);r=r.insert(e,n)}).next(()=>r)}Mr(e,t){let r=aL,n=new sa(nD.comparator);return this.Fr(e,t,(e,t)=>{let i=this.Cr(e,t);r=r.insert(e,i),n=n.insert(e,lk(t))}).next(()=>({documents:r,Or:n}))}Fr(e,t,r){if(t.isEmpty())return n0.resolve();let n=new su(lW);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(lK(n.first()),lK(n.last())),s=n.getIterator(),a=s.getNext();return sr(e,iE).ee({index:i_,range:i},(e,t,n)=>{let i=nD.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>lW(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.j(lK(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),oZ(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return sr(e,iE).J(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=aL;for(let i of e){let e=this.Cr(nD.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(aN(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=aL,s=lG(t,r),a=lG(t,nQ.max());return sr(e,iE).ee({index:iS,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.Cr(nD.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new lH(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return sr(e,iC).get(ix).next(e=>(nh(!!e,20021),e))}Dr(e,t){return sr(e,iC).put(ix,t)}Cr(e,t){if(t){let e=function(e,t){let r;if(t.document)r=function(e,t,r){let n=oM(e,t.name),i=oR(t.updateTime),s=t.createTime?oR(t.createTime):nq.min(),a=new s0({mapValue:{fields:t.fields}}),o=s1.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=nD.fromSegments(t.noDocument.path),n=o1(t.noDocument.readTime);r=s1.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return nl(56709);{let e=nD.fromSegments(t.unknownDocument.path),n=o1(t.unknownDocument.version);r=s1.newUnknownDocument(e,n)}}return t.readTime&&r.setReadTime(function(e){let t=new nz(e[0],e[1]);return nq.fromTimestamp(t)}(t.readTime)),r}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(nq.min())))return e}return s1.newInvalidDocument(e)}}class lH extends lj{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new aD(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new su((e,t)=>n_(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.Br.get(i);if(t.push(this.Nr.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=oX(this.Nr.serializer,s);n=n.add(i.path.popLast());let l=lk(o);r+=l-a.size,t.push(this.Nr.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=oX(this.Nr.serializer,s.convertToNoDocument(nq.min()));t.push(this.Nr.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Nr.updateMetadata(e,r)),n0.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(e=>(this.Br.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:e,Or:t})=>(t.forEach((t,r)=>{this.Br.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function lK(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function lG(e,t){let r=t.documentKey.path.toArray();return[e,oZ(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function lW(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=n_(r[e],n[e]))return i;return(i=n_(r.length,n.length))||(i=n_(r[r.length-2],n[n.length-2]))||n_(r[r.length-1],n[n.length-1])}class lQ{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class lY{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&a4(r.mutation,e,sd.empty(),nz.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,aB()).next(()=>t))}getLocalViewOfDocuments(e,t,r=aB()){let n=aF();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=aO();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=aF();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,aB()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=aL,s=aF(),a=aF();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof a9)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),a4(a.mutation,t,a.mutation.getFieldMask(),nz.now())):s.set(t.key,sd.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new lQ(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=aF(),n=new sa((e,t)=>e-t),i=aB();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||sd.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||aB()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=aF();l.forEach(e=>{if(!i.has(e)){let n=a3(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return n0.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return nD.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):aI(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):n0.resolve(aF()),a=-1,o=i;return s.next(t=>n0.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t)?n0.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,aB())).next(e=>({batchId:a,changes:aM(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new nD(t)).next(e=>{let t=aO();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=aO();return this.indexManager.getCollectionParents(e,i).next(a=>n0.forEach(a,a=>{let o=new aw(a.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,s1.newInvalidDocument(n)))});let r=aO();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&a4(s.mutation,n,sd.empty(),nz.now()),aN(t,n)&&(r=r.insert(e,n))}),r})}}class lJ{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return n0.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:oR(t.createTime)}),n0.resolve()}getNamedQuery(e,t){return n0.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:t.name,query:o3(t.bundledQuery),readTime:oR(t.readTime)}),n0.resolve()}}class lX{constructor(){this.overlays=new sa(nD.comparator),this.qr=new Map}getOverlay(e,t){return n0.resolve(this.overlays.get(t))}getOverlays(e,t){let r=aF();return n0.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.St(e,t,n)}),n0.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.qr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(r)),n0.resolve()}getOverlaysForCollection(e,t,r){let n=aF(),i=t.length+1,s=new nD(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return n0.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new sa((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=aF(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=aF(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return n0.resolve(a)}St(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.qr.get(n.largestBatchId).delete(r.key);this.qr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new oo(t,r));let i=this.qr.get(t);void 0===i&&(i=aB(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class lZ{constructor(){this.sessionToken=sp.EMPTY_BYTE_STRING}getSessionToken(e){return n0.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,n0.resolve()}}class l0{constructor(){this.Qr=new su(l1.$r),this.Ur=new su(l1.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let r=new l1(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new l1(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new nD(new nk([])),r=new l1(t,e),n=new l1(t,e+1),i=[];return this.Ur.forEachInRange([r,n],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new nD(new nk([])),r=new l1(t,e),n=new l1(t,e+1),i=aB();return this.Ur.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new l1(e,0),r=this.Qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class l1{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return nD.comparator(e.key,t.key)||n_(e.Yr,t.Yr)}static Kr(e,t){return n_(e.Yr,t.Yr)||nD.comparator(e.key,t.key)}}class l2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new su(l1.$r)}checkEmpty(e){return n0.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new os(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.Zr=this.Zr.add(new l1(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return n0.resolve(s)}lookupMutationBatch(e,t){return n0.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let r=this.ei(t+1),n=r<0?0:r;return n0.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return n0.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return n0.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new l1(t,0),n=new l1(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,n],e=>{let t=this.Xr(e.Yr);i.push(t)}),n0.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new su(n_);return t.forEach(e=>{let t=new l1(e,0),n=new l1(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,n],e=>{r=r.add(e.Yr)})}),n0.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;nD.isDocumentKey(i)||(i=i.child(""));let s=new l1(new nD(i),0),a=new su(n_);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Yr)),!0)},s),n0.resolve(this.ti(a))}ti(e){let t=[];return e.forEach(e=>{let r=this.Xr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){nh(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Zr;return n0.forEach(t.mutations,n=>{let i=new l1(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){let r=new l1(t,0),n=this.Zr.firstAfterOrEqual(r);return n0.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,n0.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class l5{constructor(e){this.ri=e,this.docs=new sa(nD.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return n0.resolve(r?r.document.mutableCopy():s1.newInvalidDocument(t))}getEntries(e,t){let r=aL;return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():s1.newInvalidDocument(e))}),n0.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=aL,s=t.path,a=new nD(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=nY(nW(a),r)||(n.has(a.key)||aN(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return n0.resolve(i)}getAllFromCollectionGroup(e,t,r,n){nl(9500)}ii(e,t){return n0.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new l6(this)}getSize(e){return n0.resolve(this.size)}}class l6 extends lj{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Nr.addEntry(e,n)):this.Nr.removeEntry(r)}),n0.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class l3{constructor(e){this.persistence=e,this.si=new aD(e=>ap(e),am),this.lastRemoteSnapshotVersion=nq.min(),this.highestTargetId=0,this.oi=0,this._i=new l0,this.targetCount=0,this.ai=lL.ur()}forEachTarget(e,t){return this.si.forEach((e,r)=>t(r)),n0.resolve()}getLastRemoteSnapshotVersion(e){return n0.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return n0.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),n0.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),n0.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new lL(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,n0.resolve()}updateTargetData(e,t){return this.Pr(t),n0.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,n0.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.si.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),n0.waitFor(i).next(()=>n)}getTargetCount(e){return n0.resolve(this.targetCount)}getTargetData(e,t){let r=this.si.get(t)||null;return n0.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),n0.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),n0.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),n0.resolve()}getMatchingKeysForTargetId(e,t){let r=this._i.Hr(t);return n0.resolve(r)}containsKey(e,t){return n0.resolve(this._i.containsKey(t))}}class l4{constructor(e,t){this.ui={},this.overlays={},this.ci=new ia(0),this.li=!1,this.li=!0,this.hi=new lZ,this.referenceDelegate=e(this),this.Pi=new l3(this),this.indexManager=new lw,this.remoteDocumentCache=new l5(e=>this.referenceDelegate.Ti(e)),this.serializer=new oJ(t),this.Ii=new lJ(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new lX,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new l2(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){ni("MemoryPersistence","Starting transaction:",e);let n=new l8(this.ci.next());return this.referenceDelegate.Ei(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ai(e,t){return n0.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class l8 extends nX{constructor(e){super(),this.currentSequenceNumber=e}}class l7{constructor(e){this.persistence=e,this.Ri=new l0,this.Vi=null}static mi(e){return new l7(e)}get fi(){if(this.Vi)return this.Vi;throw nl(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),n0.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),n0.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),n0.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return n0.forEach(this.fi,r=>{let n=nD.fromPath(r);return this.gi(e,n).next(e=>{e||t.removeEntry(n,nq.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return n0.or([()=>n0.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class l9{constructor(e,t){this.persistence=e,this.pi=new aD(e=>il(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new lB(this,t)}static mi(e,t){return new l9(e,t)}Ei(){}di(e){return n0.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return n0.forEach(this.pi,(r,n)=>this.br(e,r,n).next(e=>e?n0.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ii(e,n=>this.br(e,n,t).next(e=>{e||(r++,i.removeEntry(n,nq.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),n0.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),n0.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),n0.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),n0.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(sO(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let r=sT(t);return r?16+e(r):16;case 5:return 2*t.stringValue.length;case 6:return sv(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,r)=>t+e(r),0);case 10:case 11:var n;let i;return n=t.mapValue,i=0,si(n.fields,(t,r)=>{i+=t.length+e(r)}),i;default:throw nl(13486,{value:t})}}(e.data.value)),t}br(e,t,r){return n0.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return n0.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ue{constructor(e){this.serializer=e}k(e,t,r,n){let i=new n2("createOrUpgrade",t);r<1&&n>=1&&(e.createObjectStore(ic),e.createObjectStore(ip,{keyPath:"userId"}),e.createObjectStore(im,{keyPath:ig,autoIncrement:!0}).createIndex(iy,iv,{unique:!0}),e.createObjectStore(iw),ut(e),e.createObjectStore(ih));let s=n0.resolve();return r<3&&n>=3&&(0!==r&&(e.deleteObjectStore(iD),e.deleteObjectStore(ik),e.deleteObjectStore(iF),ut(e)),s=s.next(()=>(function(e){let t=e.store(iF),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:nq.min().toTimestamp(),targetCount:0};return t.put(iM,r)})(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>i.store(im).J().next(t=>{e.deleteObjectStore(im),e.createObjectStore(im,{keyPath:ig,autoIncrement:!0}).createIndex(iy,iv,{unique:!0});let r=i.store(im),n=t.map(e=>r.put(e));return n0.waitFor(n)}))),s=s.next(()=>{e.createObjectStore(iB,{keyPath:"clientId"})})),r<5&&n>=5&&(s=s.next(()=>this.yi(i))),r<6&&n>=6&&(s=s.next(()=>(e.createObjectStore(iC),this.wi(i)))),r<7&&n>=7&&(s=s.next(()=>this.Si(i))),r<8&&n>=8&&(s=s.next(()=>this.bi(e,i))),r<9&&n>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),r<10&&n>=10&&(s=s.next(()=>this.Di(i))),r<11&&n>=11&&(s=s.next(()=>{e.createObjectStore(iz,{keyPath:"bundleId"}),e.createObjectStore(iq,{keyPath:"name"})})),r<12&&n>=12&&(s=s.next(()=>{let t=e.createObjectStore(iZ,{keyPath:i0});t.createIndex(i1,i2,{unique:!1}),t.createIndex(i5,i6,{unique:!1})})),r<13&&n>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore(iE,{keyPath:iI});t.createIndex(i_,iT),t.createIndex(iS,iA)})(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(ih))),r<14&&n>=14&&(s=s.next(()=>this.Fi(e,i))),r<15&&n>=15&&(s=s.next(()=>{e.createObjectStore(ij,{keyPath:"indexId",autoIncrement:!0}).createIndex(i$,"collectionGroup",{unique:!1}),e.createObjectStore(iH,{keyPath:iK}).createIndex(iG,iW,{unique:!1}),e.createObjectStore(iQ,{keyPath:iY}).createIndex(iJ,iX,{unique:!1})})),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(iH).clear()}).next(()=>{t.objectStore(iQ).clear()})),r<17&&n>=17&&(s=s.next(()=>{e.createObjectStore(i3,{keyPath:"name"})})),r<18&&n>=18&&tS()&&(s=s.next(()=>{t.objectStore(iH).clear()}).next(()=>{t.objectStore(iQ).clear()})),s}wi(e){let t=0;return e.store(ih).ee((e,r)=>{t+=lk(r)}).next(()=>{let r={byteSize:t};return e.store(iC).put(ix,r)})}yi(e){let t=e.store(ip),r=e.store(im);return t.J().next(t=>n0.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.J(iy,n).next(r=>n0.forEach(r,r=>{nh(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=o2(this.serializer,r);return lx(e,t.userId,n).next(()=>{})}))}))}Si(e){let t=e.store(iD),r=e.store(ih);return e.store(iF).get(iM).next(e=>{let n=[];return r.ee((r,i)=>{let s=new nk(r),a=[0,il(s)];n.push(t.get(a).next(r=>r?n0.resolve():t.put({targetId:0,path:il(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>n0.waitFor(n))})}bi(e,t){e.createObjectStore(iV,{keyPath:iU});let r=t.store(iV),n=new lE,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:il(n)})}};return t.store(ih).ee({X:!0},(e,t)=>i(new nk(e).popLast())).next(()=>t.store(iw).ee({X:!0},([e,t,r],n)=>i(iu(t).popLast())))}Di(e){let t=e.store(ik);return t.ee((e,r)=>{let n=o5(r),i=o6(this.serializer,n);return t.put(i)})}Ci(e,t){let r=t.store(ih),n=[];return r.ee((e,r)=>{let i=t.store(iE),s=(r.document?new nD(nk.fromString(r.document.name).popFirst(5)):r.noDocument?nD.fromSegments(r.noDocument.path):r.unknownDocument?nD.fromSegments(r.unknownDocument.path):nl(36783)).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>n0.waitFor(n))}Fi(e,t){let r=t.store(im),n=new l$(this.serializer),i=new l4(l7.mi,this.serializer.yt);return r.J().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??aB();o2(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),n0.forEach(r,(e,r)=>{let s=new ne(r),a=le.wt(this.serializer,s),o=i.getIndexManager(s);return new lY(n,lN.wt(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new st(t,ia.ce),e).next()})})}}function ut(e){e.createObjectStore(iD,{keyPath:iL}).createIndex(iP,iO,{unique:!0}),e.createObjectStore(ik,{keyPath:"targetId"}).createIndex(iN,iR,{unique:!0}),e.createObjectStore(iF)}const ur="IndexedDbPersistence",un="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ui{constructor(e,t,r,n,i,s,a,o,l,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Mi=i,this.window=s,this.document=a,this.xi=l,this.Oi=u,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=e=>Promise.resolve(),!ui.v())throw new nd(nc.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new lz(this,n),this.$i=t+"main",this.serializer=new oJ(o),this.Ui=new n5(this.$i,this.Ni,new ue(this.serializer)),this.hi=new lt,this.Pi=new lP(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new l$(this.serializer),this.Ii=new o9,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,!1===u&&ns(ur,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new nd(nc.FAILED_PRECONDITION,un);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new ia(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>sr(e,iB).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(n8(e))return ni(ur,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ni(ur,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return sr(e,ic).get(id).next(e=>n0.resolve(this.es(e)))}ts(e){return sr(e,iB).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,18e5)){this.qi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=sr(e,iB);return t.J().next(e=>{let r=this.ss(e,18e5),n=e.filter(e=>-1===r.indexOf(e));return n0.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ki)for(let t of e)this.Ki.removeItem(this._s(t.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?n0.resolve(!0):sr(e,ic).get(id).next(t=>{if(null!==t&&this.rs(t.leaseTimestampMs,5e3)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new nd(nc.FAILED_PRECONDITION,un);return!1}}return!(!this.networkEnabled||!this.inForeground)||sr(e,iB).J().next(e=>void 0===this.ss(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&ni(ur,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[ic,iB],e=>{let t=new st(e,ia.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()}ss(e,t){return e.filter(e=>this.rs(e.updateTimeMs,t)&&!this.us(e.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>sr(e,iB).J().next(e=>this.ss(e,18e5).map(e=>e.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return lN.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new lT(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return le.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,r){var n;let i;ni(ur,"Starting transaction:",e);let s=18===(n=this.Ni)||17===n?se:16===n||15===n?i9:14===n||13===n?i7:12===n?i8:11===n?i4:void nl(60245);return this.Ui.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,n=>(i=new st(n,this.ci?this.ci.next():ia.ce),"readwrite-primary"===t?this.Hi(i).next(e=>!!e||this.Yi(i)).next(t=>{if(!t)throw ns(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new nd(nc.FAILED_PRECONDITION,nJ);return r(i)}).next(e=>this.Xi(i).next(()=>e)):this.Is(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Is(e){return sr(e,ic).get(id).next(e=>{if(null!==e&&this.rs(e.leaseTimestampMs,5e3)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new nd(nc.FAILED_PRECONDITION,un)})}Xi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return sr(e,ic).put(id,t)}static v(){return n5.v()}Zi(e){let t=sr(e,ic);return t.get(id).next(e=>this.es(e)?(ni(ur,"Releasing primary lease."),t.delete(id)):n0.resolve())}rs(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(ns(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground="visible"===this.document.visibilityState)}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){"function"==typeof this.window?.addEventListener&&(this.Bi=()=>{this.cs();let e=/(?:Version|Mobile)\/1[456]/;tT()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){try{let t=null!==this.Ki?.getItem(this._s(e));return ni(ur,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return ns(ur,"Failed to get zombied client id.",e),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){ns("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch(e){}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}class us{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=n}static As(e,t){let r=aB(),n=aB();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new us(e,t.fromCache,r,n)}}class ua{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class uo{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=tT()?8:n6(tI())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new ua;return this.Ss(e,t,r).next(n=>{if(i.result=n,this.Vs)return this.bs(e,t,r,n.size)})}).next(()=>i.result)}bs(e,t,r,n){return r.documentReadCount<this.fs?(nn()<=u.DEBUG&&ni("QueryEngine","SDK will not create cache indexes for query:",ak(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),n0.resolve()):(nn()<=u.DEBUG&&ni("QueryEngine","Query:",ak(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.gs*n?(nn()<=u.DEBUG&&ni("QueryEngine","The SDK decides to create cache indexes for query:",ak(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,aT(t))):n0.resolve())}ys(e,t){if(aE(t))return n0.resolve(null);let r=aT(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=aT(t=aA(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=aB(...n);return this.ps.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.Ds(t,n);return this.Cs(t,s,i,r.readTime)?this.ys(e,aA(t,null,"F")):this.vs(e,s,t,r)}))})))}ws(e,t,r,n){return aE(t)||n.isEqual(nq.min())?n0.resolve(null):this.ps.getDocuments(e,r).next(i=>{let s=this.Ds(t,i);return this.Cs(t,s,r,n)?n0.resolve(null):(nn()<=u.DEBUG&&ni("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ak(t)),this.vs(e,s,t,function(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new nQ(nq.fromTimestamp(1e9===n?new nz(r+1,0):new nz(r,n)),nD.empty(),-1)}(n,0)).next(e=>e))})}Ds(e,t){let r=new su(aR(e));return t.forEach((t,n)=>{aN(e,n)&&(r=r.add(n))}),r}Cs(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}Ss(e,t,r){return nn()<=u.DEBUG&&ni("QueryEngine","Using full collection scan to execute query:",ak(t)),this.ps.getDocumentsMatchingQuery(e,t,nQ.min(),r)}vs(e,t,r,n){return this.ps.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const ul="LocalStore";class uu{constructor(e,t,r,n){this.persistence=e,this.Fs=t,this.serializer=n,this.Ms=new sa(n_),this.xs=new aD(e=>ap(e),am),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lY(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function uh(e,t){return await e.persistence.runTransaction("Handle user change","readonly",r=>{let n;return e.mutationQueue.getAllMutationBatches(r).next(i=>(n=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(r))).next(t=>{let i=[],s=[],a=aB();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(r,a).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function uc(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function ud(e,t,r){let n=e.Ms.get(t);try{r||await e.persistence.runTransaction("Release target",r?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,n))}catch(e){if(!n8(e))throw e;ni(ul,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(n.target)}function uf(e,t,r){let n=nq.min(),i=aB();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,r){let n=e.xs.get(r);return void 0!==n?n0.resolve(e.Ms.get(n)):e.Pi.getTargetData(t,r)})(e,s,aT(t)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,r?n:nq.min(),r?i:aB())).next(r=>{var n,s,a;let o;return n=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),a=r,o=n.Os.get(s)||nq.min(),a.forEach((e,t)=>{t.readTime.compareTo(o)>0&&(o=t.readTime)}),n.Os.set(s,o),{documents:r,Qs:i}}))}class up{constructor(){this.activeTargetIds=az}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class um{constructor(){this.Mo=new up,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new up,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ug{Oo(e){}shutdown(){}}const uy="ConnectivityMonitor";class uv{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(ni(uy,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(ni(uy,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ub=null;function uw(){return null===ub?ub=0x10000000+Math.round(0x80000000*Math.random()):ub++,"0x"+ub.toString(16)}const uE="RestConnection",uI={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class u_{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${n}`,this.Wo=this.databaseId.database===sC?`project_id=${r}`:`project_id=${r}&database_id=${n}`}Go(e,t,r,n,i){let s=uw(),a=this.zo(e,t.toUriEncodedString());ni(uE,`Sending RPC '${e}' ${s}:`,a,r);let o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,n,i);let{host:l}=new URL(a),u=ty(l);return this.Jo(e,a,o,r,u).then(t=>(ni(uE,`Received RPC '${e}' ${s}: `,t),t),t=>{throw na(uE,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",r),t})}Ho(e,t,r,n,i,s){return this.Go(e,t,r,n,i)}jo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+nt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}zo(e,t){let r=uI[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class uT{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const uS="WebChannelConnection";class uA extends u_{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,n,i){let s=uw();return new Promise((i,a)=>{let o=new d;o.setWithCredentials(!0),o.listenOnce(p.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case m.NO_ERROR:let t=o.getResponseJson();ni(uS,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case m.TIMEOUT:ni(uS,`RPC '${e}' ${s} timed out`),a(new nd(nc.DEADLINE_EXCEEDED,"Request time out"));break;case m.HTTP_ERROR:let r=o.getStatus();if(ni(uS,`RPC '${e}' ${s} failed with status:`,r,"response text:",o.getResponseText()),r>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(nc).indexOf(t)>=0?t:nc.UNKNOWN}(t.status);a(new nd(e,t.message))}else a(new nd(nc.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new nd(nc.UNAVAILABLE,"Connection failed."));break;default:nl(9055,{l_:e,streamId:s,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{ni(uS,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(n);ni(uS,`RPC '${e}' ${s} sending request:`,n),o.send(t,"POST",l,r,15)})}T_(e,t,r){let n=uw(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=b(),a=v(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,r),o.encodeInitMessageHeaders=!0;let u=i.join("");ni(uS,`Creating RPC '${e}' stream ${n}: ${u}`,o);let h=s.createWebChannel(u,o);this.I_(h);let c=!1,d=!1,p=new uT({Yo:t=>{d?ni(uS,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(c||(ni(uS,`Opening RPC '${e}' stream ${n} transport.`),h.open(),c=!0),ni(uS,`RPC '${e}' stream ${n} sending:`,t),h.send(t))},Zo:()=>h.close()}),m=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(h,f.EventType.OPEN,()=>{d||(ni(uS,`RPC '${e}' stream ${n} transport opened.`),p.o_())}),m(h,f.EventType.CLOSE,()=>{d||(d=!0,ni(uS,`RPC '${e}' stream ${n} transport closed`),p.a_(),this.E_(h))}),m(h,f.EventType.ERROR,t=>{d||(d=!0,na(uS,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),p.a_(new nd(nc.UNAVAILABLE,"The operation could not be completed")))}),m(h,f.EventType.MESSAGE,t=>{if(!d){let r=t.data[0];nh(!!r,16349);let i=r?.error||r[0]?.error;if(i){ni(uS,`RPC '${e}' stream ${n} received error:`,i);let t=i.status,r=function(e){let t=_[e];if(void 0!==t)return ou(t)}(t),s=i.message;void 0===r&&(r=nc.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,p.a_(new nd(r,s)),h.close()}else ni(uS,`RPC '${e}' stream ${n} received:`,r),p.u_(r)}}),m(a,y.STAT_EVENT,t=>{t.stat===g.PROXY?ni(uS,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===g.NOPROXY&&ni(uS,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{p.__()},0),p}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function uC(){return"undefined"!=typeof document?document:null}function ux(e){return new oC(e,!0)}class uk{constructor(e,t,r=1e3,n=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=n,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&ni("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const uN="PersistentStream";class uR{constructor(e,t,r,n,i,s,a,o){this.Mi=e,this.S_=r,this.b_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new uk(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===nc.RESOURCE_EXHAUSTED?(ns(t.toString()),ns("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===nc.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.D_===t&&this.G_(e,r)},t=>{e(()=>{let e=new nd(nc.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ni(uN,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(ni(uN,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class uD extends uR{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let r;if("targetChange"in t){var n,i;t.targetChange;let s="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:nl(39313,{state:n}),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(nh(void 0===i||"string"==typeof i,58123),sp.fromBase64String(i||"")):(nh(void 0===i||i instanceof rV||i instanceof Uint8Array,16193),sp.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;r=new ob(s,a,o,l&&new nd(void 0===l.code?nc.UNKNOWN:ou(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=oM(e,n.document.name),s=oR(n.document.updateTime),a=n.document.createTime?oR(n.document.createTime):nq.min(),o=new s0({mapValue:{fields:n.document.fields}}),l=s1.newFoundDocument(i,s,a,o);r=new oy(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=oM(e,n.document),s=n.readTime?oR(n.readTime):nq.min(),a=s1.newNoDocument(i,s);r=new oy([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=oM(e,n.document);r=new oy([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return nl(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new ol(n,i);r=new ov(e.targetId,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return nq.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?nq.min():t.readTime?oR(t.readTime):nq.min()}(e);return this.listener.H_(t,r)}Y_(e){let t={};t.database=oU(this.serializer),t.addTarget=function(e,t){let r,n=t.target;if((r=ag(n)?{documents:o$(e,n)}:{query:oH(e,n).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=oN(e,t.resumeToken);let n=ox(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(nq.min())>0){r.readTime=ok(e,t.snapshotVersion.toTimestamp());let n=ox(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let r=function(e,t){let r=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return nl(28987,{purpose:e})}}(t.purpose);return null==r?null:{"goog-listen-tags":r}}(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){let t={};t.database=oU(this.serializer),t.removeTarget=e,this.q_(t)}}class uL extends uR{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return nh(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,nh(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,r;nh(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let n=(t=e.writeResults,r=e.commitTime,t&&t.length>0?(nh(void 0!==r,14353),t.map(e=>{let t;return(t=e.updateTime?oR(e.updateTime):oR(r)).isEqual(nq.min())&&(t=oR(r)),new a1(t,e.transformResults||[])})):[]),i=oR(e.commitTime);return this.listener.na(i,n)}ra(){let e={};e.database=oU(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>oq(this.serializer,e))};this.q_(t)}}class uP{}class uO extends uP{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new nd(nc.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,oL(t,r),n,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nc.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nd(nc.UNKNOWN,e.toString())})}Ho(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Ho(e,oL(t,r),n,s,a,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===nc.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new nd(nc.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class uM{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ns(t),this.aa=!1):ni("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const uF="RemoteStore";class uV{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{r.enqueueAndForget(async()=>{uG(this)&&(ni(uF,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await uB(e),e.Ra.set("Unknown"),e.Ea.delete(4),await uU(e)}(this))})}),this.Ra=new uM(r,n)}}async function uU(e){if(uG(e))for(let t of e.da)await t(!0)}async function uB(e){for(let t of e.da)await t(!1)}function uz(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),uK(e)?uH(e):u9(e).O_()&&uj(e,t))}function uq(e,t){let r=u9(e);e.Ia.delete(t),r.O_()&&u$(e,t),0===e.Ia.size&&(r.O_()?r.L_():uG(e)&&e.Ra.set("Unknown"))}function uj(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(nq.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}u9(e).Y_(t)}function u$(e,t){e.Va.Ue(t),u9(e).Z_(t)}function uH(e){e.Va=new oE({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),u9(e).start(),e.Ra.ua()}function uK(e){return uG(e)&&!u9(e).x_()&&e.Ia.size>0}function uG(e){return 0===e.Ea.size}async function uW(e){e.Ra.set("Online")}async function uQ(e){e.Ia.forEach((t,r)=>{uj(e,t)})}async function uY(e,t){e.Va=void 0,uK(e)?(e.Ra.ha(t),uH(e)):e.Ra.set("Unknown")}async function uJ(e,t,r){if(e.Ra.set("Online"),t instanceof ob&&2===t.state&&t.cause)try{await async function(e,t){let r=t.cause;for(let n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.Va.removeTarget(n))}(e,t)}catch(r){ni(uF,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await uX(e,r)}else if(t instanceof oy?e.Va.Ze(t):t instanceof ov?e.Va.st(t):e.Va.tt(t),!r.isEqual(nq.min()))try{let t=await uc(e.localStore);r.compareTo(t)>=0&&await function(e,t){let r=e.Va.Tt(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(sp.EMPTY_BYTE_STRING,n.snapshotVersion)),u$(e,t);let i=new oY(n.target,t,r,n.sequenceNumber);uj(e,i)}),e.remoteSyncer.applyRemoteEvent(r)}(e,r)}catch(t){ni(uF,"Failed to raise snapshot:",t),await uX(e,t)}}async function uX(e,t,r){if(!n8(t))throw t;e.Ea.add(1),await uB(e),e.Ra.set("Offline"),r||(r=()=>uc(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ni(uF,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await uU(e)})}function uZ(e,t){return t().catch(r=>uX(e,r,t))}async function u0(e){var t;let r=he(e),n=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;uG(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}(e.localStore,n);if(null===t){0===e.Ta.length&&r.L_();break}n=t.batchId,function(e,t){e.Ta.push(t);let r=he(e);r.O_()&&r.X_&&r.ea(t.mutations)}(e,t)}catch(t){await uX(e,t)}u1(e)&&u2(e)}function u1(e){return uG(e)&&!he(e).x_()&&e.Ta.length>0}function u2(e){he(e).start()}async function u5(e){he(e).ra()}async function u6(e){let t=he(e);for(let r of e.Ta)t.ea(r.mutations)}async function u3(e,t,r){let n=e.Ta.shift(),i=oa.from(n,t,r);await uZ(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await u0(e)}async function u4(e,t){t&&he(e).X_&&await async function(e,t){var r;if(function(e){switch(e){case nc.OK:return nl(64938);case nc.CANCELLED:case nc.UNKNOWN:case nc.DEADLINE_EXCEEDED:case nc.RESOURCE_EXHAUSTED:case nc.INTERNAL:case nc.UNAVAILABLE:case nc.UNAUTHENTICATED:return!1;case nc.INVALID_ARGUMENT:case nc.NOT_FOUND:case nc.ALREADY_EXISTS:case nc.PERMISSION_DENIED:case nc.FAILED_PRECONDITION:case nc.ABORTED:case nc.OUT_OF_RANGE:case nc.UNIMPLEMENTED:case nc.DATA_LOSS:return!0;default:return nl(15467,{code:e})}}(r=t.code)&&r!==nc.ABORTED){let r=e.Ta.shift();he(e).B_(),await uZ(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await u0(e)}}(e,t),u1(e)&&u2(e)}async function u8(e,t){e.asyncQueue.verifyOperationInProgress(),ni(uF,"RemoteStore received new credentials");let r=uG(e);e.Ea.add(3),await uB(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await uU(e)}async function u7(e,t){t?(e.Ea.delete(2),await uU(e)):t||(e.Ea.add(2),await uB(e),e.Ra.set("Unknown"))}function u9(e){var t,r,n;return e.ma||(t=e.datastore,r=e.asyncQueue,n={Xo:uW.bind(null,e),t_:uQ.bind(null,e),r_:uY.bind(null,e),H_:uJ.bind(null,e)},t.sa(),e.ma=new uD(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.da.push(async t=>{t?(e.ma.B_(),uK(e)?uH(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function he(e){var t,r,n;return e.fa||(t=e.datastore,r=e.asyncQueue,n={Xo:()=>Promise.resolve(),t_:u5.bind(null,e),r_:u4.bind(null,e),ta:u6.bind(null,e),na:u3.bind(null,e)},t.sa(),e.fa=new uL(r,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,n),e.da.push(async t=>{t?(e.fa.B_(),await u0(e)):(await e.fa.stop(),e.Ta.length>0&&(ni(uF,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class ht{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new nf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new ht(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new nd(nc.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hr(e,t){if(ns("AsyncQueue",`${t}: ${e}`),n8(e))return new nd(nc.UNAVAILABLE,`${t}: ${e}`);throw e}class hn{static emptySet(e){return new hn(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||nD.comparator(t.key,r.key):(e,t)=>nD.comparator(e.key,t.key),this.keyedMap=aO(),this.sortedSet=new sa(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hn)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new hn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class hi{constructor(){this.ga=new sa(nD.comparator)}track(e){let t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):nl(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class hs{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new hs(e,t,hn.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&aC(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class ha{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class ho{constructor(){this.queries=hl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){let r=e.queries;e.queries=hl(),r.forEach((e,r)=>{for(let e of r.Sa)e.onError(t)})}(this,new nd(nc.ABORTED,"Firestore shutting down"))}}function hl(){return new aD(e=>ax(e),aC)}async function hu(e,t){let r=3,n=t.query,i=e.queries.get(n);i?!i.ba()&&t.Da()&&(r=2):(i=new ha,r=+!t.Da());try{switch(r){case 0:i.wa=await e.onListen(n,!0);break;case 1:i.wa=await e.onListen(n,!1);break;case 2:await e.onFirstRemoteStoreListen(n)}}catch(r){let e=hr(r,`Initialization of query '${ak(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&hf(e)}async function hh(e,t){let r=t.query,n=3,i=e.queries.get(r);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?n=+!t.Da():!i.ba()&&t.Da()&&(n=2))}switch(n){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function hc(e,t){let r=!1;for(let n of t){let t=n.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(n)&&(r=!0);i.wa=n}}r&&hf(e)}function hd(e,t,r){let n=e.queries.get(t);if(n)for(let e of n.Sa)e.onError(r);e.queries.delete(t)}function hf(e){e.Ca.forEach(e=>{e.next()})}(A=S||(S={})).Ma="default",A.Cache="cache";class hp{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new hs(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=hs.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==S.Cache}}class hm{constructor(e){this.key=e}}class hg{constructor(e){this.key=e}}class hy{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=aB(),this.mutatedKeys=aB(),this.eu=aR(e),this.tu=new hn(this.eu)}get nu(){return this.Ya}ru(e,t){let r=t?t.iu:new hi,n=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),h=aN(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?c!==d&&(r.track({type:3,doc:h}),f=!0):this.su(u,h)||(r.track({type:2,doc:h}),f=!0,(o&&this.eu(h,o)>0||l&&0>this.eu(h,l))&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Cs:a,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>(function(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return nl(20277,{Rt:e})}};return r(e)-r(t)})(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(r),n=n??!1;let a=t&&!n?this._u():[],o=0===this.Xa.size&&this.current&&!n?1:0,l=o!==this.Za;return(this.Za=o,0!==s.length||l)?{snapshot:new hs(this.query,e.tu,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new hi,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=aB(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new hg(e))}),this.Xa.forEach(r=>{e.has(r)||t.push(new hm(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=aB();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return hs.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const hv="SyncEngine";class hb{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class hw{constructor(e){this.key=e,this.hu=!1}}class hE{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new aD(e=>ax(e),aC),this.Iu=new Map,this.Eu=new Set,this.du=new sa(nD.comparator),this.Au=new Map,this.Ru=new l0,this.Vu={},this.mu=new Map,this.fu=lL.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function hI(e,t,r=!0){let n,i=hj(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.lu()):n=await hT(i,t,r,!0),n}async function h_(e,t){let r=hj(e);await hT(r,t,!0,!1)}async function hT(e,t,r,n){var i,s;let a,o=await (i=e.localStore,s=aT(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Pi.getTargetData(e,s).next(r=>r?(t=r,n0.resolve(t)):i.Pi.allocateTargetId(e).next(r=>(t=new oY(s,r,"TargetPurposeListen",e.currentSequenceNumber),i.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(e.targetId,e),i.xs.set(s,e.targetId)),e})),l=o.targetId,u=e.sharedClientState.addLocalQueryTarget(l,r);return n&&(a=await hS(e,t,l,"current"===u,o.resumeToken)),e.isPrimaryClient&&r&&uz(e.remoteStore,o),a}async function hS(e,t,r,n,i){e.pu=(t,r,n)=>(async function(e,t,r,n){let i=t.view.ru(r);i.Cs&&(i=await uf(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return hV(e,t.targetId,o.au),o.snapshot})(e,t,r,n);let s=await uf(e.localStore,t,!0),a=new hy(t,s.Qs),o=a.ru(s.documents),l=og.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);hV(e,r,u.au);let h=new hb(t,r,a);return e.Tu.set(t,h),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),u.snapshot}async function hA(e,t,r){let n=e.Tu.get(t),i=e.Iu.get(n.targetId);if(i.length>1)return e.Iu.set(n.targetId,i.filter(e=>!aC(e,t))),void e.Tu.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await ud(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),r&&uq(e.remoteStore,n.targetId),hM(e,n.targetId)}).catch(nZ)):(hM(e,n.targetId),await ud(e.localStore,n.targetId,!0))}async function hC(e,t){let r=e.Tu.get(t),n=e.Iu.get(r.targetId);e.isPrimaryClient&&1===n.length&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),uq(e.remoteStore,r.targetId))}async function hx(e,t,r){let n=h$(e);try{var i;let e,s=await function(e,t){let r,n,i=nz.now(),s=t.reduce((e,t)=>e.add(t.key),aB());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=aL,l=aB();return e.Ns.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(n=>{r=n;let s=[];for(let e of t){let t=function(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=aH(n.transform,e||null);null!=i&&(null===r&&(r=s0.empty()),r.set(n.field,i))}return r||null}(e,r.get(e.key).overlayedDocument);null!=t&&s.push(new a9(e.key,t,function e(t){let r=[];return si(t.fields,(t,n)=>{let i=new nR([t]);if(sG(n)){let t=e(n.mapValue).fields;if(0===t.length)r.push(i);else for(let e of t)r.push(i.child(e))}else r.push(i)}),new sd(r)}(t.value.mapValue),a2.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{n=t;let i=t.applyToLocalDocumentSet(r,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:n.batchId,changes:aM(r)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(s.batchId),i=s.batchId,(e=n.Vu[n.currentUser.toKey()])||(e=new sa(n_)),e=e.insert(i,r),n.Vu[n.currentUser.toKey()]=e,await hB(n,s.changes),await u0(n.remoteStore)}catch(t){let e=hr(t,"Failed to persist write");r.reject(e)}}async function hk(e,t){try{let r=await function(e,t){let r=t.snapshotVersion,n=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{var s,a,o;let l,u,h=e.Ns.newChangeBuffer({trackRemovals:!0});n=e.Ms;let c=[];t.targetChanges.forEach((s,a)=>{var o;let l=n.get(a);if(!l)return;c.push(e.Pi.removeMatchingKeys(i,s.removedDocuments,a).next(()=>e.Pi.addMatchingKeys(i,s.addedDocuments,a)));let u=l.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(sp.EMPTY_BYTE_STRING,nq.min()).withLastLimboFreeSnapshotVersion(nq.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),n=n.insert(a,u),o=u,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(e.Pi.updateTargetData(i,u))});let d=aL,f=aB();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&c.push(e.persistence.referenceDelegate.updateLimboDocument(i,r))}),c.push((s=i,a=h,o=t.documentUpdates,l=aB(),u=aB(),o.forEach(e=>l=l.add(e)),a.getEntries(s,l).next(e=>{let t=aL;return o.forEach((r,n)=>{let i=e.get(r);n.isFoundDocument()!==i.isFoundDocument()&&(u=u.add(r)),n.isNoDocument()&&n.version.isEqual(nq.min())?(a.removeEntry(r,n.readTime),t=t.insert(r,n)):!i.isValidDocument()||n.version.compareTo(i.version)>0||0===n.version.compareTo(i.version)&&i.hasPendingWrites?(a.addEntry(n),t=t.insert(r,n)):ni(ul,"Ignoring outdated watch update for ",r,". Current version:",i.version," Watch version:",n.version)}),{ks:t,qs:u}})).next(e=>{d=e.ks,f=e.qs})),!r.isEqual(nq.min())){let t=e.Pi.getLastRemoteSnapshotVersion(i).next(t=>e.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));c.push(t)}return n0.waitFor(c).next(()=>h.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,d,f)).next(()=>d)}).then(t=>(e.Ms=n,t))}(e.localStore,t);t.targetChanges.forEach((t,r)=>{let n=e.Au.get(r);n&&(nh(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?n.hu=!0:t.modifiedDocuments.size>0?nh(n.hu,14607):t.removedDocuments.size>0&&(nh(n.hu,42227),n.hu=!1))}),await hB(e,r,t)}catch(e){await nZ(e)}}function hN(e,t,r){var n;if(e.isPrimaryClient&&0===r||!e.isPrimaryClient&&1===r){let r,i=[];e.Tu.forEach((e,r)=>{let n=r.view.va(t);n.snapshot&&i.push(n.snapshot)}),(n=e.eventManager).onlineState=t,r=!1,n.queries.forEach((e,n)=>{for(let e of n.Sa)e.va(t)&&(r=!0)}),r&&hf(n),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function hR(e,t,r){e.sharedClientState.updateQueryState(t,"rejected",r);let n=e.Au.get(t),i=n&&n.key;if(i){let r=new sa(nD.comparator);r=r.insert(i,s1.newNoDocument(i,nq.min()));let n=aB().add(i),s=new om(nq.min(),new Map,new sa(n_),r,n);await hk(e,s),e.du=e.du.remove(i),e.Au.delete(t),hU(e)}else await ud(e.localStore,t,!1).then(()=>hM(e,t,r)).catch(nZ)}async function hD(e,t){var r;let n=t.batch.batchId;try{let i=await (r=e.localStore,r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.Ns.newChangeBuffer({trackRemovals:!0});return(function(e,t,r,n){let i=r.batch,s=i.keys(),a=n0.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);nh(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=aB();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,n))}));hO(e,n,null),hP(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),await hB(e,i)}catch(e){await nZ(e)}}async function hL(e,t,r){var n;try{let i=await (n=e.localStore,n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(nh(null!==t,37113),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))}));hO(e,t,r),hP(e,t),e.sharedClientState.updateMutationState(t,"rejected",r),await hB(e,i)}catch(e){await nZ(e)}}function hP(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function hO(e,t,r){let n=e.Vu[e.currentUser.toKey()];if(n){let i=n.get(t);i&&(r?i.reject(r):i.resolve(),n=n.remove(t)),e.Vu[e.currentUser.toKey()]=n}}function hM(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||hF(e,t)})}function hF(e,t){e.Eu.delete(t.path.canonicalString());let r=e.du.get(t);null!==r&&(uq(e.remoteStore,r),e.du=e.du.remove(t),e.Au.delete(r),hU(e))}function hV(e,t,r){for(let n of r)n instanceof hm?(e.Ru.addReference(n.key,t),function(e,t){let r=t.key,n=r.path.canonicalString();e.du.get(r)||e.Eu.has(n)||(ni(hv,"New document in limbo: "+r),e.Eu.add(n),hU(e))}(e,n)):n instanceof hg?(ni(hv,"Document no longer in limbo: "+n.key),e.Ru.removeReference(n.key,t),e.Ru.containsKey(n.key)||hF(e,n.key)):nl(19791,{wu:n})}function hU(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let r=new nD(nk.fromString(t)),n=e.fu.next();e.Au.set(n,new hw(r)),e.du=e.du.insert(r,n),uz(e.remoteStore,new oY(aT(new aw(r.path)),n,"TargetPurposeLimboResolution",ia.ce))}}async function hB(e,t,r){let n=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((a,o)=>{s.push(e.pu(o,t,r).then(t=>{if((t||r)&&e.isPrimaryClient){let n=t?!t.fromCache:r?.targetChanges.get(o.targetId)?.current;e.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(t){n.push(t);let e=us.As(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(n),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>n0.forEach(t,t=>n0.forEach(t.Es,n=>e.persistence.referenceDelegate.addReference(r,t.targetId,n)).next(()=>n0.forEach(t.ds,n=>e.persistence.referenceDelegate.removeReference(r,t.targetId,n)))))}catch(e){if(!n8(e))throw e;ni(ul,"Failed to update sequence numbers: "+e)}for(let r of t){let t=r.targetId;if(!r.fromCache){let r=e.Ms.get(t),n=r.snapshotVersion,i=r.withLastLimboFreeSnapshotVersion(n);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function hz(e,t){if(!e.currentUser.isEqual(t)){ni(hv,"User change. New user:",t.toKey());let r=await uh(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new nd(nc.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await hB(e,r.Ls)}}function hq(e,t){let r=e.Au.get(t);if(r&&r.hu)return aB().add(r.key);{let r=aB(),n=e.Iu.get(t);if(!n)return r;for(let t of n){let n=e.Tu.get(t);r=r.unionWith(n.view.nu)}return r}}function hj(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=hk.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hq.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=hR.bind(null,e),e.Pu.H_=hc.bind(null,e.eventManager),e.Pu.yu=hd.bind(null,e.eventManager),e}function h$(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=hD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=hL.bind(null,e),e}class hH{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ux(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,r;return t=this.persistence,r=new uo,new uu(t,r,e.initialUser,this.serializer)}Cu(e){return new l4(l7.mi,this.serializer)}Du(e){return new um}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}hH.provider={build:()=>new hH};class hK extends hH{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return nh(this.persistence.referenceDelegate instanceof l9,46915),new lU(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?lC.withCacheSize(this.cacheSizeBytes):lC.DEFAULT;return new l4(e=>l9.mi(e,t),this.serializer)}}class hG extends hH{constructor(e,t,r){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await h$(this.xu.syncEngine),await u0(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){var t,r;return t=this.persistence,r=new uo,new uu(t,r,e.initialUser,this.serializer)}Fu(e,t){return new lU(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Mu(e,t){let r=new is(t,this.persistence);return new ii(e.asyncQueue,r)}Cu(e){var t,r;let n,i=(t=e.databaseInfo.databaseId,r=e.databaseInfo.persistenceKey,n=t.projectId,t.isDefaultDatabase||(n+="."+t.database),"firestore/"+r+"/"+n+"/"),s=void 0!==this.cacheSizeBytes?lC.withCacheSize(this.cacheSizeBytes):lC.DEFAULT;return new ui(this.synchronizeTabs,i,e.clientId,s,e.asyncQueue,"undefined"!=typeof window?window:null,uC(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new um}}class hW{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>hN(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=hz.bind(null,this.syncEngine),await u7(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new ho}createDatastore(e){var t;let r=ux(e.databaseInfo.databaseId),n=new uA(e.databaseInfo);return t=e.authCredentials,new uO(t,e.appCheckCredentials,n,r)}createRemoteStore(e){var t,r;return t=this.localStore,r=this.datastore,new uV(t,r,e.asyncQueue,e=>hN(this.syncEngine,e,0),uv.v()?new uv:new ug)}createSyncEngine(e,t){return function(e,t,r,n,i,s,a){let o=new hE(e,t,r,n,i,s);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await async function(e){ni(uF,"RemoteStore shutting down."),e.Ea.add(5),await uB(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}hW.provider={build:()=>new hW};class hQ{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):ns("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const hY="FirestoreClient";class hJ{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=ne.UNAUTHENTICATED,this.clientId=nI.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{ni(hY,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(ni(hY,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new nf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=hr(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function hX(e,t){e.asyncQueue.verifyOperationInProgress(),ni(hY,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await uh(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function hZ(e,t){e.asyncQueue.verifyOperationInProgress();let r=await h0(e);ni(hY,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>u8(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>u8(t.remoteStore,r)),e._onlineComponents=t}async function h0(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ni(hY,"Using user provided OfflineComponentProvider");try{await hX(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===nc.FAILED_PRECONDITION||t.code===nc.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;na("Error using user provided cache. Falling back to memory cache: "+t),await hX(e,new hH)}}else ni(hY,"Using default OfflineComponentProvider"),await hX(e,new hK(void 0));return e._offlineComponents}async function h1(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ni(hY,"Using user provided OnlineComponentProvider"),await hZ(e,e._uninitializedComponentsProvider._online)):(ni(hY,"Using default OnlineComponentProvider"),await hZ(e,new hW))),e._onlineComponents}async function h2(e){let t=await h1(e),r=t.eventManager;return r.onListen=hI.bind(null,t.syncEngine),r.onUnlisten=hA.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=h_.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=hC.bind(null,t.syncEngine),r}function h5(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const h6=new Map,h3="firestore.googleapis.com";class h4{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new nd(nc.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=h3,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new nd(nc.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new nd(nc.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=h5(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new nd(nc.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new nd(nc.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new nd(nc.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,r;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class h8{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new h4({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new nd(nc.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new nd(nc.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new h4(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new nm;switch(e.type){case"firstParty":return new nb(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new nd(nc.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=h6.get(e);t&&(ni("ComponentProvider","Removing Datastore"),h6.delete(e),t.terminate())}(this),Promise.resolve()}}class h7{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new h7(this.firestore,e,this._query)}}class h9{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ce(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new h9(this.firestore,e,this._key)}toJSON(){return{type:h9._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(nB(t,h9._jsonSchema))return new h9(e,r||null,new nD(nk.fromString(t.referencePath)))}}h9._jsonSchemaVersion="firestore/documentReference/1.0",h9._jsonSchema={type:nU("string",h9._jsonSchemaVersion),referencePath:nU("string")};class ce extends h7{constructor(e,t,r){super(e,t,new aw(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new h9(this.firestore,null,new nD(e))}withConverter(e){return new ce(this.firestore,e,this._path)}}function ct(e,t,...r){if(e=tF(e),nL("collection","path",t),e instanceof h8){let n=nk.fromString(t,...r);return nO(n),new ce(e,null,n)}{if(!(e instanceof h9||e instanceof ce))throw new nd(nc.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(nk.fromString(t,...r));return nO(n),new ce(e.firestore,null,n)}}function cr(e,t,...r){if(e=tF(e),1==arguments.length&&(t=nI.newId()),nL("doc","path",t),e instanceof h8){let n=nk.fromString(t,...r);return nP(n),new h9(e,null,new nD(n))}{if(!(e instanceof h9||e instanceof ce))throw new nd(nc.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(nk.fromString(t,...r));return nP(n),new h9(e.firestore,e instanceof ce?e.converter:null,new nD(n))}}const cn="AsyncQueue";class ci{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new uk(this,"async_queue_retry"),this._c=()=>{let e=uC();e&&ni(cn,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;let t=uC();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=uC();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new nf;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!n8(e))throw e;ni(cn,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,ns("INTERNAL UNHANDLED ERROR: ",cs(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let n=ht.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&nl(47125,{Pc:cs(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function cs(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class ca extends h8{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new ci,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ci(e),this._firestoreClient=void 0,await e}}}function co(e){if(e._terminated)throw new nd(nc.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||cl(e),e._firestoreClient}function cl(e){var t,r;let n=e._freezeSettings(),i=(t=e._databaseId,r=e._app?.options.appId||"",new sA(t,r,e._persistenceKey,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,h5(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator));e._componentsProvider||n.localCache?._offlineComponentProvider&&n.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),e._firestoreClient=new hJ(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}(e._componentsProvider))}class cu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cu(sp.fromBase64String(e))}catch(e){throw new nd(nc.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cu(sp.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:cu._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(nB(e,cu._jsonSchema))return cu.fromBase64String(e.bytes)}}cu._jsonSchemaVersion="firestore/bytes/1.0",cu._jsonSchema={type:nU("string",cu._jsonSchemaVersion),bytes:nU("string")};class ch{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new nd(nc.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new nR(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cc{constructor(e){this._methodName=e}}class cd{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new nd(nc.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new nd(nc.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return n_(this._lat,e._lat)||n_(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:cd._jsonSchemaVersion}}static fromJSON(e){if(nB(e,cd._jsonSchema))return new cd(e.latitude,e.longitude)}}cd._jsonSchemaVersion="firestore/geoPoint/1.0",cd._jsonSchema={type:nU("string",cd._jsonSchemaVersion),latitude:nU("number"),longitude:nU("number")};class cf{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:cf._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(nB(e,cf._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new cf(e.vectorValues);throw new nd(nc.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}cf._jsonSchemaVersion="firestore/vectorValue/1.0",cf._jsonSchema={type:nU("string",cf._jsonSchemaVersion),vectorValues:nU("object")};const cp=/^__.*__$/;class cm{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new a9(e,this.data,this.fieldMask,t,this.fieldTransforms):new a7(e,this.data,t,this.fieldTransforms)}}class cg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new a9(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function cy(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw nl(40011,{Ac:e})}}class cv{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new cv({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){let t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return cN(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(cy(this.Ac)&&cp.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class cb{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ux(e)}Cc(e,t,r,n=!1){return new cv({Ac:e,methodName:t,Dc:r,path:nR.emptyPath(),fc:!1,bc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function cw(e){let t=e._freezeSettings(),r=ux(e._databaseId);return new cb(e._databaseId,!!t.ignoreUndefinedProperties,r)}function cE(e,t,r,n,i,s={}){let a,o,l=e.Cc(s.merge||s.mergeFields?2:0,t,r,i);cA("Data must be an object, but it was:",l,n);let u=cT(n,l);if(s.merge)a=new sd(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=cC(t,n,r);if(!l.contains(i))throw new nd(nc.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);cR(e,i)||e.push(i)}a=new sd(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new cm(new s0(u),a,o)}class cI extends cc{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof cI}}function c_(e,t){if(cS(e=tF(e)))return cA("Unsupported field value:",t,e),cT(e,t);if(e instanceof cc)return function(e,t){if(!cy(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let r=[],n=0;for(let i of e){let e=c_(i,t.wc(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}return function(e,t){var r,n,i;if(null===(e=tF(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return r=t.serializer,"number"==typeof(i=n=e)&&Number.isInteger(i)&&!io(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?aj(n):aq(r,n);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=nz.fromDate(e);return{timestampValue:ok(t.serializer,r)}}if(e instanceof nz){let r=new nz(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ok(t.serializer,r)}}if(e instanceof cd)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof cu)return{bytesValue:oN(t.serializer,e._byteString)};if(e instanceof h9){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.Sc(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:oD(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof cf)return{mapValue:{fields:{[sk]:{stringValue:sD},[sL]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return aq(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${nF(e)}`)}(e,t)}function cT(e,t){let r={};return ss(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):si(e,(e,n)=>{let i=c_(n,t.mc(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function cS(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof nz||e instanceof cd||e instanceof cu||e instanceof h9||e instanceof cc||e instanceof cf)}function cA(e,t,r){if(!cS(r)||!nM(r)){let n=nF(r);throw"an object"===n?t.Sc(e+" a custom object"):t.Sc(e+" "+n)}}function cC(e,t,r){if((t=tF(t))instanceof ch)return t._internalPath;if("string"==typeof t)return ck(e,t);throw cN("Field path arguments must be of type string or ",e,!1,void 0,r)}const cx=RegExp("[~\\*/\\[\\]]");function ck(e,t,r){if(t.search(cx)>=0)throw cN(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new ch(...t.split("."))._internalPath}catch(n){throw cN(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function cN(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new nd(nc.INVALID_ARGUMENT,o+e+l)}function cR(e,t){return e.some(e=>e.isEqual(t))}class cD{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new h9(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new cL(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(cP("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class cL extends cD{data(){return super.data()}}function cP(e,t){return"string"==typeof t?ck(e,t):t instanceof ch?t._internalPath:t._delegate._internalPath}class cO{}class cM extends cO{}function cF(e,t,...r){let n=[];for(let i of(t instanceof cO&&n.push(t),function(e){let t=e.filter(e=>e instanceof cB).length,r=e.filter(e=>e instanceof cV).length;if(t>1||t>0&&r>0)throw new nd(nc.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n=n.concat(r)),n))e=i._apply(e);return e}class cV extends cM{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new cV(e,t,r)}_apply(e){let t=this._parse(e);return cH(e._query,t),new h7(e.firestore,e.converter,aS(e._query,t))}_parse(e){let t=cw(e.firestore);return function(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new nd(nc.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){c$(a,s);let t=[];for(let r of a)t.push(cj(n,e,r));o={arrayValue:{values:t}}}else o=cj(n,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||c$(a,s),o=function(e,t,r,n=!1){return c_(r,e.Cc(n?4:3,t))}(r,t,a,"in"===s||"not-in"===s);return s8.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function cU(e,t,r){let n=cP("where",e);return cV._create(n,t,r)}class cB extends cO{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new cB(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:s7.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;for(let e of t.getFlattenedFilters())cH(r,e),r=aS(r,e)}(e._query,t),new h7(e.firestore,e.converter,aS(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class cz extends cM{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new cz(e,t)}_apply(e){let t=function(e,t,r){if(null!==e.startAt)throw new nd(nc.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new nd(nc.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new s3(t,r)}(e._query,this._field,this._direction);return new h7(e.firestore,e.converter,function(e,t){let r=e.explicitOrderBy.concat([t]);return new aw(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class cq extends cM{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new cq(e,t,r)}_apply(e){return new h7(e.firestore,e.converter,aA(e._query,this._limit,this._limitType))}}function cj(e,t,r){if("string"==typeof(r=tF(r))){if(""===r)throw new nd(nc.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aI(t)&&-1!==r.indexOf("/"))throw new nd(nc.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(nk.fromString(r));if(!nD.isDocumentKey(n))throw new nd(nc.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return sq(e,new nD(n))}if(r instanceof h9)return sq(e,r._key);throw new nd(nc.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nF(r)}.`)}function c$(e,t){if(!Array.isArray(e)||0===e.length)throw new nd(nc.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function cH(e,t){let r=function(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new nd(nc.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new nd(nc.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}class cK{convertValue(e,t="none"){switch(sO(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sy(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sv(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw nl(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return si(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new cf(e.fields?.[sL].arrayValue?.values?.map(e=>sy(e.doubleValue)))}convertGeoPoint(e){return new cd(sy(e.latitude),sy(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=sT(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(sS(e));default:return null}}convertTimestamp(e){let t=sg(e);return new nz(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=nk.fromString(e);nh(oQ(r),9688,{name:e});let n=new sx(r.get(1),r.get(3)),i=new nD(r.popFirst(5));return n.isEqual(t)||ns(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function cG(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class cW{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class cQ extends cD{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new cY(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(cP("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new nd(nc.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=cQ._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}cQ._jsonSchemaVersion="firestore/documentSnapshot/1.0",cQ._jsonSchema={type:nU("string",cQ._jsonSchemaVersion),bundleSource:nU("string","DocumentSnapshot"),bundleName:nU("string"),bundle:nU("string")};class cY extends cQ{data(e={}){return super.data(e)}}class cJ{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new cW(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new cY(this._firestore,this._userDataWriter,r.key,r,new cW(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new nd(nc.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new cY(e._firestore,e._userDataWriter,r.doc.key,r.doc,new cW(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new cY(e._firestore,e._userDataWriter,t.doc.key,t.doc,new cW(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return nl(61501,{type:e})}}(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new nd(nc.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=cJ._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=nI.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}cJ._jsonSchemaVersion="firestore/querySnapshot/1.0",cJ._jsonSchema={type:nU("string",cJ._jsonSchemaVersion),bundleSource:nU("string","QuerySnapshot"),bundleName:nU("string"),bundle:nU("string")};class cX extends cK{constructor(e){super(),this.firestore=e}convertBytes(e){return new cu(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new h9(this.firestore,null,t)}}function cZ(e){e=nV(e,h7);let t=nV(e.firestore,ca),r=co(t),n=new cX(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new nd(nc.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),(function(e,t,r={}){let n=new nf;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,r,n,i){let s=new hQ({next:r=>{s.Nu(),t.enqueueAndForget(()=>hh(e,a)),r.fromCache&&"server"===n.source?i.reject(new nd(nc.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new hp(r,s,{includeMetadataChanges:!0,qa:!0});return hu(e,a)})(await h2(e),e.asyncQueue,t,r,n)),n.promise})(r,e._query).then(r=>new cJ(t,n,e,r))}function c0(e,t){var r=co(e);let n=new nf;return r.asyncQueue.enqueueAndForget(async()=>hx(await h1(r).then(e=>e.syncEngine),t,n)),n.promise}class c1{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=cw(e)}set(e,t,r){this._verifyNotCommitted();let n=c2(e,this._firestore),i=cG(n.converter,t,r),s=cE(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,a2.none())),this}update(e,t,r,...n){let i;this._verifyNotCommitted();let s=c2(e,this._firestore);return i="string"==typeof(t=tF(t))||t instanceof ch?function(e,t,r,n,i,s){let a=e.Cc(1,t,r),o=[cC(t,n,r)],l=[i];if(s.length%2!=0)throw new nd(nc.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(cC(t,s[e])),l.push(s[e+1]);let u=[],h=s0.empty();for(let e=o.length-1;e>=0;--e)if(!cR(u,o[e])){let t=o[e],r=l[e];r=tF(r);let n=a.yc(t);if(r instanceof cI)u.push(t);else{let e=c_(r,n);null!=e&&(u.push(t),h.set(t,e))}}return new cg(h,new sd(u),a.fieldTransforms)}(this._dataReader,"WriteBatch.update",s._key,t,r,n):function(e,t,r,n){let i=e.Cc(1,t,r);cA("Data must be an object, but it was:",i,n);let s=[],a=s0.empty();return si(n,(e,n)=>{let o=ck(t,e,r);n=tF(n);let l=i.yc(o);if(n instanceof cI)s.push(o);else{let e=c_(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new cg(a,new sd(s),i.fieldTransforms)}(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(i.toMutation(s._key,a2.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=c2(e,this._firestore);return this._mutations=this._mutations.concat(new on(t._key,a2.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new nd(nc.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function c2(e,t){if((e=tF(e)).firestore!==t)throw new nd(nc.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function c5(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}new WeakMap,function(e=!0){nt=rd,ro(new tV("firestore",(t,{instanceIdentifier:r,options:n})=>{let i=t.getProvider("app").getImmediate(),s=new ca(new ny(t.getProvider("auth-internal")),new nE(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new nd(nc.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sx(e.options.projectId,t)}(i,r),i);return n={useFetchStreams:e,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),rm(r7,r9,void 0),rm(r7,r9,"esm2020")}(),rm("firebase","12.6.0","app");const c6=new tx("auth","Firebase",c5()),c3=new tG("@firebase/auth");function c4(e,...t){c3.logLevel<=u.ERROR&&c3.error(`Auth (${rd}): ${e}`,...t)}function c8(e,...t){throw dt(e,...t)}function c7(e,...t){return dt(e,...t)}function c9(e,t,r){return new tx("auth","Firebase",{...c5(),[t]:r}).create(t,{appName:e.name})}function de(e){return c9(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function dt(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return c6.create(e,...t)}function dr(e,t,...r){if(!e)throw dt(t,...r)}function dn(e){let t="INTERNAL ASSERTION FAILED: "+e;throw c4(t),Error(t)}function di(e,t){e||dn(t)}function ds(){return"undefined"!=typeof self&&self.location?.href||""}function da(){return"undefined"!=typeof self&&self.location?.protocol||null}class dl{constructor(e,t){var r;this.shortDelay=e,this.longDelay=t,r="Short delay should be less than long delay!",t>e||dn(r),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(tI())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===da()||"https:"===da()||function(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function du(e,t){var r,n;r=e.emulator,n="Emulator should always be set here",r||dn(n);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class dh{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void dn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void dn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void dn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const dc={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},dd=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],df=new dl(3e4,6e4);function dp(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function dm(e,t,r,n,i={}){return dg(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=tD({key:e.config.apiKey,...s}).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:o,...i};return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&ty(e.emulatorConfig.host)&&(l.credentials="include"),dh.fetch()(await dv(e,e.config.apiHost,r,a),l)})}async function dg(e,t,r){e._canInitEmulator=!1;let n={...dc,...t};try{let t=new db(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw dw(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw dw(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw dw(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw dw(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw c9(e,a,r);c8(e,a)}}catch(t){if(t instanceof tC)throw t;c8(e,"network-request-failed",{message:String(t)})}}async function dy(e,t,r,n,i={}){let s=await dm(e,t,r,n,i);return"mfaPendingCredential"in s&&c8(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function dv(e,t,r,n){let i=`${t}${r}?${n}`,s=e.config.emulator?du(e.config,i):`${e.config.apiScheme}://${i}`;return dd.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class db{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(c7(this.auth,"network-request-failed")),df.get())})}}function dw(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=c7(e,t,n);return i.customData._tokenResponse=r,i}function dE(e){return void 0!==e&&void 0!==e.enterprise}class dI{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function d_(e,t){return dm(e,"GET","/v2/recaptchaConfig",dp(e,t))}async function dT(e,t){return dm(e,"POST","/v1/accounts:delete",t)}async function dS(e,t){return dm(e,"POST","/v1/accounts:lookup",t)}function dA(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function dC(e,t=!1){let r=tF(e),n=await r.getIdToken(t),i=dk(n);dr(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=s?.sign_in_provider;return{claims:i,token:n,authTime:dA(dx(i.auth_time)),issuedAtTime:dA(dx(i.iat)),expirationTime:dA(dx(i.exp)),signInProvider:a||null,signInSecondFactor:s?.sign_in_second_factor||null}}function dx(e){return 1e3*Number(e)}function dk(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return c4("JWT malformed, contained fewer than 3 sections"),null;try{let e=ta(r);if(!e)return c4("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return c4("Caught error parsing JWT payload as JSON",e?.toString()),null}}function dN(e){let t=dk(e);return dr(t,"internal-error"),dr(void 0!==t.exp,"internal-error"),dr(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function dR(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof tC&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class dD{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class dL{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=dA(this.lastLoginAt),this.creationTime=dA(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function dP(e){var t,r;let n=e.auth,i=await e.getIdToken(),s=await dR(e,dS(n,{idToken:i}));dr(s?.users.length,n,"internal-error");let a=s.users[0];e._notifyReloadListener(a);let o=a.providerUserInfo?.length?dM(a.providerUserInfo):[],l=(t=e.providerData,r=o,[...t.filter(e=>!r.some(t=>t.providerId===e.providerId)),...r]),u=e.isAnonymous,h=!(e.email&&a.passwordHash)&&!l?.length;Object.assign(e,{uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new dL(a.createdAt,a.lastLoginAt),isAnonymous:!!u&&h})}async function dO(e){let t=tF(e);await dP(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function dM(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function dF(e,t){let r=await dg(e,{},async()=>{let r=tD({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await dv(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&ty(e.emulatorConfig.host)&&(o.credentials="include"),dh.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function dV(e,t){return dm(e,"POST","/v2/accounts:revokeToken",dp(e,t))}class dU{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){dr(e.idToken,"internal-error"),dr(void 0!==e.idToken,"internal-error"),dr(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):dN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){dr(0!==e.length,"internal-error");let t=dN(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(dr(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await dF(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new dU;return r&&(dr("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(dr("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(dr("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new dU,this.toJSON())}_performRefresh(){return dn("not implemented")}}function dB(e,t){dr("string"==typeof e||void 0===e,"internal-error",{appName:t})}class dz{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new dD(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new dL(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await dR(this,this.stsTokenManager.getToken(this.auth,e));return dr(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return dC(this,e)}reload(){return dO(this)}_assign(e){this!==e&&(dr(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new dz({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){dr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await dP(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ru(this.auth.app))return Promise.reject(de(this.auth));let e=await this.getIdToken();return await dR(this,dT(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:h,emailVerified:c,isAnonymous:d,providerData:f,stsTokenManager:p}=t;dr(h&&p,e,"internal-error");let m=dU.fromJSON(this.name,p);dr("string"==typeof h,e,"internal-error"),dB(r,e.name),dB(n,e.name),dr("boolean"==typeof c,e,"internal-error"),dr("boolean"==typeof d,e,"internal-error"),dB(i,e.name),dB(s,e.name),dB(a,e.name),dB(o,e.name),dB(l,e.name),dB(u,e.name);let g=new dz({uid:h,auth:e,email:n,emailVerified:c,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:u});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,r=!1){let n=new dU;n.updateFromServerResponse(t);let i=new dz({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await dP(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];dr(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?dM(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!i?.length,a=new dU;a.updateFromIdToken(r);let o=new dz({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new dL(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!i?.length}),o}}const dq=new Map;function dj(e){var t,r;t="Expected a class definition",e instanceof Function||dn(t);let n=dq.get(e);return n?(r="Instance stored in cache mismatched with class",n instanceof e||dn(r)):(n=new e,dq.set(e,n)),n}class d${constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function dH(e,t,r){return`firebase:${e}:${t}:${r}`}d$.type="NONE";class dK{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:n,name:i}=this.auth;this.fullUserKey=dH(this.userKey,n.apiKey,i),this.fullPersistenceKey=dH("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await dS(this.auth,{idToken:e}).catch(()=>void 0);return t?dz._fromGetAccountInfoResponse(this.auth,t,e):null}return dz._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new dK(dj(d$),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||dj(d$),s=dH(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await dS(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await dz._fromGetAccountInfoResponse(e,r,t)}else n=dz._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch{}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new dK(i,e,r)}}function dG(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(dJ(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(dW(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(dZ(t))return"Blackberry";if(d0(t))return"Webos";if(dQ(t))return"Safari";if((t.includes("chrome/")||dY(t))&&!t.includes("edge/"))return"Chrome";if(dX(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(r?.length===2)return r[1]}return"Other"}function dW(e=tI()){return/firefox\//i.test(e)}function dQ(e=tI()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function dY(e=tI()){return/crios\//i.test(e)}function dJ(e=tI()){return/iemobile/i.test(e)}function dX(e=tI()){return/android/i.test(e)}function dZ(e=tI()){return/blackberry/i.test(e)}function d0(e=tI()){return/webos/i.test(e)}function d1(e=tI()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function d2(e=tI()){return d1(e)||dX(e)||d0(e)||dZ(e)||/windows phone/i.test(e)||dJ(e)}function d5(e,t=[]){let r;switch(e){case"Browser":r=dG(tI());break;case"Worker":r=`${dG(tI())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${rd}/${n}`}class d6{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function d3(e,t={}){return dm(e,"GET","/v2/passwordPolicy",dp(e,t))}class d4{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class d8{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new d7(this),this.idTokenSubscription=new d7(this),this.beforeStateQueue=new d6(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c6,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=dj(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await dK.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await dS(this,{idToken:e}),r=await dz._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(ru(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,n=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(r=s.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(dr(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await dP(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ru(this.app))return Promise.reject(de(this));let t=e?tF(e):null;return t&&dr(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&dr(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ru(this.app)?Promise.reject(de(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ru(this.app)?Promise.reject(de(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(dj(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new d4(await d3(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new tx("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await dV(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&dj(e)||this._popupRedirectResolver;dr(t,this,"argument-error"),this.redirectPersistenceManager=await dK.create(this,[dj(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(dr(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return dr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=d5(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(ru(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){c3.logLevel<=u.WARN&&c3.warn(`Auth (${rd}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class d7{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let r=new tO(e,void 0);return r.subscribe.bind(r)}(e=>this.observer=e)}get next(){return dr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let d9={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function fe(e){return`__${e}${Math.floor(1e6*Math.random())}`}class ft{constructor(){this.enterprise=new fr}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class fr{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const fn="NO_RECAPTCHA";class fi{constructor(e){this.type="recaptcha-enterprise",this.auth=tF(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{d_(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new dI(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;dE(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(fn)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ft().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&dE(window.grecaptcha))n(r,e,i);else{var s;if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=d9.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(s=t,d9.loadJS(s)).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function fs(e,t,r,n=!1,i=!1){let s,a=new fi(e);if(i)s=fn;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function fa(e,t,r,n,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await fs(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await fs(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await fs(e,t,r);return n(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await fs(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await fs(e,t,r,!1,!0);return n(e,i)}}async function fo(e){let t=tF(e),r=new dI(await d_(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new fi(t).verify()}function fl(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function fu(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class fh{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return dn("not implemented")}_getIdTokenResponse(e){return dn("not implemented")}_linkToIdToken(e,t){return dn("not implemented")}_getReauthenticationResolver(e){return dn("not implemented")}}async function fc(e,t){return dm(e,"POST","/v1/accounts:signUp",t)}async function fd(e,t){return dy(e,"POST","/v1/accounts:signInWithPassword",dp(e,t))}async function ff(e,t){return dy(e,"POST","/v1/accounts:signInWithEmailLink",dp(e,t))}async function fp(e,t){return dy(e,"POST","/v1/accounts:signInWithEmailLink",dp(e,t))}class fm extends fh{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new fm(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new fm(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return fa(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",fd,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ff(e,{email:this._email,oobCode:this._password});default:c8(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return fa(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",fc,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return fp(e,{idToken:t,email:this._email,oobCode:this._password});default:c8(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function fg(e,t){return dy(e,"POST","/v1/accounts:signInWithIdp",dp(e,t))}class fy extends fh{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new fy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):c8("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let i=new fy(t,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return fg(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,fg(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,fg(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=tD(t)}return e}}async function fv(e,t){return dm(e,"POST","/v1/accounts:sendVerificationCode",dp(e,t))}async function fb(e,t){return dy(e,"POST","/v1/accounts:signInWithPhoneNumber",dp(e,t))}async function fw(e,t){let r=await dy(e,"POST","/v1/accounts:signInWithPhoneNumber",dp(e,t));if(r.temporaryProof)throw dw(e,"account-exists-with-different-credential",r);return r}const fE={USER_NOT_FOUND:"user-not-found"};async function fI(e,t){return dy(e,"POST","/v1/accounts:signInWithPhoneNumber",dp(e,{...t,operation:"REAUTH"}),fE)}class f_ extends fh{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new f_({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new f_({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return fb(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return fw(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return fI(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new f_({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class fT{constructor(e){let t=tL(tP(e)),r=t.apiKey??null,n=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);dr(r&&n&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t=function(e){let t=tL(tP(e)).link,r=t?tL(tP(t)).deep_link_id:null,n=tL(tP(e)).deep_link_id;return(n?tL(tP(n)).link:null)||n||r||t||e}(e);try{return new fT(t)}catch{return null}}}class fS{constructor(){this.providerId=fS.PROVIDER_ID}static credential(e,t){return fm._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=fT.parseLink(t);return dr(r,"argument-error"),fm._fromEmailAndCode(e,r.code,r.tenantId)}}fS.PROVIDER_ID="password",fS.EMAIL_PASSWORD_SIGN_IN_METHOD="password",fS.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class fA{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class fC extends fA{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class fx extends fC{constructor(){super("facebook.com")}static credential(e){return fy._fromParams({providerId:fx.PROVIDER_ID,signInMethod:fx.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fx.credentialFromTaggedObject(e)}static credentialFromError(e){return fx.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fx.credential(e.oauthAccessToken)}catch{return null}}}fx.FACEBOOK_SIGN_IN_METHOD="facebook.com",fx.PROVIDER_ID="facebook.com";class fk extends fC{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return fy._fromParams({providerId:fk.PROVIDER_ID,signInMethod:fk.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return fk.credentialFromTaggedObject(e)}static credentialFromError(e){return fk.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return fk.credential(t,r)}catch{return null}}}fk.GOOGLE_SIGN_IN_METHOD="google.com",fk.PROVIDER_ID="google.com";class fN extends fC{constructor(){super("github.com")}static credential(e){return fy._fromParams({providerId:fN.PROVIDER_ID,signInMethod:fN.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fN.credentialFromTaggedObject(e)}static credentialFromError(e){return fN.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fN.credential(e.oauthAccessToken)}catch{return null}}}fN.GITHUB_SIGN_IN_METHOD="github.com",fN.PROVIDER_ID="github.com";class fR extends fC{constructor(){super("twitter.com")}static credential(e,t){return fy._fromParams({providerId:fR.PROVIDER_ID,signInMethod:fR.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return fR.credentialFromTaggedObject(e)}static credentialFromError(e){return fR.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return fR.credential(t,r)}catch{return null}}}async function fD(e,t){return dy(e,"POST","/v1/accounts:signUp",dp(e,t))}fR.TWITTER_SIGN_IN_METHOD="twitter.com",fR.PROVIDER_ID="twitter.com";class fL{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new fL({user:await dz._fromIdTokenResponse(e,r,n),providerId:fP(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new fL({user:e,providerId:fP(r),_tokenResponse:r,operationType:t})}}function fP(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function fO(e){if(ru(e.app))return Promise.reject(de(e));let t=tF(e);if(await t._initializationPromise,t.currentUser?.isAnonymous)return new fL({user:t.currentUser,providerId:null,operationType:"signIn"});let r=await fD(t,{returnSecureToken:!0}),n=await fL._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(n.user),n}class fM extends tC{constructor(e,t,r,n){super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,fM.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new fM(e,t,r,n)}}function fF(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw fM._fromErrorAndOperation(e,r,t,n);throw r})}async function fV(e,t,r=!1){let n=await dR(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return fL._forOperation(e,"link",n)}async function fU(e,t,r=!1){let{auth:n}=e;if(ru(n.app))return Promise.reject(de(n));let i="reauthenticate";try{let s=await dR(e,fF(n,i,t,e),r);dr(s.idToken,n,"internal-error");let a=dk(s.idToken);dr(a,n,"internal-error");let{sub:o}=a;return dr(e.uid===o,n,"user-mismatch"),fL._forOperation(e,i,s)}catch(e){throw e?.code==="auth/user-not-found"&&c8(n,"user-mismatch"),e}}async function fB(e,t,r=!1){if(ru(e.app))return Promise.reject(de(e));let n="signIn",i=await fF(e,n,t),s=await fL._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(s.user),s}async function fz(e,t){return fB(tF(e),t)}async function fq(e){let t=tF(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function fj(e,t,r){if(ru(e.app))return Promise.reject(de(e));let n=tF(e),i=fa(n,{returnSecureToken:!0,email:t,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",fD,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&fq(e),t}),a=await fL._fromIdTokenResponse(n,"signIn",s);return await n._updateCurrentUser(a.user),a}async function f$(e,t){return dm(e,"POST","/v1/accounts:update",t)}async function fH(e,{displayName:t,photoURL:r}){if(void 0===t&&void 0===r)return;let n=tF(e),i=await n.getIdToken(),s=await dR(n,f$(n.auth,{idToken:i,displayName:t,photoUrl:r,returnSecureToken:!0}));n.displayName=s.displayName||null,n.photoURL=s.photoUrl||null;let a=n.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=n.displayName,a.photoURL=n.photoURL),await n._updateTokensIfNecessary(s)}function fK(e,t,r,n){return tF(e).onAuthStateChanged(t,r,n)}function fG(e,t){return dm(e,"POST","/v2/accounts/mfaEnrollment:start",dp(e,t))}new WeakMap;const fW="__sak";class fQ{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(fW,"1"),this.storage.removeItem(fW),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class fY extends fQ{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=d2(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let r=e.key;t?this.detachListener():this.stopPolling();let n=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},i=this.storage.getItem(r);(function(){let e=tI();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0})()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}fY.type="LOCAL";class fJ extends fQ{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}fJ.type="SESSION";class fX{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new fX(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:n}=e.data,i=this.handlersMap[r];if(!i?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let s=Array.from(i).map(async t=>t(e.origin,n)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function fZ(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}fX.receivers=[];class f0{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let n,i,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=fZ("",20);s.port1.start();let u=setTimeout(()=>{o(Error("unsupported_event"))},r);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),n=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(u),clearTimeout(n),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function f1(){return window}function f2(){return void 0!==f1().WorkerGlobalScope&&"function"==typeof f1().importScripts}async function f5(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}const f6="firebaseLocalStorageDb",f3="firebaseLocalStorage",f4="fbase_key";class f8{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function f7(e,t){return e.transaction([f3],t?"readwrite":"readonly").objectStore(f3)}function f9(){let e=indexedDB.open(f6,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(f3,{keyPath:f4})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(f3)?t(r):(r.close(),await new f8(indexedDB.deleteDatabase(f6)).toPromise(),t(await f9()))})})}async function pe(e,t,r){return new f8(f7(e,!0).put({[f4]:t,value:r})).toPromise()}async function pt(e,t){let r=f7(e,!1).get(t),n=await new f8(r).toPromise();return void 0===n?null:n.value}function pr(e,t){return new f8(f7(e,!0).delete(t)).toPromise()}class pn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await f9()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return f2()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=fX._getInstance(f2()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await f5(),!this.activeServiceWorker)return;this.sender=new f0(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await f9();return await pe(e,fW,"1"),await pr(e,fW),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>pe(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>pt(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>pr(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new f8(f7(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:n,value:i}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function pi(e,t){return dm(e,"POST","/v2/accounts/mfaSignIn:start",dp(e,t))}pn.type="LOCAL",fe("rcb"),new dl(3e4,6e4);const ps="recaptcha";async function pa(e,t,r){if(!e._getRecaptchaConfig())try{await fo(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let n;if(n="string"==typeof t?{phoneNumber:t}:t,"session"in n){let t=n.session;if("phoneNumber"in n){dr("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===fn){dr(r?.type===ps,e,"argument-error");let n=await po(e,t,r);return fG(e,n)}return fG(e,t)},a=fa(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{dr("signin"===t.type,e,"internal-error");let i=n.multiFactorHint?.uid||n.multiFactorUid;dr(i,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===fn){dr(r?.type===ps,e,"argument-error");let n=await po(e,t,r);return pi(e,n)}return pi(e,t)},o=fa(e,s,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===fn){dr(r?.type===ps,e,"argument-error");let n=await po(e,t,r);return fv(e,n)}return fv(e,t)},s=fa(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{r?._reset()}}async function po(e,t,r){dr(r.type===ps,e,"argument-error");let n=await r.verify();dr("string"==typeof n,e,"argument-error");let i={...t};if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,r=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:n}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,r=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),i}}class pl{constructor(e){this.providerId=pl.PROVIDER_ID,this.auth=tF(e)}verifyPhoneNumber(e,t){return pa(this.auth,e,tF(t))}static credential(e,t){return f_._fromVerification(e,t)}static credentialFromResult(e){return pl.credentialFromTaggedObject(e)}static credentialFromError(e){return pl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?f_._fromTokenResponse(t,r):null}}pl.PROVIDER_ID="phone",pl.PHONE_SIGN_IN_METHOD="phone";class pu extends fh{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fg(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fg(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fg(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ph(e){return fB(e.auth,new pu(e),e.bypassAuthState)}function pc(e){let{auth:t,user:r}=e;return dr(r,t,"internal-error"),fU(r,new pu(e),e.bypassAuthState)}async function pd(e){let{auth:t,user:r}=e;return dr(r,t,"internal-error"),fV(r,new pu(e),e.bypassAuthState)}class pf{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ph;case"linkViaPopup":case"linkViaRedirect":return pd;case"reauthViaPopup":case"reauthViaRedirect":return pc;default:c8(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||dn(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||dn(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const pp=new dl(2e3,1e4);class pm extends pf{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,pm.currentPopupAction&&pm.currentPopupAction.cancel(),pm.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return dr(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||dn(t);let r=fZ();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(c7(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(c7(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,pm.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(c7(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,pp.get())};e()}}pm.currentPopupAction=null;const pg=new Map;class py extends pf{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=pg.get(this.auth._key());if(!e){try{let t=await pv(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}pg.set(this.auth._key(),e)}return this.bypassAuthState||pg.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function pv(e,t){var r;let n=dH("pendingRedirect",(r=t).config.apiKey,r.name),i=dj(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(n)==="true";return await i._remove(n),s}function pb(e,t){pg.set(e._key(),t)}async function pw(e,t,r=!1){if(ru(e.app))return Promise.reject(de(e));let n=tF(e),i=t?dj(t):(dr(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver),s=new py(n,i,r),a=await s.execute();return a&&!r&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}class pE{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return p_(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!p_(e)){let r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(c7(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(pI(e))}saveEventToCache(e){this.cachedEventUids.add(pI(e)),this.lastProcessedEventTime=Date.now()}}function pI(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function p_({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function pT(e,t={}){return dm(e,"GET","/v1/projects",t)}const pS=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,pA=/^https?/;async function pC(e){if(e.config.emulator)return;let{authorizedDomains:t}=await pT(e);for(let e of t)try{if(function(e){let t=ds(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&i.hostname===n}if(!pA.test(r))return!1;if(pS.test(e))return n===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}(e))return}catch{}c8(e,"unauthorized-domain")}const px=new dl(3e4,6e4);function pk(){let e=f1().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let pN=null;const pR=new dl(5e3,15e3),pD={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},pL=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function pP(e){let t=await (pN=pN||new Promise((t,r)=>{function n(){pk(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{pk(),r(c7(e,"network-request-failed"))},timeout:px.get()})}if(f1().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(f1().gapi?.load)n();else{var i;let t=fe("iframefcb");return f1()[t]=()=>{gapi.load?n():r(c7(e,"network-request-failed"))},(i=`${d9.gapiScript}?onload=${t}`,d9.loadJS(i)).catch(e=>r(e))}}).catch(e=>{throw pN=null,e})),r=f1().gapi;return dr(r,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;dr(t.authDomain,e,"auth-domain-config-required");let r=t.emulator?du(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:rd},i=pL.get(e.config.apiHost);i&&(n.eid=i);let s=e._getFrameworks();return s.length&&(n.fw=s.join(",")),`${r}?${tD(n).slice(1)}`}(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:pD,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});let i=c7(e,"network-request-failed"),s=f1().setTimeout(()=>{n(i)},pR.get());function a(){f1().clearTimeout(s),r(t)}t.ping(a).then(a,()=>{n(i)})}))}const pO={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class pM{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const pF=encodeURIComponent("fac");async function pV(e,t,r,n,i,s){dr(e.config.authDomain,e,"auth-domain-config-required"),dr(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:rd,eventId:i};if(t instanceof fA)for(let[r,n]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[r]=n;if(t instanceof fC){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${pF}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?du(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${tD(a).slice(1)}${l}`}const pU="webStorageSupport",pB=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=fJ,this._completeRedirectFn=pw,this._overrideRedirectResult=pb}async _openPopup(e,t,r,n){var i,s;i=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",i||dn(s);let a=await pV(e,t,r,ds(),n);return function(e,t,r,n=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString(),o="",l={...pO,width:n.toString(),height:i.toString(),top:s,left:a},u=tI().toLowerCase();r&&(o=dY(u)?"_blank":r),dW(u)&&(t=t||"http://localhost",l.scrollbars="yes");let h=Object.entries(l).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=tI()){return d1(e)&&!!window.navigator?.standalone}(u)&&"_self"!==o)return function(e,t){let r=document.createElement("a");r.href=e,r.target=t;let n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}(t||"",o),new pM(null);let c=window.open(t||"",o,h);dr(c,e,"popup-blocked");try{c.focus()}catch(e){}return new pM(c)}(e,a,fZ())}async _openRedirect(e,t,r,n){var i;return await this._originValidation(e),i=await pV(e,t,r,ds(),n),f1().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",n||dn(r),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await pP(e),r=new pE(e);return t.register("authEvent",t=>(dr(t?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(pU,{type:pU},r=>{let n=r?.[0]?.[pU];void 0!==n&&t(!!n),c8(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=pC(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return d2()||dQ()||d1()}};class pz{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return dn("unexpected MultiFactorSessionType")}}}class pq extends pz{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new pq(e)}_finalizeEnroll(e,t,r){return dm(e,"POST","/v2/accounts/mfaEnrollment:finalize",dp(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return dm(e,"POST","/v2/accounts/mfaSignIn:finalize",dp(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class pj extends pz{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new pj(t,void 0,e)}static _fromEnrollmentId(e,t){return new pj(t,e)}async _finalizeEnroll(e,t,r){return dr(void 0!==this.secret,e,"argument-error"),dm(e,"POST","/v2/accounts/mfaEnrollment:finalize",dp(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}))}async _finalizeSignIn(e,t){dr(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let r={verificationCode:this.otp};return dm(e,"POST","/v2/accounts/mfaSignIn:finalize",dp(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r}))}}class p${constructor(e,t,r,n,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new p$(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){let r=!1;return(pH(e)||pH(t))&&(r=!0),r&&(pH(e)&&(e=this.auth.currentUser?.email||"unknownuser"),pH(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function pH(e){return void 0===e||e?.length===0}var pK="@firebase/auth",pG="1.11.1";class pW{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){dr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const pQ=tm("authIdTokenMaxAge")||300;let pY=null;const pJ=e=>async t=>{let r=t&&await t.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>pQ)return;let i=r?.token;pY!==i&&(pY=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};d9={loadJS:e=>new Promise((t,r)=>{let n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{let t=c7("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},o="Browser",ro(new tV("auth",(e,{options:t})=>{let r=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:a}=r.options;dr(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});let l=new d8(r,n,i,{apiKey:s,authDomain:a,clientPlatform:o,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:d5(o)}),u=t?.persistence||[],h=(Array.isArray(u)?u:[u]).map(dj);return t?.errorMap&&l._updateErrorMap(t.errorMap),l._initializeWithPersistence(h,t?.popupRedirectResolver),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ro(new tV("auth-internal",e=>new pW(tF(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),rm(pK,pG,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(o)),rm(pK,pG,"esm2020");const pX={apiKey:"YOUR_API_KEY",authDomain:"YOUR_AUTH_DOMAIN",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_STORAGE_BUCKET",messagingSenderId:"YOUR_MESSAGING_SENDER_ID",appId:"YOUR_APP_ID"},pZ=()=>"YOUR_API_KEY"!==pX.apiKey&&"YOUR_PROJECT_ID"!==pX.projectId;let p0=null,p1=null,p2=null;if(pZ())try{p0=rf(pX),p1=function(e=rp()){let t=rl(e,"auth");if(t.isInitialized())return t.getImmediate();let r=function(e,t){let r=rl(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(tN(r.getOptions(),t??{}))return e;c8(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:pB,persistence:[pn,fY,fJ]}),n=tm("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(n,location.origin);if(location.origin===e.origin){let t=pJ(e.toString());tF(r).beforeAuthStateChanged(t,()=>t(r.currentUser)),tF(r).onIdTokenChanged(e=>t(e),void 0,void 0)}}let i=td("auth");return i&&function(e,t,r){let n=tF(e);dr(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=fl(t),{host:s,port:a}=function(e){let t=fl(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:fu(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:fu(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${i}//${s}${o}/`},u=Object.freeze({host:s,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator){dr(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),dr(tN(l,n.config.emulator)&&tN(u,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=l,n.emulatorConfig=u,n.settings.appVerificationDisabledForTesting=!0,ty(s)?(tv(`${i}//${s}${o}`),tE("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(r,`http://${i}`),r}(p0),p2=function(e,t){let r=rl("object"==typeof e?e:rp(),"firestore").getImmediate({identifier:"string"==typeof e?e:sC});if(!r._initialized){let e=tf("firestore");e&&function(e,t,r,n={}){e=nV(e,h8);let i=ty(t),s=e._getSettings(),a={...s,emulatorOptions:e._getEmulatorOptions()},o=`${t}:${r}`;i&&(tv(`https://${o}`),tE("Firestore",!0)),s.host!==h3&&s.host!==o&&na("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:o,ssl:i,emulatorOptions:n};if(!tN(l,a)&&(e._setSettings(l),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=ne.MOCK_USER;else{t=function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r=t||"demo-project",n=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${r}`,aud:r,iat:n,exp:n+3600,auth_time:n,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[ts(JSON.stringify({alg:"none",type:"JWT"})),ts(JSON.stringify(s)),""].join(".")}(n.mockUserToken,e._app?.options.projectId);let i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new nd(nc.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new ne(i)}e._authCredentials=new ng(new np(t,r))}}(r,...e)}return r}(p0)}catch(e){console.error("Error initializing Firebase:",e)}let p5=null,p6=[];async function p3(){if(!pZ()||!p1)return{error:Error("Firebase not configured"),user:null};try{let e=await fO(p1);return p5=e.user,eL.info("Signed in anonymously:",e.user.uid),{error:null,user:e.user}}catch(e){return eL.error("Error signing in anonymously:",e),{error:e,user:null}}}async function p4(e,t,r=""){if(!pZ()||!p1)return{error:Error("Firebase not configured"),user:null};try{let n=await fj(p1,e,t);return r&&await fH(n.user,{displayName:r}),p5=n.user,eL.info("Account created:",n.user.uid),{error:null,user:n.user}}catch(e){return eL.error("Error creating account:",e),{error:e,user:null}}}async function p8(e,t){if(!pZ()||!p1)return{error:Error("Firebase not configured"),user:null};try{var r;let n=await (r=p1,ru(r.app)?Promise.reject(de(r)):fz(tF(r),fS.credential(e,t)).catch(async e=>{throw"auth/password-does-not-meet-requirements"===e.code&&fq(r),e}));return p5=n.user,eL.info("Signed in with email:",n.user.uid),{error:null,user:n.user}}catch(e){return eL.error("Error signing in with email:",e),{error:e,user:null}}}async function p7(){if(!pZ()||!p1)return{error:Error("Firebase not configured")};try{var e;return await (e=p1,tF(e).signOut()),p5=null,eL.info("Signed out"),{error:null}}catch(e){return eL.error("Error signing out:",e),{error:e}}}function p9(){return null!==p5}function me(){return p5?.uid||null}const mt="scans";async function mr(){if(!pZ()||!p2)return eL.warn("Firestore not configured. Running in local-only mode."),{error:null};try{return await function(e,t){na("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=e._freezeSettings();return function(e,t,r){if((e=nV(e,ca))._firestoreClient||e._terminated)throw new nd(nc.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new nd(nc.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:r},cl(e)}(e,hW.provider,{build:e=>new hG(e,r.cacheSizeBytes,void 0)}),Promise.resolve()}(p2),eL.info("Firestore offline persistence enabled"),{error:null}}catch(e){return"failed-precondition"===e.code?eL.warn("Firestore persistence failed: Multiple tabs open"):"unimplemented"===e.code?eL.warn("Firestore persistence not supported in this browser"):eL.error("Error enabling Firestore persistence:",e),{error:e}}}async function mn(e){let t=me();if(!pZ()||!p2||!t){eL.info("Saving scan locally (Firebase not available or user not authenticated)");try{let[,t=[]]=await eN(),r={value:e.value,addedAt:Date.now(),expiresAt:Date.now()+2592e6,notified:!1,preNotified:!1,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",metadata:e.metadata||{}};return await eR([...t,r]),{error:null,scanId:null}}catch(e){return eL.error("Error saving scan locally:",e),{error:e,scanId:null}}}try{let r={userId:t,value:e.value,format:e.format||"",title:e.title||"",brand:e.brand||"",description:e.description||"",metadata:e.metadata||{},scannedAt:nz.now(),createdAt:nz.now(),updatedAt:nz.now()},n=await function(e,t){let r=nV(e.firestore,ca),n=cr(e),i=cG(e.converter,t);return c0(r,[cE(cw(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,a2.exists(!1))]).then(()=>n)}(ct(p2,mt),r);eL.info("Scan saved to Firestore:",n.id);try{let[,t=[]]=await eN(),r={value:e.value,addedAt:Date.now(),expiresAt:Date.now()+2592e6,notified:!1,preNotified:!1,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",firestoreId:n.id};await eR([...t,r])}catch(e){eL.warn("Error saving to local storage:",e)}return{error:null,scanId:n.id}}catch(t){eL.error("Error saving scan to Firestore:",t);try{let[,t=[]]=await eN(),r={value:e.value,addedAt:Date.now(),expiresAt:Date.now()+2592e6,notified:!1,preNotified:!1,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",pendingSync:!0};await eR([...t,r]),eL.info("Scan saved locally, will sync when online")}catch(e){eL.error("Error saving to local storage:",e)}return{error:t,scanId:null}}}async function mi(e=100){let t=me();if(!pZ()||!p2||!t){eL.info("Getting scans from local storage (Firebase not available or user not authenticated)");try{let[e,t=[]]=await eN();if(e)return{error:e,scans:[]};let r=t.map(e=>({id:e.firestoreId||null,value:"string"==typeof e?e:e.value,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",scannedAt:e.addedAt?new Date(e.addedAt):new Date,metadata:e.metadata||{}}));return{error:null,scans:r}}catch(e){return eL.error("Error getting scans from local storage:",e),{error:e,scans:[]}}}try{let r=cF(ct(p2,mt),cU("userId","==",t),function(e,t="asc"){let r=cP("orderBy",e);return cz._create(r,t)}("scannedAt","desc"),(function(e,t){if(t<=0)throw new nd(nc.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),cq._create("limit",e,"F"))),n=await cZ(r),i=[];return n.forEach(e=>{i.push({id:e.id,...e.data(),scannedAt:e.data().scannedAt?.toDate()||new Date})}),eL.info(`Retrieved ${i.length} scans from Firestore`),{error:null,scans:i}}catch(e){eL.error("Error getting scans from Firestore:",e);try{let[e,t=[]]=await eN();if(!e){let e=t.map(e=>({id:e.firestoreId||null,value:"string"==typeof e?e:e.value,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",scannedAt:e.addedAt?new Date(e.addedAt):new Date,metadata:e.metadata||{}}));return eL.info("Returning scans from local storage (Firestore unavailable)"),{error:null,scans:e}}}catch(e){eL.error("Error getting scans from local storage:",e)}return{error:e,scans:[]}}}async function ms(e){let t=me();if(!pZ()||!p2||!t||!e)return eL.info("Deleting scan from local storage only"),{error:null};try{var r;return await (r=cr(p2,mt,e),c0(nV(r.firestore,ca),[new on(r._key,a2.none())])),eL.info("Scan deleted from Firestore:",e),{error:null}}catch(e){return eL.error("Error deleting scan from Firestore:",e),{error:e}}}async function ma(){let e=me();if(!pZ()||!p2||!e){eL.info("Deleting all scans from local storage only");try{return await eR([]),{error:null,deletedCount:0}}catch(e){return{error:e,deletedCount:0}}}try{var t;let r=cF(ct(p2,mt),cU("userId","==",e)),n=await cZ(r),i=(t=p2,co(t=nV(t,ca)),new c1(t,e=>c0(t,e))),s=0;n.forEach(e=>{i.delete(e.ref),s++}),await i.commit(),eL.info(`Deleted ${s} scans from Firestore`);try{await eR([])}catch(e){eL.warn("Error clearing local storage:",e)}return{error:null,deletedCount:s}}catch(e){return eL.error("Error deleting all scans from Firestore:",e),{error:e,deletedCount:0}}}async function mo(){let e=me();if(!pZ()||!p2||!e)return{error:Error("Firebase not configured or user not authenticated"),syncedCount:0};try{let[e,t=[]]=await eN();if(e)return{error:e,syncedCount:0};let r=t.filter(e=>!0===e.pendingSync);if(0===r.length)return{error:null,syncedCount:0};let n=0,i=[...t];for(let e of r)try{let t=await mn({value:e.value,title:e.title,brand:e.brand,description:e.description,format:e.format,metadata:e.metadata});if(!t.error&&t.scanId){let r=i.findIndex(t=>t===e);-1!==r&&(i[r]={...i[r],firestoreId:t.scanId,pendingSync:!1}),n++}}catch(e){eL.error("Error syncing individual scan:",e)}return await eR(i),eL.info(`Synced ${n} pending scans to Firestore`),{error:null,syncedCount:n}}catch(e){return eL.error("Error syncing pending scans:",e),{error:e,syncedCount:0}}}const ml=`
  :host {
    --empty-history-button-color: #ffffff;

    display: block;
    box-sizing: border-box;
  }

  @media (prefers-color-scheme: dark) {
    :host {
      --empty-history-button-color: #000000;
    }
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  :host([hidden]),
  [hidden],
  ::slotted([hidden]) {
    display: none !important;
  }

  ul {
    max-width: 36.25rem;
    margin: 0;
    padding: 0;
    list-style: none;
  }

  ul li {
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    padding: 0.5rem 0.75rem;
    border-bottom: 1px solid var(--border);
    color: var(--text-main);
  }

  ul li:last-of-type {
    border-bottom: none;
  }

  ul li a {
    color: var(--links);
  }

  ul li a,
  ul li span {
    word-break: break-all;
  }

  @supports (-webkit-line-clamp: 1) and (display: -webkit-box) and (-webkit-box-orient: vertical) {
    ul li a,
    ul li span {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
    }
  }

  .actions {
    display: flex;
    gap: 0.25rem;
  }

  .actions button,
  .actions custom-clipboard-copy::part(button) {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    margin: 0;
    border: 0;
    border-radius: var(--border-radius);
    background-color: transparent !important;
    line-height: 1;
    font-size: 1rem;
    color: var(--text-main);
    cursor: pointer;
  }

  .actions custom-clipboard-copy::part(button--success) {
    color: var(--success-color);
  }

  .actions custom-clipboard-copy::part(button--error) {
    color: var(--danger-color);
  }

  .actions .details-action {
    color: var(--info-color);
  }

  .actions .delete-action {
    color: var(--danger-color);
    margin-right: -0.5rem;
  }

  footer {
    position: sticky;
    bottom: 0;
    padding: 0.75rem;
    background-color: var(--dialog-background);
  }

  footer > button {
    width: 100%;
    padding: 0.625rem;
    border: 0;
    border-radius: var(--border-radius);
    background-color: var(--danger-color);
    color: var(--empty-history-button-color);
    font-size: 1rem;
    cursor: pointer;
  }

  ul:empty + footer > button {
    display: none;
  }

  ul:not(:empty) + footer > div {
    display: none;
  }

  /* Product info styles */
  ul li strong {
    font-weight: 600;
    color: var(--text-main);
  }

  ul li small {
    font-size: 0.85em;
    opacity: 0.7;
  }

  .history-item-clickable {
    cursor: pointer;
  }

  .history-item-clickable:hover {
    opacity: 0.8;
    text-decoration: underline;
  }

  .history-item-clickable strong {
    color: var(--links);
  }
`,mu=document.createElement("template");mu.innerHTML=`
  <style>${ml}</style>
  <ul id="historyList"></ul>
  <footer>
    <div>There are no saved items in history.</div>
    <div style="display:flex;gap:0.5rem;">
      <button type="button" id="emptyHistoryBtn">Empty history</button>
    </div>
  </footer>
`;class mh extends HTMLElement{#F=null;#V=null;#U=3e3;static #B=2592e6;static #z(){try{let e=new URLSearchParams(window.location.search),t=e.get("testExpireSeconds"),r=t?Number(t):NaN;if(!Number.isNaN(r)&&r>0)return 1e3*r;let n=e.get("testMode");if("1"===n||"true"===String(n).toLowerCase())return 1e4;if("undefined"!=typeof window)try{let e=window.location.hostname,t=window.location.protocol;if("localhost"===e||"127.0.0.1"===e||"::1"===e||"file:"===t)return 1e4}catch(e){}}catch(e){}return mh.#B}constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(mu.content.cloneNode(!0))}async connectedCallback(){this.#F=this.shadowRoot?.getElementById("historyList"),this.#V=this.shadowRoot?.getElementById("emptyHistoryBtn");let[,e=[]]=await eN(),t=[],r=!1;try{if("function"==typeof pZ&&pZ()&&p9()){r=!0;let{error:n,scans:i}=await mi();if(!n&&i){let r=i.map(e=>({value:e.value||"",addedAt:e.scannedAt?e.scannedAt.getTime():Date.now(),expiresAt:e.scannedAt?e.scannedAt.getTime()+mh.#z():Date.now()+mh.#z(),notified:!1,preNotified:!1,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",firestoreId:e.id||null}));eL.info(`Loaded ${r.length} scans from Firestore`);let n=(e||[]).map(e=>{if(!e)return null;if("string"==typeof e){let t=Date.now();return{value:e,addedAt:t,expiresAt:t+mh.#z(),notified:!1,preNotified:!1}}return{value:e.value??e?.barcode??"",addedAt:e.addedAt??Date.now(),expiresAt:e.expiresAt??(e.addedAt?e.addedAt+mh.#z():Date.now()+mh.#z()),notified:!!e.notified,preNotified:!!e.preNotified,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",firestoreId:e.firestoreId||null}}).filter(Boolean),s=new Map;r.forEach(e=>{s.set(e.value,e)}),n.forEach(e=>{s.has(e.value)||s.set(e.value,e)}),t=Array.from(s.values())}}}catch(e){eL.error("Firebase not available or error loading from Firestore:",e),r=!1}if(!r||0===t.length){let r=(e||[]).map(e=>{if(!e)return null;if("string"==typeof e){let t=Date.now();return{value:e,addedAt:t,expiresAt:t+mh.#z(),notified:!1,preNotified:!1}}return{value:e.value??e?.barcode??"",addedAt:e.addedAt??Date.now(),expiresAt:e.expiresAt??(e.addedAt?e.addedAt+mh.#z():Date.now()+mh.#z()),notified:!!e.notified,preNotified:!!e.preNotified,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",firestoreId:e.firestoreId||null}}).filter(Boolean);t=r,await eR(r)}this.#q(t||[]);try{let e=new URLSearchParams(window.location.search),t=e.get("testExpireSeconds"),r=e.get("testMode");if(t||r){let e=t?String(Number(t)):"10";try{eH(`Test expiry active: items expire in ${e} second${"1"===e?"":"s"}`,{variant:"warning"})}catch(e){}}}catch(e){}this.#F?.addEventListener("click",this.#j),this.#V?.addEventListener("click",this.#$),this.#H()}disconnectedCallback(){this.#F?.removeEventListener("click",this.#j),this.#V?.removeEventListener("click",this.#$),this.#K()}async add(e){if(!e)return;let t={type:"add",message:"Error adding barcode to history"},[r,n=[]]=await eN();if(r||!Array.isArray(n))return this.#G("bs-history-error",t),r;let i=(n||[]).map(e=>"string"==typeof e?{value:e,addedAt:Date.now(),expiresAt:Date.now()+mh.#z(),notified:!1,preNotified:!1}:{value:e.value??e.barcode??"",addedAt:e.addedAt??Date.now(),expiresAt:e.expiresAt??(e.addedAt?e.addedAt+mh.#z():Date.now()+mh.#z()),notified:!!e.notified,preNotified:!!e.preNotified}),s="string"==typeof e?e:e.value,a=i.find(e=>e.value===s);if(a){try{let e=mh.#z();if(e<mh.#B){a.expiresAt=Date.now()+e,a.notified=!1,a.preNotified=!1;let[t]=await eR(i);if(!t){let e=this.#F?.querySelector(`li[data-value="${s}"]`);if(e){let t=e.querySelector(".history-countdown");t&&(t.dataset.expiresAt=String(a.expiresAt),t.textContent=this.#W(a.expiresAt-Date.now()))}this.#G("bs-history-success",{type:"add",message:"Barcode expiry refreshed for testing"}),this.#Q()}return null}}catch(e){}return}let o=Date.now(),l={value:s,addedAt:o,expiresAt:o+mh.#z(),notified:!1,preNotified:!1},u=[...i,l],[h]=await eR(u);return h?(eL.error("Error setting history",h),this.#G("bs-history-error",t),h):(this.#F?.insertBefore(this.#Y(l),this.#F.firstElementChild),this.#G("bs-history-success",{type:"add",message:"Barcode added to history"}),this.#Q(),null)}async remove(e){if(!e)return;let t={type:"remove",message:"Error removing barcode from history"};try{if("function"==typeof pZ&&pZ()&&p9()){let t=this.#F?.querySelector(`li[data-value="${e}"]`),r=t?.dataset.firestoreId;if(r&&1){let{error:e}=await ms(r);e&&eL.error("Error deleting scan from Firestore:",e)}}}catch(e){eL.error("Firebase not available:",e)}let[r,n=[]]=await eN();if(r||!Array.isArray(n))return this.#G("bs-history-error",t),r;let i=(n||[]).filter(t=>"string"==typeof t?t!==e:t.value!==e),[s]=await eR(i);if(s)return eL.error("Error setting history",s),this.#G("bs-history-error",t),s;let a=this.#F?.querySelector(`li[data-value="${e}"]`);return a?.remove(),this.#G("bs-history-success",{type:"remove",message:"Barcode removed from history"}),this.#Q(),null}async empty(){try{if("function"==typeof pZ&&pZ()&&p9()&&1){let{error:e,deletedCount:t}=await ma();e?eL.error("Error deleting all scans from Firestore:",e):eL.info(`Deleted ${t} scans from Firestore`)}}catch(e){eL.error("Firebase not available:",e)}let[e]=await eR([]);return e?(eL.error("Error setting history",e),this.#G("bs-history-error",{type:"empty",message:"Error emptying history"}),e):(this.#F?.replaceChildren(),this.#G("bs-history-success",{type:"empty",message:"History emptied successfully"}),this.#Q(),null)}async loadHistory(){let[,e=[]]=await eN(),t=[],r=!1;try{if("function"==typeof pZ&&pZ()&&p9()){r=!0;let{error:n,scans:i}=await mi();if(!n&&i){let r=i.map(e=>({value:e.value||"",addedAt:e.scannedAt?e.scannedAt.getTime():Date.now(),expiresAt:e.scannedAt?e.scannedAt.getTime()+mh.#z():Date.now()+mh.#z(),notified:!1,preNotified:!1,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",firestoreId:e.id||null})),n=(e||[]).map(e=>{if(!e)return null;if("string"==typeof e){let t=Date.now();return{value:e,addedAt:t,expiresAt:t+mh.#z(),notified:!1,preNotified:!1}}return{value:e.value??e?.barcode??"",addedAt:e.addedAt??Date.now(),expiresAt:e.expiresAt??(e.addedAt?e.addedAt+mh.#z():Date.now()+mh.#z()),notified:!!e.notified,preNotified:!!e.preNotified,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",firestoreId:e.firestoreId||null}}).filter(Boolean),s=new Map;r.forEach(e=>{s.set(e.value,e)}),n.forEach(e=>{s.has(e.value)||s.set(e.value,e)}),t=Array.from(s.values())}}}catch(e){eL.error("Firebase not available or error loading:",e),r=!1}if(!r||0===t.length){let r=(e||[]).map(e=>{if(!e)return null;if("string"==typeof e){let t=Date.now();return{value:e,addedAt:t,expiresAt:t+mh.#z(),notified:!1,preNotified:!1}}return{value:e.value??e?.barcode??"",addedAt:e.addedAt??Date.now(),expiresAt:e.expiresAt??(e.addedAt?e.addedAt+mh.#z():Date.now()+mh.#z()),notified:!!e.notified,preNotified:!!e.preNotified,title:e.title||"",brand:e.brand||"",description:e.description||"",format:e.format||"",firestoreId:e.firestoreId||null}}).filter(Boolean);t=r,await eR(r)}this.#q(t||[])}#q(e){if(!this.#F)return;this.#F.replaceChildren();let t=document.createDocumentFragment();[...e].reverse().forEach(e=>t.appendChild(this.#Y(e))),this.#F.appendChild(t)}#Y(e){let t,r=document.createElement("li"),n="string"==typeof e?e:e.value||"",i=e?.expiresAt||Date.now()+mh.#z(),s=e?.firestoreId||null,a=e?.title||"",o=e?.brand||"",l=e?.description||"";r.setAttribute("data-value",n),s&&r.setAttribute("data-firestore-id",s),a&&r.setAttribute("data-title",a),o&&r.setAttribute("data-brand",o),l&&r.setAttribute("data-description",l);try{new URL(n),(t=document.createElement("a")).href=n,t.setAttribute("target","_blank"),t.setAttribute("rel","noreferrer noopener")}catch{(t=document.createElement("span")).className="history-item-clickable",t.setAttribute("data-action","view-details")}a?t.innerHTML=`<strong>${a}</strong><br><small>${n}</small>`:t.textContent=n;let u=document.createElement("span");u.className="history-countdown",u.setAttribute("aria-live","polite"),u.dataset.expiresAt=String(i),u.textContent=this.#W(i-Date.now()),r.appendChild(t),r.appendChild(u);let h=document.createElement("div");h.className="actions";let c=document.createElement("custom-clipboard-copy"),d=c.shadowRoot?.querySelector("button");c.setAttribute("only-icon",""),c.setAttribute("value",n),d?.setAttribute("aria-label",`Copy to clipboard ${n}`),h.appendChild(c);let f=document.createElement("button");return f.type="button",f.className="delete-action",f.setAttribute("data-action","delete"),f.setAttribute("aria-label",`Remove from history ${n}`),f.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="1.125em" height="1.125em" fill="currentColor" viewBox="0 0 16 16">
        <path d="M11 1.5v1h3.5a.5.5 0 0 1 0 1h-.538l-.853 10.66A2 2 0 0 1 11.115 16h-6.23a2 2 0 0 1-1.994-1.84L2.038 3.5H1.5a.5.5 0 0 1 0-1H5v-1A1.5 1.5 0 0 1 6.5 0h3A1.5 1.5 0 0 1 11 1.5Zm-5 0v1h4v-1a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5ZM4.5 5.029l.5 8.5a.5.5 0 1 0 .998-.06l-.5-8.5a.5.5 0 1 0-.998.06Zm6.53-.528a.5.5 0 0 0-.528.47l-.5 8.5a.5.5 0 0 0 .998.058l.5-8.5a.5.5 0 0 0-.47-.528ZM8 4.5a.5.5 0 0 0-.5.5v8.5a.5.5 0 0 0 1 0V5a.5.5 0 0 0-.5-.5Z"/>
      </svg>
    `,h.appendChild(f),r.appendChild(h),r}#j=async e=>{let t=e.target;if(t.closest('[data-action="delete"]')){let e=t.closest("li").dataset.value;window.confirm(`Delete history item ${e}?`)&&this.remove(e);return}if(t.closest('[data-action="view-details"]')){let e=t.closest("li"),r=e.dataset.value,n=e.dataset.title||"",i=e.dataset.brand||"",s=e.dataset.description||"",a=[];n&&a.push(`\u{1F4E6} Product: ${n}`),i&&a.push(`\u{1F3F7}\u{FE0F} Brand: ${i}`),s&&a.push(`\u{1F4DD} Description: ${s}`),a.push(`\u{1F522} Barcode: ${r}`),n||i||s?alert(a.join("\n\n")):alert(`Barcode: ${r}

(No product information available)`);return}};#J=null;#H(){this.#J||(this.#J=setInterval(()=>this.#Q(),1e3),this.#Q())}#K(){this.#J&&(clearInterval(this.#J),this.#J=null)}async #Q(){try{let[,e=[]]=await eN(),t=(e||[]).map(e=>"string"==typeof e?{value:e,addedAt:Date.now(),expiresAt:Date.now()+mh.#z(),notified:!1,preNotified:!1}:{value:e.value??e.barcode??"",addedAt:e.addedAt??Date.now(),expiresAt:e.expiresAt??(e.addedAt?e.addedAt+mh.#z():Date.now()+mh.#z()),notified:!!e.notified,preNotified:!!e.preNotified}),r=Date.now();(this.shadowRoot?.querySelectorAll(".history-countdown")||[]).forEach(e=>{let t=Number(e.dataset.expiresAt)||r;e.textContent=this.#W(t-r)});let n=!1,i=t.filter(e=>e&&(e.expiresAt||0)-r>0&&(e.expiresAt||0)-r<=this.#U&&!e.preNotified).length;for(let e of t){if(!e)continue;let t=(e.expiresAt||0)-r;t>0&&t<=this.#U&&!e.preNotified&&(this.#X(e,t,i),e.preNotified=!0,n=!0),t<=0&&!e.notified&&(this.#Z(e),e.notified=!0,n=!0)}n&&await eR(t)}catch(e){}}async #X(e,t,r=1){try{let n=`${e.value} will expire in ${this.#W(t)}.`;Number.isFinite(r)&&r>0&&(1===r?n+=" You have one more item that will expire soon; the next notification will be when it expires.":r>1&&(n+=` You have ${r} items that will expire soon.`));try{eH(n,{variant:"warning"})}catch(e){}"Notification"in window&&("default"===Notification.permission&&await Notification.requestPermission(),"granted"===Notification.permission&&new Notification("Item will expire soon",{body:n}))}catch(e){}}#W(e){if(e<=0)return"Expired";let t=Math.floor(e/1e3),r=Math.floor(t/86400);if(r>0)return`${r} day${1===r?"":"s"} left`;let n=Math.floor(t%86400/3600);if(n>0)return`${n} hour${1===n?"":"s"} left`;let i=Math.floor(t%3600/60);return i>0?`${i} min left`:"Less than a minute"}async #Z(e){try{let t=`${e.value} may have reached its expiry date.`;try{eH(t,{variant:"warning"})}catch(e){}"Notification"in window&&("default"===Notification.permission&&await Notification.requestPermission(),"granted"===Notification.permission&&new Notification("Item may have expired",{body:t}))}catch(e){}}#$=async()=>{window.confirm("Empty history? This action cannot be undone.")&&this.empty()};#G(e,t=null){let r=new CustomEvent(e,{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(r)}static defineCustomElement(e="bs-history"){"undefined"==typeof window||window.customElements.get(e)||window.customElements.define(e,mh)}}mh.defineCustomElement();const mc=`
  :host {
    display: block;
    box-sizing: border-box;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  :host([hidden]),
  [hidden],
  ::slotted([hidden]) {
    display: none !important;
  }

  .auth-container {
    padding: 1rem;
  }

  .auth-status {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background-color: var(--background-secondary, #f5f5f5);
    border-radius: var(--border-radius, 0.25rem);
    margin-bottom: 1rem;
  }

  .auth-status__icon {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    background-color: var(--primary-color, #0066cc);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
  }

  .auth-status__info {
    flex: 1;
  }

  .auth-status__email {
    font-weight: 600;
    color: var(--text-main);
  }

  .auth-status__type {
    font-size: 0.875rem;
    color: var(--text-muted);
  }

  .auth-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--border);
  }

  .auth-tab {
    padding: 0.5rem 1rem;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    cursor: pointer;
    color: var(--text-muted);
    font-size: 0.9rem;
  }

  .auth-tab.active {
    color: var(--text-main);
    border-bottom-color: var(--primary-color);
  }

  .auth-form {
    display: none;
  }

  .auth-form.active {
    display: block;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  .form-group label {
    display: block;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-main);
  }

  .form-group input {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid var(--border);
    border-radius: var(--border-radius);
    font-size: 1rem;
    font-family: inherit;
  }

  .form-group input:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  .btn {
    width: 100%;
    padding: 0.625rem;
    border: 0;
    border-radius: var(--border-radius);
    background-color: var(--primary-color, #0066cc);
    color: white;
    font-size: 1rem;
    cursor: pointer;
    font-weight: 500;
  }

  .btn:hover {
    opacity: 0.9;
  }

  .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .btn-secondary {
    background-color: var(--secondary-color, #6c757d);
  }

  .btn-danger {
    background-color: var(--danger-color, #dc3545);
  }

  .error-message {
    padding: 0.5rem;
    margin-bottom: 1rem;
    background-color: #fee;
    border: 1px solid #fcc;
    border-radius: var(--border-radius);
    color: #c00;
    font-size: 0.875rem;
  }

  .info-message {
    padding: 0.75rem;
    margin-bottom: 1rem;
    background-color: #e7f3ff;
    border: 1px solid #b3d9ff;
    border-radius: var(--border-radius);
    color: #004085;
    font-size: 0.875rem;
  }

  .divider {
    display: flex;
    align-items: center;
    margin: 1rem 0;
    color: var(--text-muted);
    font-size: 0.875rem;
  }

  .divider::before,
  .divider::after {
    content: '';
    flex: 1;
    border-bottom: 1px solid var(--border);
  }

  .divider::before {
    margin-right: 0.5rem;
  }

  .divider::after {
    margin-left: 0.5rem;
  }

  @media (prefers-color-scheme: dark) {
    .auth-status {
      background-color: #2a2a2a;
    }

    .error-message {
      background-color: #3d1a1a;
      border-color: #5a2626;
      color: #ff8080;
    }

    .info-message {
      background-color: #1a2d3d;
      border-color: #264d73;
      color: #80c4ff;
    }
  }
`,md=document.createElement("template");md.innerHTML=`
  <style>${mc}</style>
  <div class="auth-container">
    <div id="authStatus" hidden>
      <div class="auth-status">
        <div class="auth-status__icon" id="userIcon"></div>
        <div class="auth-status__info">
          <div class="auth-status__email" id="userEmail"></div>
          <div class="auth-status__type" id="userType"></div>
        </div>
      </div>
      <button type="button" class="btn btn-danger" id="signOutBtn">Sign Out</button>
    </div>

    <div id="authForms" hidden>
      <div class="info-message" id="firebaseNotConfigured" hidden>
        <strong>Firebase Not Configured</strong><br>
        Your scans are being saved locally. To sync across devices, configure Firebase in your project.
      </div>

      <div class="auth-tabs">
        <button class="auth-tab active" data-tab="anonymous">Quick Start</button>
        <button class="auth-tab" data-tab="signin">Sign In</button>
        <button class="auth-tab" data-tab="signup">Sign Up</button>
      </div>

      <div class="auth-form active" id="anonymousForm">
        <div class="info-message">
          Start scanning immediately without creating an account. Your scans will be saved to your device and synced to the cloud.
        </div>
        <button type="button" class="btn" id="anonymousBtn">Continue Without Account</button>
      </div>

      <div class="auth-form" id="signinForm">
        <form>
          <div class="form-group">
            <label for="signinEmail">Email</label>
            <input type="email" id="signinEmail" required autocomplete="email">
          </div>
          <div class="form-group">
            <label for="signinPassword">Password</label>
            <input type="password" id="signinPassword" required autocomplete="current-password">
          </div>
          <div id="signinError" class="error-message" hidden></div>
          <button type="submit" class="btn" id="signinBtn">Sign In</button>
        </form>
        <div class="divider">or</div>
        <button type="button" class="btn btn-secondary" id="signinAnonymousBtn">Continue Without Account</button>
      </div>

      <div class="auth-form" id="signupForm">
        <form>
          <div class="form-group">
            <label for="signupEmail">Email</label>
            <input type="email" id="signupEmail" required autocomplete="email">
          </div>
          <div class="form-group">
            <label for="signupPassword">Password</label>
            <input type="password" id="signupPassword" required autocomplete="new-password" minlength="6">
          </div>
          <div class="form-group">
            <label for="signupDisplayName">Display Name (optional)</label>
            <input type="text" id="signupDisplayName" autocomplete="name">
          </div>
          <div id="signupError" class="error-message" hidden></div>
          <button type="submit" class="btn" id="signupBtn">Create Account</button>
        </form>
        <div class="divider">or</div>
        <button type="button" class="btn btn-secondary" id="signupAnonymousBtn">Continue Without Account</button>
      </div>
    </div>
  </div>
`;class mf extends HTMLElement{#ee=null;#et=null;#er=null;constructor(){super(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(md.content.cloneNode(!0))}connectedCallback(){var e;this.#ee=this.shadowRoot.getElementById("authStatus"),this.#et=this.shadowRoot.getElementById("authForms"),pZ()||this.shadowRoot.getElementById("firebaseNotConfigured")?.removeAttribute("hidden"),this.#en(),this.#er=(e=e=>{this.#ei(e)},pZ()&&p1?(p6.push(e),null!==p5&&e(p5),fK(p1,t=>{p5=t,e(t)})):()=>{});let t=p5;this.#ei(t)}disconnectedCallback(){this.#er&&this.#er()}#en(){this.shadowRoot.querySelectorAll(".auth-tab").forEach(e=>{e.addEventListener("click",()=>this.#es(e.dataset.tab))}),this.shadowRoot.getElementById("anonymousBtn")?.addEventListener("click",()=>this.#ea()),this.shadowRoot.getElementById("signinAnonymousBtn")?.addEventListener("click",()=>this.#ea()),this.shadowRoot.getElementById("signupAnonymousBtn")?.addEventListener("click",()=>this.#ea()),this.shadowRoot.getElementById("signinForm")?.addEventListener("submit",e=>this.#eo(e)),this.shadowRoot.getElementById("signupForm")?.addEventListener("submit",e=>this.#el(e)),this.shadowRoot.getElementById("signOutBtn")?.addEventListener("click",()=>this.#eu())}#es(e){let t=this.shadowRoot.querySelectorAll(".auth-tab"),r=this.shadowRoot.querySelectorAll(".auth-form");t.forEach(t=>{t.dataset.tab===e?t.classList.add("active"):t.classList.remove("active")}),r.forEach(t=>{t.id===`${e}Form`?t.classList.add("active"):t.classList.remove("active")})}async #ea(){let e=this.shadowRoot.getElementById("anonymousBtn");e&&(e.disabled=!0);let{error:t,user:r}=await p3();t?(eL.error("Error signing in anonymously:",t),eH("Error signing in. Please try again.",{variant:"danger"}),e&&(e.disabled=!1)):eH("Signed in successfully!",{variant:"success"})}async #eo(e){e.preventDefault();let t=this.shadowRoot.getElementById("signinEmail"),r=this.shadowRoot.getElementById("signinPassword"),n=this.shadowRoot.getElementById("signinError"),i=this.shadowRoot.getElementById("signinBtn");i&&(i.disabled=!0),n&&(n.hidden=!0);let{error:s,user:a}=await p8(t.value,r.value);s?(eL.error("Error signing in:",s),n&&(n.textContent=this.#eh(s),n.hidden=!1),i&&(i.disabled=!1)):(eH("Signed in successfully!",{variant:"success"}),r.value="")}async #el(e){e.preventDefault();let t=this.shadowRoot.getElementById("signupEmail"),r=this.shadowRoot.getElementById("signupPassword"),n=this.shadowRoot.getElementById("signupDisplayName"),i=this.shadowRoot.getElementById("signupError"),s=this.shadowRoot.getElementById("signupBtn");s&&(s.disabled=!0),i&&(i.hidden=!0);let{error:a,user:o}=await p4(t.value,r.value,n.value);a?(eL.error("Error creating account:",a),i&&(i.textContent=this.#eh(a),i.hidden=!1),s&&(s.disabled=!1)):(eH("Account created successfully!",{variant:"success"}),r.value="")}async #eu(){let e=this.shadowRoot.getElementById("signOutBtn");e&&(e.disabled=!0);let{error:t}=await p7();t?(eL.error("Error signing out:",t),eH("Error signing out. Please try again.",{variant:"danger"}),e&&(e.disabled=!1)):eH("Signed out successfully",{variant:"success"})}#ei(e){if(e){this.#ee?.removeAttribute("hidden"),this.#et?.setAttribute("hidden","");let t=this.shadowRoot.getElementById("userIcon"),r=this.shadowRoot.getElementById("userEmail"),n=this.shadowRoot.getElementById("userType");t&&(t.textContent=e.email?e.email[0].toUpperCase():"?"),r&&(r.textContent=e.email||"Anonymous User"),n&&(n.textContent=e.isAnonymous?"Anonymous Account":"Email Account"),this.dispatchEvent(new CustomEvent("auth-state-changed",{bubbles:!0,composed:!0,detail:{user:e}}))}else this.#ee?.setAttribute("hidden",""),this.#et?.removeAttribute("hidden"),this.dispatchEvent(new CustomEvent("auth-state-changed",{bubbles:!0,composed:!0,detail:{user:null}}))}#eh(e){switch(e.code){case"auth/email-already-in-use":return"This email is already in use. Please sign in or use a different email.";case"auth/invalid-email":return"Invalid email address.";case"auth/weak-password":return"Password should be at least 6 characters.";case"auth/user-not-found":return"No account found with this email.";case"auth/wrong-password":return"Incorrect password.";case"auth/too-many-requests":return"Too many failed attempts. Please try again later.";case"auth/network-request-failed":return"Network error. Please check your connection.";default:return e.message||"An error occurred. Please try again."}}static defineCustomElement(e="bs-auth"){"undefined"==typeof window||window.customElements.get(e)||window.customElements.define(e,mf)}}mf.defineCustomElement(),async function(){try{if(pZ()){eL.info("Initializing Firebase..."),await mr(),await (!pZ()||!p1?(eL.warn("Firebase not configured. Running in local-only mode."),Promise.resolve(null)):new Promise((e,t)=>{let r=fK(p1,t=>{p5=t,p6.forEach(e=>{try{e(t)}catch(e){eL.error("Error in auth state listener:",e)}}),r(),e(t)},e=>{eL.error("Auth state error:",e),t(e)})}))||(eL.info("No user signed in, signing in anonymously..."),await p3());let{syncedCount:e}=await mo();e>0&&eH(`Synced ${e} scans from offline mode`,{variant:"success"}),window.addEventListener("online",async()=>{eL.info("Back online, syncing pending scans...");let{syncedCount:e}=await mo();e>0&&eH(`Synced ${e} scans`,{variant:"success"})}),window.addEventListener("offline",()=>{eL.info("Offline mode - scans will be saved locally"),eH("Offline mode - scans will sync when online",{variant:"warning"})})}else eL.info("Firebase not configured - using local storage only")}catch(e){eL.error("Error initializing Firebase:",e),eH("Running in offline mode",{variant:"warning"})}let e=document.querySelector("a-tab-group"),t=document.querySelector("video-capture"),r=document.querySelector("bs-settings"),n=document.querySelector("bs-history"),i=document.getElementById("cameraPanel"),s=i.querySelector(".results"),a=document.getElementById("filePanel"),o=a.querySelector(".results"),l=document.getElementById("scanInstructions"),u=document.getElementById("scanBtn"),h=document.getElementById("dropzone"),c=document.querySelector("resize-observer"),d=document.getElementById("scanFrame"),f=document.getElementById("torchButton"),p=document.getElementById("globalActions"),m=document.getElementById("authBtn"),g=document.getElementById("authDialog"),y=document.getElementById("historyBtn"),v=document.getElementById("historyDialog"),b=document.getElementById("settingsBtn"),w=document.getElementById("settingsDialog"),E=document.getElementById("settingsForm"),I=document.getElementById("cameraSelect"),_=null,T=!0;"function"==typeof HTMLDialogElement&&(p?.removeAttribute("hidden"),g?.removeAttribute("hidden"),v?.removeAttribute("hidden"),w?.removeAttribute("hidden"));let{barcodeReaderError:S}=await ez.setup();if(S){let t=document.getElementById("barcodeReaderError");T=!1,p?.setAttribute("hidden",""),e?.setAttribute("hidden",""),t?.setAttribute("open","");return}let A=await ez.getSupportedFormats(),[,C]=await ex(),x=C?.formats||A,k=await ez.create(x);async function N(e,t,r=""){try{let n=await ej(e);if(n){let i=n.title||n.name||n.alias||"",s=n.description||n.brand||"",a=`${i||e}${s?` \u{2014} ${s}`:""}`;eH(a,{variant:"success"}),function(e,t){if(!e||!t)return;let r=e.querySelector("#itemInfo");if(!r){(r=document.createElement("div")).id="itemInfo",r.className="item-info";let t=e.querySelector(".results");t&&t.parentNode?t.parentNode.insertBefore(r,t.nextSibling):e.appendChild(r)}r.textContent="";let n=document.createElement("h3");n.className="item-info__title",n.textContent=t.title||t.name||t.alias||"";let i=document.createElement("p");i.className="item-info__description",i.textContent=t.description||"";let s=document.createElement("p");s.className="item-info__brand",s.textContent=t.brand?`Brand: ${t.brand}`:"",r.appendChild(n),i.textContent&&r.appendChild(i),s.textContent&&r.appendChild(s)}(t,n);try{let r=t?.querySelector(".results");if(r){let t=r.querySelector(`bs-result[value="${e}"]`);t&&(n.title&&t.setAttribute("data-title",n.title),n.brand&&t.setAttribute("data-brand",n.brand),n.description&&t.setAttribute("data-description",n.description))}}catch(e){}try{await mn({value:e,format:r,title:n.title||n.name||n.alias||"",brand:n.brand||"",description:n.description||"",metadata:{source:"camera",hasProductInfo:!0}})}catch(e){eL.warn("Error saving scan to Firestore:",e)}return n}try{await mn({value:e,format:r,metadata:{source:"camera",hasProductInfo:!1}})}catch(e){eL.warn("Error saving scan to Firestore:",e)}}catch(t){try{await mn({value:e,format:r,metadata:{source:"camera",hasProductInfo:!1,lookupFailed:!0}})}catch(e){eL.warn("Error saving scan to Firestore:",e)}}}t.addEventListener("video-capture:video-play",M,{once:!0}),t.addEventListener("video-capture:error",function(e){let t=e.detail.error;if("NotFoundError"===t.name)return;let r="NotAllowedError"===t.name?"<strong>Error accessing camera</strong><br>Permission to use webcam was denied or video Autoplay is disabled. Reload the page to give appropriate permissions to webcam.":t.message;i.innerHTML=`
      <alert-element variant="danger" open>
        <span slot="icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="1.25em" height="1.25em" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
            <path d="M4.54.146A.5.5 0 0 1 4.893 0h6.214a.5.5 0 0 1 .353.146l4.394 4.394a.5.5 0 0 1 .146.353v6.214a.5.5 0 0 1-.146.353l-4.394 4.394a.5.5 0 0 1-.353.146H4.893a.5.5 0 0 1-.353-.146L.146 11.46A.5.5 0 0 1 0 11.107V4.893a.5.5 0 0 1 .146-.353zM5.1 1 1 5.1v5.8L5.1 15h5.8l4.1-4.1V5.1L10.9 1z"/>
            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
          </svg>
        </span>
        ${r}
      </alert-element>
    `},{once:!0}),eQ.defineCustomElement();let R=t?.shadowRoot,D=R?.querySelector("video"),L=R?.querySelector('[part="actions-container"]');async function P(){if(T){eL.info("Scanning..."),l?.removeAttribute("hidden");try{let[,e]=await ex(),t=await k.detect(D),r=t?.rawValue??"",a=t?.format??"";if(!r)throw Error("No barcode detected");if(eP(s,r),N(r,i,a),e?.addToHistory)try{await n?.add(r),v&&(v.open=!0,setTimeout(()=>{try{let e=n?.shadowRoot?.querySelector(`li[data-value="${r}"]`);e?.scrollIntoView({behavior:"smooth",block:"center"}),e?.classList?.add("highlight"),setTimeout(()=>e?.classList?.remove("highlight"),2e3)}catch(e){}},50))}catch(e){}if(eV(),!e?.continueScanning){_&&(clearTimeout(_),_=null),u?.removeAttribute("hidden"),d?.setAttribute("hidden",""),L?.setAttribute("hidden","");return}}catch{}T&&(_=setTimeout(()=>P(),1e3))}}async function O(e){if(!e)return;let[,t]=await ex(),r=new Image,i=new FileReader;i.onload=i=>{let s=i.target.result;r.onload=async()=>{try{let e=await k.detect(r),i=e?.rawValue??"",s=e?.format??"";if(!i)throw Error("No barcode detected");if(eP(o,i),N(i,a,s),t?.addToHistory)try{await n?.add(i),v&&(v.open=!0,setTimeout(()=>{try{let e=n?.shadowRoot?.querySelector(`li[data-value="${i}"]`);e?.scrollIntoView({behavior:"smooth",block:"center"}),e?.classList?.add("highlight"),setTimeout(()=>e?.classList?.remove("highlight"),2e3)}catch(e){}},50))}catch(e){}eV()}catch(e){eL.error(e),eH("<strong>No barcode detected</strong><br><small>Please try again with a different image.</small>",{variant:"danger",trustDangerousInnerHTML:!0}),eV({success:!1})}},r.src=s,r.alt="Image preview",h.replaceChildren();let l=document.createElement("div");l.className="dropzone-preview";let u=document.createElement("div");u.className="dropzone-preview__image-wrapper";let c=document.createElement("div");c.className="dropzone-preview__file-name",c.textContent=e.name,u.appendChild(r),l.appendChild(u),l.appendChild(c),h.prepend(l)},i.readAsDataURL(e)}async function M(e){d?.removeAttribute("hidden"),eU(e.detail.video,d),P();let r=e.target.getTrackSettings(),n=e.target.getTrackCapabilities(),i=document.getElementById("zoomLevel");if(n?.torch&&(f?.addEventListener("click",V),f?.removeAttribute("hidden"),t.hasAttribute("torch")&&e$({el:f,isTorchOn:!0})),r?.zoom&&n?.zoom){let e=document.getElementById("zoomControls"),s=n?.zoom?.min||0,a=n?.zoom?.max||10,o=r?.zoom||1;e?.addEventListener("click",e=>{let r=e.target.closest('[data-action="zoom-in"]'),n=e.target.closest('[data-action="zoom-out"]');r&&o<a&&(o+=.5),n&&o>s&&(o-=.5),i.textContent=o.toFixed(1),t.zoom=o}),e?.removeAttribute("hidden"),i.textContent=o.toFixed(1)}let s=await eQ.getVideoInputDevices();s.forEach((e,t)=>{let r=document.createElement("option");r.value=e.deviceId,r.textContent=e.label||`Camera ${t+1}`,I.appendChild(r)}),s.length>1&&(I?.addEventListener("change",U),I?.removeAttribute("hidden"))}async function F(e){e.preventDefault();let t={},r=new FormData(E),n=r.getAll("general-settings"),i=r.getAll("formats-settings");n.forEach(e=>t[e]=!0),t.formats=i,ek(t),"formats-settings"===e.target.name&&(k=await ez.create(i))}function V(e){t.torch=!t.torch,e$({el:e.currentTarget,isTorchOn:t.hasAttribute("torch")})}function U(e){if("function"!=typeof t.restartVideoStream)return;let r=e.target.value||void 0;t.restartVideoStream(r)}h.accept=ey.join(","),r.supportedFormats=A,u.addEventListener("click",function(){u?.setAttribute("hidden",""),d?.removeAttribute("hidden"),L?.removeAttribute("hidden"),P()}),e.addEventListener("a-tab-show",eD(function(e){let t=e.detail.tabId,r=document.querySelector("video-capture");if("cameraTab"===t){if(T=!0,!r)return;if(!r.loading&&u.hasAttribute("hidden")&&(d?.removeAttribute("hidden"),L?.removeAttribute("hidden"),P()),"function"==typeof r.startVideoStream){let e=I?.value||void 0;r.startVideoStream(e)}}else"fileTab"===t&&(T=!1,null!=r&&"function"==typeof r.stopVideoStream&&r.stopVideoStream(),d?.setAttribute("hidden",""),L?.setAttribute("hidden",""))},250)),h.addEventListener("files-dropzone-drop",function(e){O(e.detail.acceptedFiles[0])}),c.addEventListener("resize-observer:resize",function(){eU(t.shadowRoot.querySelector("video"),d)}),m.addEventListener("click",function(){g.open=!0}),b.addEventListener("click",function(){w.open=!0}),E.addEventListener("change",eD(F,500)),y.addEventListener("click",function(){v.open=!0}),document.addEventListener("visibilitychange",function(){if("cameraTab"===e.querySelector("[selected]").getAttribute("id"))if("hidden"===document.visibilityState)T=!1,null!=t&&"function"==typeof t.stopVideoStream&&t.stopVideoStream();else{T=!0;let e=document.querySelector("video-capture");if(!e)return;if(!e.loading&&u.hasAttribute("hidden")&&P(),"function"==typeof e.startVideoStream){let t=I?.value||void 0;e.startVideoStream(t)}}}),document.addEventListener("keydown",function(t){"Escape"===t.key&&function(){let t=e.querySelector("#cameraTab").hasAttribute("selected"),r=!u.hidden,n=w.hasAttribute("open"),i=v.hasAttribute("open");r&&t&&!(n||i)&&u.click()}()}),document.addEventListener("bs-history-success",function(e){let{type:t,message:r}=e.detail;"add"===t&&eH(r,{variant:"success"})}),document.addEventListener("bs-history-error",function(e){let{type:t,message:r}=e.detail;("remove"===t||"empty"===t)&&v?.hide(),eH(r,{variant:"danger"})})}();
//# sourceMappingURL=barcode-scanner-CS465.663b2205.js.map
